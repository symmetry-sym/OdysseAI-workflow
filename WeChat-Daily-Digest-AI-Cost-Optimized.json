{
  "name": "WeChat-Daily-Digest-AI-Cost-Optimized",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            }
          ]
        }
      },
      "id": "9293b300-18f1-442a-b566-902e1f7a0491",
      "name": "Run every day at 8am",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        624,
        -144
      ],
      "timezone": "Asia/Shanghai"
    },
    {
      "parameters": {
        "url": "http://host.docker.internal:5030/api/v1/chatlog",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={\n  \"time\": \"{{ $json.date }}~{{ $json.date }}\",\n  \"talker\": \"{{ $json.group_name }}\"\n}",
        "options": {}
      },
      "id": "cf02a726-1673-442e-9547-e56a2c3cf9f2",
      "name": "Fetch Yesterday's Chatlog",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        672,
        304
      ]
    },
    {
      "parameters": {
        "jsCode": "// Node: Parse & Structure Data (Repaired)\n// Input: Raw chat log text from the previous node.\n// Output: A single, structured JSON object with correctly parsed messages.\n\nconst rawLog = $json.data;\nconst talkerName = $('ConfigureChatParameters').first().json.group_name;\n\nif (!rawLog) {\n  console.log(\"è¾“å…¥æ•°æ®ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ä¸Šæ¸¸èŠ‚ç‚¹ã€‚\");\n  return { error: \"Input data is empty or not found.\" };\n}\n\n// è·å–æ˜¨å¤©çš„æ—¥æœŸä½œä¸ºæ‰€æœ‰æ¶ˆæ¯çš„æ—¥æœŸå‰ç¼€\nconst datePrefix = $('ConfigureChatParameters').first().json.date;\n\n\n// æŒ‰ä¸€ä¸ªæˆ–å¤šä¸ªç©ºè¡Œæ¥åˆ†å‰²æ¶ˆæ¯å—ï¼Œè¿™æ›´å¯é \nconst messageBlocks = rawLog.trim().split(/\\n\\s*\\n/);\n\nconst messages = [];\nfor (const block of messageBlocks) {\n  if (block.trim() === \"\") continue;\n\n  const lines = block.trim().split('\\n');\n  const header = lines.shift(); // ç¬¬ä¸€è¡Œæ˜¯ \"å‘é€è€… HH:MM:SS\"\n\n  // æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºä» header ä¸­æ•è·å‘é€è€…å’Œæ—¶é—´\n  const match = header.match(/(.+) (\\d{2}:\\d{2}:\\d{2})$/);\n\n  // å¦‚æœç¬¬ä¸€è¡Œä¸ç¬¦åˆ \"å‘é€è€… æ—¶é—´\" çš„æ ¼å¼ï¼Œåˆ™è·³è¿‡è¿™ä¸ªå—\n  if (!match) {\n    console.log(\"è·³è¿‡æ— æ•ˆçš„æ¶ˆæ¯å—:\", block);\n    continue;\n  }\n\n  const senderName = match[1].trim();\n  const timeStr = match[2];\n  const content = lines.join('\\n').trim();\n\n  // ç»„åˆæ—¥æœŸå’Œæ—¶é—´ï¼Œåˆ›å»ºå®Œæ•´çš„ISOæ—¶é—´æˆ³\n  const isoTime = `${datePrefix}T${timeStr}+08:00`;\n\n  messages.push({\n    content: content,\n    contents: null,\n    sender_name: senderName,\n    talker_name: talkerName,\n    time: isoTime,\n    seq: messages.length + 1\n  });\n}\n\nconst now = new Date();\nconst result = {\n  step: \"1_structured_data\",\n  description: \"Parsed and structured data from raw text\",\n  date: $('ConfigureChatParameters').first().json.date,\n  timestamp: now.toISOString(),\n  sources: {\n    [talkerName]: {\n      message_count: messages.length,\n      messages: messages\n    }\n  },\n  statistics: {\n    total_sources: 1,\n    total_messages: messages.length,\n    sources_summary: {\n      [talkerName]: messages.length\n    }\n  }\n};\n\nconsole.log(\"æˆåŠŸè·å– \" + messages.length +\" æ¡æ¶ˆæ¯ from \" + talkerName)\n\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        304
      ],
      "id": "7ef6b8b4-b023-4258-a55f-cf29f88e0865",
      "name": "Parse & Structure Data"
    },
    {
      "parameters": {
        "jsCode": "// Node: Clean & Segment by Time (Repaired with Logs and Validation - Fixed)\n// Input: The structured JSON object from the \"Parse & Structure Data\" node.\n// Output: An array of time segments, with correct message counts.\n\nconst structuredData = $('Parse & Structure Data').first().json;\nconst sourceName = Object.keys(structuredData.sources)[0];\nconst allMessages = structuredData.sources[sourceName].messages;\n\nconsole.log(`\\n[blue]å¼€å§‹æ—¶é—´æ®µåˆ†å‰²å’Œæ¸…æ´—...[/blue]`);\nconsole.log(`[cyan]åŸå§‹æ¶ˆæ¯æ€»æ•°: ${allMessages.length} æ¡[/cyan]`);\n\nif (!allMessages || allMessages.length === 0) {\n  console.log(\"æ²¡æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†ã€‚\");\n  return [];\n}\n\n// 1. æ¸…æ´—æ¶ˆæ¯\nconst cleanedMessages = allMessages.filter(msg => {\n  const hasSender = msg.sender_name && msg.sender_name.trim() !== \"\";\n  const hasContent = (msg.content && msg.content.trim() !== \"\") || (msg.contents && msg.contents !== null);\n  \n  // å¼ºåŒ–ç³»ç»Ÿæ¶ˆæ¯è¿‡æ»¤æ¡ä»¶\n  const isSystemMessage = (msg.sender_name === \"\" || msg.sender_name === \"ç³»ç»Ÿæ¶ˆæ¯\") || \n                          (msg.content && (\n                            msg.content.includes(\"åŠ å…¥äº†ç¾¤èŠ\") ||\n                            msg.content.includes(\"æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯\") ||\n                            msg.content.includes(\"æ‹äº†æ‹\") ||\n                            msg.content.includes(\"ä¸ç¾¤é‡Œå…¶ä»–äººéƒ½ä¸æ˜¯æœ‹å‹å…³ç³»\")\n                          ));\n\n  return hasSender && hasContent && !isSystemMessage;\n});\n\nconsole.log(`[cyan]æ¸…æ´—åæœ‰æ•ˆæ¶ˆæ¯æ€»æ•°: ${cleanedMessages.length} æ¡ (è¿‡æ»¤æ‰ç³»ç»Ÿæ¶ˆæ¯ç­‰)[/cyan]`);\n\n// 2. å®šä¹‰æ—¶é—´æ®µ\nconst segmentsConfig = [\n  { name: \"å‡Œæ™¨\", start_hour: 0, end_hour: 6, messages: [] },\n  { name: \"ä¸Šåˆ\", start_hour: 6, end_hour: 12, messages: [] },\n  { name: \"ä¸‹åˆ\", start_hour: 12, end_hour: 18, messages: [] },\n  { name: \"æ™šä¸Š\", start_hour: 18, end_hour: 24, messages: [] }\n];\n\n// 3. å°†æ¸…æ´—åçš„æ¶ˆæ¯æ”¾å…¥æ—¶é—´æ®µ\nfor (const message of cleanedMessages) {\n  try {\n    const msgHour = parseInt(message.time.substring(11, 13), 10);\n\n    if (isNaN(msgHour)) {\n        console.log(`[yellow]è­¦å‘Š: æ— æ³•è§£ææ¶ˆæ¯æ—¶é—´ï¼Œè·³è¿‡: ${message.time}[/yellow]`);\n        continue; \n    }\n\n    let assigned = false;\n    for (const segment of segmentsConfig) {\n      if (msgHour >= segment.start_hour && msgHour < segment.end_hour) {\n        segment.messages.push(message);\n        assigned = true;\n        break;\n      }\n    }\n    if (!assigned) {\n        console.log(`[yellow]è­¦å‘Š: æ¶ˆæ¯æœªåˆ†é…åˆ°ä»»ä½•æ—¶é—´æ®µï¼Œè·³è¿‡: ${message.time} - ${message.sender_name}: ${message.content.substring(0, 50)}...[/yellow]`);\n    }\n  } catch (e) {\n    console.log(`[red]é”™è¯¯: å¤„ç†æ¶ˆæ¯æ—¶å‘ç”Ÿå¼‚å¸¸: ${message.time} - ${e.message}[/red]`);\n  }\n}\n\n// 4. æ ¼å¼åŒ–æœ€ç»ˆè¾“å‡º\nconst result = segmentsConfig\n  .filter(s => s.messages.length > 0)\n  .map(s => ({\n    json: {\n      name: s.name,\n      start_hour: s.start_hour,\n      end_hour: s.end_hour,\n      messages_log: s.messages.map(m => `${m.sender_name}: ${m.content}`).join('\\n---\\n'),\n      message_count: s.messages.length\n    }\n  }));\n\n// 5. æ‰“å°æ¯ä¸ªæ—¶é—´æ®µçš„æ—¥å¿—\nconsole.log(`\\n[blue]æ—¶é—´æ®µåˆ†å‰²ç»“æœ:[/blue]`);\nlet totalSegmentedMessages = 0;\nsegmentsConfig.forEach(s => {\n    if (s.messages.length > 0) {\n        console.log(`  ğŸ“… ${s.name} (${s.start_hour}-${s.end_hour}æ—¶): ${s.messages.length} æ¡æ¶ˆæ¯`);\n        totalSegmentedMessages += s.messages.length;\n    }\n});\n\n// 6. æ•°æ®éªŒè¯\nconsole.log(`\\n[blue]æ•°æ®éªŒè¯:[/blue]`);\nconsole.log(`  æ¸…æ´—åæ¶ˆæ¯æ€»æ•°: ${cleanedMessages.length} æ¡`);\nconsole.log(`  åˆ†æ®µåæ¶ˆæ¯æ€»æ•°: ${totalSegmentedMessages} æ¡`);\n\nif (cleanedMessages.length === totalSegmentedMessages) {\n  console.log(`[green]æ•°æ®éªŒè¯é€šè¿‡: æ‰€æœ‰æ¸…æ´—åçš„æ¶ˆæ¯éƒ½å·²æˆåŠŸåˆ†æ®µã€‚[/green]`);\n} else {\n  console.log(`[red]æ•°æ®éªŒè¯å¤±è´¥: æ¸…æ´—åæ¶ˆæ¯ (${cleanedMessages.length}) ä¸åˆ†æ®µåæ¶ˆæ¯ (${totalSegmentedMessages}) æ•°é‡ä¸åŒ¹é…ã€‚[/red]`);\n  // å¯ä»¥é€‰æ‹©æŠ›å‡ºé”™è¯¯æ¥ä¸­æ–­å·¥ä½œæµï¼Œæˆ–è€…ç»§ç»­æ‰§è¡Œ\n  // throw new Error(\"æ¶ˆæ¯æ•°é‡ä¸åŒ¹é…ï¼Œæ•°æ®å¤„ç†å¼‚å¸¸ã€‚\");\n}\n\nconsole.log(`[green]æ—¶é—´æ®µåˆ†å‰²å’Œæ¸…æ´—å®Œæˆ[/green]`);\n\nreturn result;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1520,
        304
      ],
      "id": "0304b56a-3a19-487a-8564-29339aadece2",
      "name": "Clean & Segment by Time"
    },
    {
      "parameters": {
        "content": "## ç»“æ„åŒ–åˆå§‹æ•°æ®\n \nå¤©æ•°æ®è·å–ä¸é¢„å¤„ç†ï¼ˆåŒ…å«è§£æã€æ¸…æ´—ã€åˆ†æ®µã€é“¾æ¥æå–ã€æ´»è·ƒç”¨æˆ·ç»Ÿè®¡ã€æ¶ˆæ¯æ ·æœ¬å‡†å¤‡ï¼‰",
        "height": 260,
        "width": 860,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        560,
        208
      ],
      "id": "9025bb9d-7728-48b8-b7da-684d37494b6a",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## èŠå¤©æ•°æ®æ—¶é—´åˆ†æ®µ\n",
        "height": 260,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1472,
        208
      ],
      "id": "7c445fbe-d445-4bf8-a662-23854666aa6d",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## è¯é¢˜åˆ†æ\n   * åˆ†è€Œæ²»ä¹‹: å°†é•¿æ—¥å¿—åˆ†å‰²æˆå°å—ï¼Œé€ä¸ªå¤„ç†ã€‚\n   * æˆæœ¬æ§åˆ¶: åœ¨ç²—åŠ å·¥é˜¶æ®µä½¿ç”¨å»‰ä»·æ¨¡å‹ã€‚\n   * ç»“æ„åŒ–è¾“å‡º: å¼ºåˆ¶ AI è¿”å› JSON æ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†ã€‚\n   * è¯é¢˜èšåˆ: å°†æ‰€æœ‰æ—¶é—´æ®µçš„è¯é¢˜åˆå¹¶ï¼Œä¸ºæœ€ç»ˆæŠ¥å‘Šåšå‡†å¤‡ã€‚\n",
        "height": 420,
        "width": 1140,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        560,
        528
      ],
      "id": "de5fda79-634b-442c-ad55-a3c4eee8e9d8",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "ff747e49-0c13-4dc3-85a5-199a6b6b9c9f",
      "name": "Split in Batches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 2,
      "position": [
        624,
        656
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸“ä¸šçš„èŠå¤©è®°å½•åˆ†æä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ†æç»™å®šçš„èŠå¤©è®°å½•ç‰‡æ®µï¼Œå¹¶ä¸¥æ ¼æŒ‰ç…§è¦æ±‚æå–æ ¸å¿ƒè¯é¢˜ã€‚\n\n### æ ¸å¿ƒåˆ†æåŸåˆ™ (å¿…é¡»ä¸¥æ ¼éµå®ˆ)\n\n1.  **è¯é¢˜è¯†åˆ«æ ‡å‡†**:\n    *   **æ•°é‡é—¨æ§›**: è‡³å°‘éœ€è¦3æ¡ç›¸å…³çš„æ¶ˆæ¯æ‰èƒ½æ„æˆä¸€ä¸ªç‹¬ç«‹çš„è¯é¢˜ã€‚\n    *   **å†…å®¹ä»·å€¼**: è¯é¢˜å†…å®¹å¿…é¡»æœ‰æ˜ç¡®çš„è®¨è®ºä¸»é¢˜å’Œä»·å€¼ã€‚\n    *   **æ— æ•ˆå†…å®¹è¿‡æ»¤**: ä¸¥ç¦å°†æ— æ„ä¹‰çš„é—®å€™ï¼ˆå¦‚â€œæ—©â€ã€â€œåœ¨å—â€ï¼‰ã€è¡¨æƒ…ç¬¦å·ã€æˆ–ç®€å•çš„ç¡®è®¤ï¼ˆå¦‚â€œå¥½çš„â€ã€â€œæ”¶åˆ°â€ï¼‰ä½œä¸ºç‹¬ç«‹è¯é¢˜ã€‚\n\n2.  **è¯é¢˜è¾¹ç•Œåˆ¤æ–­**:\n    *   **ä¸»é¢˜å»¶ç»­**: å¦‚æœæœ‰æ–°æˆå‘˜åŠ å…¥è®¨è®ºï¼Œä½†è®¨è®ºçš„è¿˜æ˜¯åŒä¸€ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼Œè¿™å±äº**åŒä¸€è¯é¢˜**ã€‚\n    *   **ä¸»é¢˜è½¬å˜**: å½“è®¨è®ºçš„ç„¦ç‚¹å‘ç”Ÿæ˜æ˜¾ã€ä¸ç›¸å…³çš„è½¬å˜æ—¶ï¼Œå¿…é¡»åˆ›å»º**æ–°è¯é¢˜**ã€‚\n    *   **æ—¶é—´é—´éš”**: å¦‚æœä¸¤æ¡æ¶ˆæ¯ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³è”ï¼Œä¸”æ—¶é—´é—´éš”è¶…è¿‡ **30åˆ†é’Ÿ**ï¼Œåº”è§†ä¸º**æ–°è¯é¢˜**ã€‚\n\n### å†…å®¹ç”Ÿæˆè¦æ±‚\n\n1.  **è¯é¢˜æ ‡é¢˜ (`topic_title`)**: ç”Ÿæˆä¸€ä¸ªç®€æ´ã€ç²¾å‡†ã€èƒ½æ¦‚æ‹¬è¯é¢˜æ ¸å¿ƒçš„æ ‡é¢˜ã€‚\n2.  **è¯é¢˜æè¿° (`topic_description`)**:\n    *   **é£æ ¼**: ä½¿ç”¨ç”ŸåŠ¨ã€æ¥åœ°æ°”ã€ç•¥å¸¦â€œéªšè¯â€é£æ ¼çš„å¹´è½»äººç½‘ç»œç”¨è¯­ã€‚\n    *   **å†…å®¹**: æè¿°å¿…é¡»å‡†ç¡®åæ˜ è®¨è®ºçš„å®é™…å†…å®¹ã€å…³é”®ä¿¡æ¯å’Œä¸»è¦è§‚ç‚¹ã€‚\n    *   **é•¿åº¦**: ä¸¥æ ¼æ§åˆ¶åœ¨ 100 åˆ° 150 å­—ä¹‹é—´ã€‚\n\n### ç»å¯¹è¾“å‡ºè¦æ±‚ (æœ€é‡è¦)\n\n1.  **çº¯JSON**: **åªå…è®¸**è¾“å‡ºæœ‰æ•ˆçš„JSONå¯¹è±¡ã€‚\n2.  **ç¦æ­¢Markdown**: **ä¸¥ç¦**åœ¨è¾“å‡ºçš„ä»»ä½•ä½ç½®ä½¿ç”¨ ` ```json ` æˆ– ` ``` ` è¿›è¡ŒåŒ…è£¹ã€‚\n3.  **ç¦æ­¢è§£é‡Š**: **ä¸¥ç¦**åœ¨JSONå¯¹è±¡å‰åæ·»åŠ ä»»ä½•å½¢å¼çš„è§£é‡Šæ€§æ–‡å­—æˆ–æ³¨é‡Šã€‚\n4.  **ç¾¤ç»„å**: {{ $('ConfigureChatParameters').item.json.group_name }}\n\n---\n### è¾“å‡ºJSONæ ¼å¼ (ä¸¥æ ¼éµå®ˆæ­¤ç»“æ„)\n\n1. å¿…é¡»è¿”å›æœ‰æ•ˆçš„ JSON æ ¼å¼\n2. ä¸è¦åŒ…å«ä»»ä½•è§£é‡Šæ–‡å­—æˆ– markdown æ ¼å¼\n3. ä¸è¦ä½¿ç”¨ ```json``` ä»£ç å—\n4. ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›\n\nJSON æ ¼å¼ç¤ºä¾‹ï¼š\n{\n  \"analysis_id\": \"ç¾¤ç»„å_æ—¥æœŸ_æ—¶é—´æ®µ_analysis\",\n  \"meta\": {\n    \"source\": \"ç¾¤ç»„å\",\n    \"date\": \"æ—¥æœŸ\", \n    \"segment\": \"æ—¶é—´æ®µ\",\n    \"total_messages\": 50\n  },\n  \"topics\": [\n    {\n      \"topic_id\": \"è¯é¢˜1çš„ID\",\n      \"topic_title\": \"è¯é¢˜1çš„æ ‡é¢˜\",\n      \"topic_description\": \"è¯é¢˜1çš„è¯¦ç»†æè¿°ï¼ŒåŒ…å«å…³é”®è¯å’Œä¸»è¦å†…å®¹ï¼Œè‡³å°‘50å­—\",\n      \"is_off_topic\": false,\n      \"topic_start_time\": \"è¯é¢˜å¼€å§‹æ—¶é—´ (ISOæ ¼å¼ï¼Œä¾‹å¦‚: 2023-07-03T14:30:00+08:00)\",\n      \"topic_end_time\": \"è¯é¢˜ç»“æŸæ—¶é—´ (ISOæ ¼å¼ï¼Œä¾‹å¦‚: 2023-07-03T15:00:00+08:00)\",\n      \"message_seqs\": [\"æ„æˆè¯¥è¯é¢˜çš„æ‰€æœ‰æ¶ˆæ¯çš„seqåˆ—è¡¨ï¼Œä¾‹å¦‚: 1, 5, 8\"]\n    }\n  ]\n}\n\né‡è¦ï¼šåªè¿”å› JSONï¼Œä¸è¦ä»»ä½•å…¶ä»–å†…å®¹ã€‚\n\n---\n### å¾…åˆ†æçš„èŠå¤©è®°å½•\n\n{{ JSON.stringify($json) }}",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1168,
        640
      ],
      "id": "0699d3f7-5137-4026-9615-043fa98e0584",
      "name": "Extract Topics (Low Cost AI)"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"required\": [\"analysis_id\", \"meta\", \"topics\"],\n  \"properties\": {\n    \"analysis_id\": {\n      \"type\": \"string\",\n      \"description\": \"å”¯ä¸€åˆ†ææ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸ºç¾¤ç»„å_æ—¥æœŸ_æ—¶é—´æ®µ_analysis\",\n      \"pattern\": \"^.+_.+_.+_analysis$\"\n    },\n    \"meta\": {\n      \"type\": \"object\",\n      \"required\": [\"source\", \"date\", \"segment\", \"total_messages\"],\n      \"properties\": {\n        \"source\": {\n          \"type\": \"string\",\n          \"description\": \"æ•°æ®æ¥æºçš„ç¾¤ç»„åç§°\"\n        },\n        \"date\": {\n          \"type\": \"string\",\n          \"description\": \"åˆ†ææ—¥æœŸ\",\n          \"format\": \"date\"\n        },\n        \"segment\": {\n          \"type\": \"string\",\n          \"description\": \"æ—¶é—´æ®µæ ‡è¯†\"\n        },\n        \"total_messages\": {\n          \"type\": \"integer\",\n          \"description\": \"æ¶ˆæ¯æ€»æ•°ç»Ÿè®¡\",\n          \"minimum\": 0\n        }\n      }\n    },\n    \"topics\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\"topic_id\", \"topic_title\", \"topic_description\", \"is_off_topic\", \"topic_start_time\", \"topic_end_time\", \"message_seqs\"],\n        \"properties\": {\n          \"topic_id\": {\n            \"type\": \"string\",\n            \"description\": \"è¯é¢˜å”¯ä¸€æ ‡è¯†ç¬¦\"\n          },\n          \"topic_title\": {\n            \"type\": \"string\",\n            \"description\": \"è¯é¢˜æ ‡é¢˜\"\n          },\n          \"topic_description\": {\n            \"type\": \"string\",\n            \"description\": \"è¯é¢˜è¯¦ç»†æè¿°ï¼ŒåŒ…å«å…³é”®è¯å’Œä¸»è¦å†…å®¹ï¼Œè‡³å°‘50å­—\",\n            \"minLength\": 50\n          },\n          \"is_off_topic\": {\n            \"type\": \"boolean\",\n            \"description\": \"æ ‡è®°æ˜¯å¦åç¦»ä¸»é¢˜\"\n          },\n          \"topic_start_time\": {\n            \"type\": \"string\",\n            \"description\": \"è¯é¢˜å¼€å§‹æ—¶é—´\",\n            \"format\": \"date-time\"\n          },\n          \"topic_end_time\": {\n            \"type\": \"string\",\n            \"description\": \"è¯é¢˜ç»“æŸæ—¶é—´\",\n            \"format\": \"date-time\"\n          },\n          \"message_seqs\": {\n            \"type\": \"array\",\n            \"items\": {\n              \"type\": \"string\",\n              \"description\": \"æ¶ˆæ¯åºåˆ—å·\"\n            },\n            \"minItems\": 1\n          }\n        }\n      },\n      \"minItems\": 1\n    }\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1328,
        816
      ],
      "id": "38eebd2b-79db-4cf4-8778-79b35f256b72",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "jsCode": "// Author: Gemini\n// Date: 2025-07-04\n// Description: This version corrects the data access path within the .map() function.\n// It now correctly reads `item.json.output` based on the actual output from the LLM node,\n// resolving the 'Cannot read properties of undefined' error.\n\n/**\n * Robustly maps a segment string to a Chinese time segment name.\n * @param {string} segmentInput - The segment string, e.g., \"19:30-20:00\" or \"å‚æ™š\".\n * @returns {string} The corresponding Chinese segment name, e.g., \"æ™šä¸Š\".\n */\nfunction mapTimeToChineseSegment(segmentInput) {\n  if (!segmentInput || typeof segmentInput !== 'string') {\n    return \"æœªçŸ¥æ—¶æ®µ\";\n  }\n  const startHour = parseInt(segmentInput.split(':')[0], 10);\n  if (isNaN(startHour)) {\n    return segmentInput;\n  }\n  if (startHour >= 0 && startHour < 6) return \"æ·±å¤œ\";\n  if (startHour >= 6 && startHour < 9) return \"æ—©æ™¨\";\n  if (startHour >= 9 && startHour < 12) return \"ä¸Šåˆ\";\n  if (startHour >= 12 && startHour < 14) return \"ä¸­åˆ\";\n  if (startHour >= 14 && startHour < 18) return \"ä¸‹åˆ\";\n  if (startHour >= 18 && startHour < 22) return \"æ™šä¸Š\";\n  if (startHour >= 22 && startHour <= 23) return \"æ·±å¤œ\";\n  return \"æœªçŸ¥æ—¶æ®µ\";\n}\n\n// --- Main Logic (Rebuilt) ---\n\n// **THE ONLY FIX IS ON THIS LINE**\n// Correctly access the data from the actual LLM output structure.\nconst analysisResults = items.map(item => item.json.output);\n\nif (!analysisResults || analysisResults.length === 0) {\n  return { json: { error: \"Input data is empty or invalid.\" } };\n}\n\nconst all_topics = [];\nconst sources_info = {};\nconst segments_info = {};\nlet topic_counter = 1;\n\n// A single, robust loop to process all inputs and aggregate correctly.\nfor (const result of analysisResults) {\n  if (!result || !result.topics || !Array.isArray(result.topics)) {\n    continue;\n  }\n\n  const source_name = result.meta.source;\n  const chinese_segment_name = mapTimeToChineseSegment(result.meta.segment);\n  const created_at = result.created_at || new Date().toISOString();\n  const segment_key = `${source_name}_${chinese_segment_name}`;\n\n  // --- Step 1: Aggregate Metadata in Real-time ---\n  if (!segments_info[segment_key]) {\n    segments_info[segment_key] = {\n      source_name: source_name,\n      segment_name: chinese_segment_name,\n      analysis_id: `${source_name}_${result.meta.date}_${chinese_segment_name}_analysis`,\n      created_at: created_at,\n      meta: {\n        source: source_name,\n        date: result.meta.date,\n        segment: chinese_segment_name,\n        total_messages: 0,\n      },\n      topics_count: 0,\n    };\n  }\n  segments_info[segment_key].topics_count += result.topics.length;\n  segments_info[segment_key].meta.total_messages += (result.meta.total_messages || 0);\n\n  // --- Step 2: Process Topics and Link to the *Correct* Aggregated Metadata ---\n  for (const topic of result.topics) {\n    const topic_seq = topic.topic_seq || [];\n    const message_count = topic_seq.length;\n\n    const topic_data = {\n      physical_id: `topic_${String(topic_counter).padStart(3, '0')}`,\n      original_topic_id: topic.topic_id,\n      topic_title: topic.topic_title,\n      topic_description: topic.topic_description,\n      is_off_topic: topic.is_off_topic,\n      topic_seq: topic_seq,\n      message_count: (topic.message_seqs || []).length,\n      chat_count:  (topic.message_seqs || []).length,\n      topic_start_time: topic.topic_start_time || new Date().toISOString(),\n      topic_end_time: topic.topic_end_time || new Date().toISOString(),\n      source_name: source_name,\n      segment_name: chinese_segment_name,\n      analysis_id: segments_info[segment_key].analysis_id,\n      created_at: created_at,\n      analysis_meta: segments_info[segment_key].meta,\n    };\n\n    all_topics.push(topic_data);\n    topic_counter++;\n  }\n}\n\n// --- Step 3: Final Aggregation for sources_metadata (can be done after the loop) ---\nall_topics.forEach(topic => {\n    if (!sources_info[topic.source_name]) {\n        sources_info[topic.source_name] = { source_name: topic.source_name, segments: [], total_topics: 0 };\n    }\n    if (!sources_info[topic.source_name].segments.includes(topic.segment_name)) {\n        sources_info[topic.source_name].segments.push(topic.segment_name);\n    }\n});\nObject.keys(sources_info).forEach(sourceName => {\n    sources_info[sourceName].total_topics = all_topics.filter(t => t.source_name === sourceName).length;\n});\n\n\n// --- Final Assembly ---\nconst on_topic_count = all_topics.filter(t => !t.is_off_topic).length;\nconst off_topic_count = all_topics.filter(t => t.is_off_topic).length;\nconst total_message_seqs = all_topics.reduce((sum, t) => sum + t.message_count, 0);\nconst total_original_messages = Object.values(segments_info).reduce((sum, s) => sum + s.meta.total_messages, 0);\nconst topics_by_source = Object.entries(sources_info).reduce((acc, [key, value]) => {\n  acc[key] = value.total_topics;\n  return acc;\n}, {});\n\nconst physical_merged = {\n  step: \"2_topic_merged\",\n  description: \"æ—¶é—´åˆ†æ®µåˆ†æåçš„æ‰€æœ‰è¯é¢˜ç‰©ç†åˆå¹¶ï¼Œæœªè¿›è¡Œè¯­ä¹‰åˆå¹¶\",\n  merge_timestamp: new Date().toISOString(),\n  merge_date: analysisResults[0]?.meta?.date || new Date().toISOString().split('T')[0],\n  merge_type: \"physical\",\n  total_topics: all_topics.length,\n  total_sources: Object.keys(sources_info).length,\n  total_segments: Object.keys(segments_info).length,\n  all_topics: all_topics,\n  sources_metadata: sources_info,\n  segments_metadata: segments_info,\n  statistics: {\n    on_topic_count,\n    off_topic_count,\n    total_message_seqs,\n    total_original_messages,\n    topics_by_source\n  }\n};\n\nreturn { json: physical_merged };"
      },
      "id": "1be4c928-a056-4360-a32a-85469b2498e4",
      "name": "Merge & Deduplicate Topics",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        688
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯èŠå¤©è¯é¢˜æ™ºèƒ½åˆå¹¶ä¸“å®¶ã€‚ä½ çš„æ ¸å¿ƒä»»åŠ¡æ˜¯åˆ†æå·²ç‰©ç†åˆå¹¶çš„è¯é¢˜åˆ—è¡¨ï¼Œæ‰¾å‡ºè¯­ä¹‰ç›¸å…³çš„è¯é¢˜ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªåŒ…å«åˆå¹¶å…³ç³»å’ŒAIæ€»ç»“å†…å®¹çš„æ–°JSONã€‚\n\n### æ ¸å¿ƒåˆå¹¶åŸåˆ™ (å¿…é¡»ä¸¥æ ¼éµå®ˆ)\n\n1.  **è¯­ä¹‰ä¸ºç‹**: å¿…é¡»åŸºäºè¯é¢˜æè¿° (`topic_description`) çš„**æ·±å±‚è¯­ä¹‰**è¿›è¡Œåˆå¹¶ï¼Œè€Œä¸æ˜¯ç®€å•çš„å…³é”®è¯åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œâ€œClaudeè¿ä¸ä¸Šâ€å’Œâ€œæˆ‘çš„Claudeä»Šå¤©å“åº”å¾ˆæ…¢â€åº”è¯¥åˆå¹¶ï¼Œä½†â€œClaudeä½¿ç”¨æŠ€å·§â€å’Œâ€œGeminiä½¿ç”¨æŠ€å·§â€åˆ™**ç»å¯¹ä¸èƒ½**åˆå¹¶ã€‚\n2. **åˆå¹¶æ¡ä»¶**ï¼š\n   - è¯­ä¹‰ç›¸ä¼¼åº¦ > 0.7\n   - å‚ä¸è€…é‡å åº¦ > 0.3\n   - æ—¶é—´è·¨åº¦åˆç†ï¼ˆä¸è¶…è¿‡4å°æ—¶ï¼‰\n3.  **ä¿å®ˆç­–ç•¥**: \n    - å®å¯ä¿ç•™æ›´å¤šç‹¬ç«‹çš„ã€æœ‰ä»·å€¼çš„å°è¯é¢˜ï¼Œä¹Ÿç»ä¸é”™è¯¯åœ°å°†ä¸ç›¸å…³çš„è¯é¢˜åˆå¹¶æˆä¸€ä¸ªæ¨¡ç³Šçš„å¤§æ‚çƒ©ã€‚\n    - å¦‚æœä½ æ²¡æœ‰70%ä»¥ä¸Šçš„æŠŠæ¡ï¼Œå°±é€‰æ‹©ä¸åˆå¹¶ã€‚\n4.  **è´¨é‡æå‡**: \n    - åˆå¹¶åè¯é¢˜åº”è¯¥æ¯”åŸè¯é¢˜æ›´æœ‰ä»·å€¼ï¼Œå…¶æ ‡é¢˜å’Œæè¿°å¿…é¡»æ¯”åŸå§‹è¯é¢˜æ›´å…·ä¿¡æ¯é‡ã€æ›´ç²¾ç‚¼ã€æ›´èƒ½ä½“ç°è®¨è®ºçš„ç²¾å\n    - é¿å…ä¸ºäº†åˆå¹¶è€Œåˆå¹¶ï¼Œä¿æŒè¯é¢˜çš„ç‹¬ç«‹æ€§\n    - åˆå¹¶æ•°é‡æ§åˆ¶åœ¨2-4ä¸ªè¯é¢˜ä¹‹é—´\n\n### å†…å®¹ç”Ÿæˆè¦æ±‚\n\n1.  **åˆå¹¶åæ ‡é¢˜ (`merged_title`)**: ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ã€é«˜åº¦æ¦‚æ‹¬çš„ã€èƒ½ä½“ç°è®¨è®ºæ ¸å¿ƒçš„ç²¾ç¡®æ ‡é¢˜ã€‚\n2.  **åˆå¹¶åæè¿° (`merged_description`)**: **ä¸¥æ ¼åŸºäº**æ‰€æœ‰è¢«åˆå¹¶è¯é¢˜çš„**åŸå§‹å†…å®¹**è¿›è¡Œæ€»ç»“ã€‚å¿…é¡»æ¸…æ™°åœ°è¯´æ˜è®¨è®ºçš„å®Œæ•´è„‰ç»œã€æ ¸å¿ƒè§‚ç‚¹ã€ä¸»è¦é—®é¢˜å’Œç»“è®ºã€‚**ä¸¥ç¦**ç¼–é€ ã€è‡†æµ‹æˆ–æ·»åŠ ä»»ä½•åŸå§‹å¯¹è¯ä¸­ä¸å­˜åœ¨çš„ä¿¡æ¯ã€‚**ä¸¥ç¦**å‡ºç°â€œåˆå¹¶äº†Xä¸ªè¯é¢˜â€è¿™ç§ç©ºæ´çš„æ ¼å¼åŒ–æè¿°ã€‚\n3.  **è¯é¢˜æ ‡ç­¾ (`topic_tags`)**: åˆ©ç”¨ä½ æœ€æ–°çš„çŸ¥è¯†åº“ï¼Œä¸ºæ¯ä¸ªåˆå¹¶åçš„è¯é¢˜ç”Ÿæˆ2-4ä¸ªä¸æ—¶ä¿±è¿›çš„ã€ä¸šå†…è®¤å¯çš„æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼š`RAG`, `Fine-tuning`, `AI Agent`, `Claude 3.5 Sonnet`, `n8n` ç­‰ã€‚\n\n### ç»å¯¹è¾“å‡ºè¦æ±‚ (æœ€é‡è¦)\n\n1.  **çº¯JSON**: **åªå…è®¸**è¾“å‡ºæœ‰æ•ˆçš„JSONå¯¹è±¡ã€‚\n2.  **ç¦æ­¢Markdown**: **ä¸¥ç¦**åœ¨è¾“å‡ºçš„ä»»ä½•ä½ç½®ä½¿ç”¨ ` ```json ` æˆ– ` ``` ` è¿›è¡ŒåŒ…è£¹ã€‚\n3.  **ç¦æ­¢è§£é‡Š**: **ä¸¥ç¦**åœ¨JSONå¯¹è±¡å‰åæ·»åŠ ä»»ä½•å½¢å¼çš„è§£é‡Šæ€§æ–‡å­—æˆ–æ³¨é‡Šã€‚\n\n---\n### è¾“å‡ºJSONæ ¼å¼ (ä¸¥æ ¼éµå®ˆæ­¤ç»“æ„)\n\nä½ çš„å“åº”å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ JSON å¯¹è±¡ï¼Œä¸”åªèƒ½æ˜¯ JSON å¯¹è±¡ã€‚ä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„æ–‡æœ¬ã€è§£é‡Šæˆ– Markdown ä»£ç å—ï¼ˆä¾‹å¦‚ï¼Œ```jsonï¼‰ã€‚\n\n```json\n{\n  \"merged_topics\": [\n    {\n      \"semantic_topic_id\": \"merged_001\",\n      \"merged_title\": \"åŸºäºè¯­ä¹‰åˆ†æçš„ç²¾ç¡®æ ‡é¢˜\",\n      \"merged_description\": \"ç»¼åˆæè¿°ï¼šè¯¦ç»†è¯´æ˜åˆå¹¶åè¯é¢˜çš„å®Œæ•´å†…å®¹è„‰ç»œã€æ ¸å¿ƒè§‚ç‚¹ã€è®¨è®ºèŒƒå›´å’Œä¸»è¦ç»“è®ºã€‚\",\n      \"is_off_topic\": false,\n      \"semantic_category\": \"è®¨è®ºç±»å‹ (ä¾‹å¦‚: 'é—®é¢˜æ±‚åŠ©', 'ç»éªŒåˆ†äº«', 'æŠ€æœ¯æ¢è®¨')\",\n      \"topic_tags\": [\"AIç”Ÿæˆæ ‡ç­¾1\", \"AIç”Ÿæˆæ ‡ç­¾2\"],\n      \"merged_from\": [\n        {\n          \"physical_id\": \"è¢«åˆå¹¶çš„åŸå§‹è¯é¢˜ID (ä¾‹å¦‚: topic_001)\",\n          \"original_title\": \"è¢«åˆå¹¶çš„åŸå§‹è¯é¢˜çš„æ ‡é¢˜\"\n        }\n      ],\n      \"relevance_score\": 0.85,\n      \"confidence_level\": \"high\"\n    }\n  ],\n  \"merge_metadata\": {\n    \"merge_algorithm\": \"deep_semantic_analysis\",\n    \"total_merges_performed\": 1,\n    \"compression_achieved\": \"50%\"\n  }\n}\n```\n\n---\n### å¾…åˆ†æçš„ç‰©ç†åˆå¹¶åçš„è¯é¢˜æ•°æ®\n\n{{ JSON.stringify($json) }}",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1824,
        480
      ],
      "id": "4216b291-74c5-41f0-bb44-8e53ca8beb77",
      "name": "AI Semantic Merge"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"merged_topics\": [\n    {\n      \"semantic_topic_id\": \"merged_001\",\n      \"merged_title\": \"åŸºäºè¯­ä¹‰åˆ†æçš„ç²¾ç¡®æ ‡é¢˜\",\n      \"merged_description\": \"ç»¼åˆæè¿°ï¼šè¯¦ç»†è¯´æ˜åˆå¹¶åè¯é¢˜çš„å®Œæ•´å†…å®¹è„‰ç»œã€æ ¸å¿ƒè§‚ç‚¹ã€è®¨è®ºèŒƒå›´å’Œä¸»è¦ç»“è®ºã€‚\",\n      \"is_off_topic\": false,\n      \"semantic_category\": \"è®¨è®ºç±»å‹ (ä¾‹å¦‚: 'é—®é¢˜æ±‚åŠ©', 'ç»éªŒåˆ†äº«', 'æŠ€æœ¯æ¢è®¨')\",\n      \"topic_tags\": [\"AIç”Ÿæˆæ ‡ç­¾1\", \"AIç”Ÿæˆæ ‡ç­¾2\"],\n      \"merged_from\": [\n        {\n          \"physical_id\": \"è¢«åˆå¹¶çš„åŸå§‹è¯é¢˜ID (ä¾‹å¦‚: topic_001)\",\n          \"original_title\": \"è¢«åˆå¹¶çš„åŸå§‹è¯é¢˜çš„æ ‡é¢˜\"\n        }\n      ],\n      \"relevance_score\": 0.85,\n      \"confidence_level\": \"high\"\n    }\n  ],\n  \"merge_metadata\": {\n    \"merge_algorithm\": \"deep_semantic_analysis\",\n    \"total_merges_performed\": 1,\n    \"compression_achieved\": \"50%\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2032,
        800
      ],
      "id": "a8404a59-8fc2-4bb0-b6b2-5ae167d2da29",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "content": "## æ™ºèƒ½è¯é¢˜å½’å¹¶\n\n- å°†ç›¸ä¼¼æˆ–ç›¸å…³çš„è¯é¢˜è¿›è¡Œæ™ºèƒ½åˆå¹¶ï¼Œå½¢æˆæ›´å®è§‚ã€æœ‰æ„ä¹‰çš„è¯é¢˜ã€‚\n- å°†æ‰€æœ‰å¤„ç†è¿‡çš„è¯é¢˜æ•°æ®ç»„è£…æˆæœ€ç»ˆæŠ¥å‘Šæ‰€éœ€çš„ç»“æ„æˆ–å†…å®¹ã€‚\n",
        "height": 740,
        "width": 620,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1760,
        208
      ],
      "id": "5db9213d-6165-4c25-9e75-514de24b79fb",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "// Author: Gemini\n// Date: 2025-07-05\n// Description: This version integrates all_links, active_users, and raw_message_sample\n// from upstream nodes into the final report structure.\n\n/**\n * Robustly maps a segment string to a Chinese time segment name.\n * This function is likely from an upstream node, but included for completeness if needed.\n * @param {string} segmentInput - The segment string, e.g., \"19:30-20:00\" or \"å‚æ™š\".\n * @returns {string} The corresponding Chinese segment name, e.g., \"æ™šä¸Š\".\n */\nfunction mapTimeToChineseSegment(segmentInput) {\n  if (!segmentInput || typeof segmentInput !== 'string') {\n    return \"æœªçŸ¥æ—¶æ®µ\";\n  }\n  const startHour = parseInt(segmentInput.split(':')[0], 10);\n  if (isNaN(startHour)) {\n    return segmentInput;\n  }\n  if (startHour >= 0 && startHour < 6) return \"æ·±å¤œ\";\n  if (startHour >= 6 && startHour < 9) return \"æ—©æ™¨\";\n  if (startHour >= 9 && startHour < 12) return \"ä¸Šåˆ\";\n  if (startHour >= 12 && startHour < 14) return \"ä¸­åˆ\";\n  if (startHour >= 14 && startHour < 18) return \"ä¸‹åˆ\";\n  if (startHour >= 18 && startHour < 22) return \"æ™šä¸Š\";\n  if (startHour >= 22 && startHour <= 23) return \"æ·±å¤œ\";\n  return \"æœªçŸ¥æ—¶æ®µ\";\n}\n\n// --- Main Logic ---\n\n// Step 1: Get the required data sources\n// $input.first() refers to the first input connected to this node (likely \"AI Semantic Merge\")\nconst aiMergeResult = $input.first().json.output;\n// $('Node Name') refers to data from a specific node by its name\nconst physicalMergeResult = $('Merge & Deduplicate Topics').first().json;\n\n// Get data from the newly added nodes\n// Ensure 'Extract Links & Active Users' is the exact name of your node in n8n\nconst linksAndUsersData = $('Extract Links & Active Users').first().json;\nconst all_links = linksAndUsersData.all_links;\nconst active_users = linksAndUsersData.active_users;\n\n// Ensure 'Prepare Raw Message Sample' is the exact name of your node in n8n\nconst rawSampleData = $('Prepare Raw Message Sample').first().json;\nconst raw_message_sample = rawSampleData.raw_message_sample;\n\n\nif (!aiMergeResult || !physicalMergeResult || !linksAndUsersData || !rawSampleData) {\n  return { json: { error: \"Missing one or more required inputs. Check node connections and names.\" } };\n}\n\n// Step 2: Create a fast lookup map for all original topics\nconst allTopicsMap = new Map(physicalMergeResult.all_topics.map(t => [t.physical_id, t]));\n\n// Step 3: Iterate through the AI's decisions and assemble the enriched topics\nconst enhanced_merged_topics = [];\nfor (const aiTopic of aiMergeResult.merged_topics) {\n  const combined_seqs_nested = [];\n  const seq_source_mapping = {};\n\n  for (const source of aiTopic.merged_from) {\n    const physical_id = source.physical_id;\n    const originalTopic = allTopicsMap.get(physical_id);\n\n    if (originalTopic) {\n      combined_seqs_nested.push(originalTopic.topic_seq);\n      for (const seq of originalTopic.topic_seq) {\n        if (!seq_source_mapping[seq]) {\n          seq_source_mapping[seq] = {\n            source_name: originalTopic.source_name,\n            segment_name: originalTopic.segment_name,\n            analysis_id: originalTopic.analysis_id,\n            topic_start_time: originalTopic.topic_start_time,\n            topic_end_time: originalTopic.topic_end_time\n          };\n        }\n      }\n    }\n  }\n\n  // Flatten combined_seqs_nested and remove duplicates\n  const combined_message_seqs = [...new Set(combined_seqs_nested.flat())].sort((a, b) => a - b);\n\n  // Calculate total_combined_messages and chat_count\n  const total_combined_messages = combined_message_seqs.length;\n  const chat_count = total_combined_messages; // Assuming chat_count is same as message count for now\n\n  // Determine message_time_range\n  let earliest_seq_time = null;\n  let latest_seq_time = null;\n\n  if (combined_message_seqs.length > 0) {\n    // Find the earliest and latest time from the original messages based on seq\n    // This requires access to the original messages from \"Parse & Structure Data\"\n    // For simplicity, we'll use the topic_start_time and topic_end_time from originalTopic\n    // as provided by \"Merge & Deduplicate Topics\" node.\n    // If more granular message-level time is needed, you'd need to pass the full\n    // original messages array or a lookup map from \"Parse & Structure Data\" node.\n\n    // For now, we'll use the min/max of the original topics' start/end times\n    let minTime = Infinity;\n    let maxTime = -Infinity;\n\n    for (const source of aiTopic.merged_from) {\n      const originalTopic = allTopicsMap.get(source.physical_id);\n      if (originalTopic) {\n        const startTime = new Date(originalTopic.topic_start_time).getTime();\n        const endTime = new Date(originalTopic.topic_end_time).getTime();\n        if (startTime < minTime) minTime = startTime;\n        if (endTime > maxTime) maxTime = endTime;\n      }\n    }\n    earliest_seq_time = minTime !== Infinity ? new Date(minTime).toISOString() : null;\n    latest_seq_time = maxTime !== -Infinity ? new Date(maxTime).toISOString() : null;\n  }\n\n\n  enhanced_merged_topics.push({\n    semantic_topic_id: aiTopic.semantic_topic_id,\n    merged_title: aiTopic.merged_title,\n    merged_description: aiTopic.merged_description,\n    is_off_topic: aiTopic.is_off_topic,\n    semantic_category: aiTopic.semantic_category,\n    topic_tags: aiTopic.topic_tags,\n    merged_from: aiTopic.merged_from,\n    relevance_score: aiTopic.relevance_score,\n    confidence_level: aiTopic.confidence_level,\n    combined_message_seqs: combined_message_seqs,\n    total_combined_messages: total_combined_messages,\n    chat_count: chat_count,\n    seq_source_mapping: seq_source_mapping,\n    message_time_range: {\n      earliest_seq: combined_message_seqs.length > 0 ? combined_message_seqs[0] : null,\n      latest_seq: combined_message_seqs.length > 0 ? combined_message_seqs[combined_message_seqs.length - 1] : null,\n      seq_count: combined_message_seqs.length,\n      earliest_time: earliest_seq_time, // Use calculated earliest time\n      latest_time: latest_seq_time // Use calculated latest time\n    }\n  });\n}\n\n// Prepare the final output\nconst now = new Date();\nreturn [{\n  json: {\n    merge_timestamp: now.toISOString(),\n    merge_date: now.toISOString().split('T')[0], // Just the date part\n    merge_type: \"semantic\",\n    original_topics_count: physicalMergeResult.all_topics.length,\n    merged_topics_count: enhanced_merged_topics.length,\n    compression_ratio: (1 - enhanced_merged_topics.length / physicalMergeResult.all_topics.length) * 100,\n    merged_topics: enhanced_merged_topics,\n    merge_metadata: aiMergeResult.merge_metadata,\n    original_statistics: physicalMergeResult.statistics,\n    sources_metadata: physicalMergeResult.sources_metadata,\n    segments_metadata: physicalMergeResult.segments_metadata,\n    global_seq_index: physicalMergeResult.global_seq_index, // Ensure this field exists and is passed\n\n    // Newly added fields\n    all_links: all_links,\n    active_users: active_users,\n    raw_message_sample: raw_message_sample\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2208,
        480
      ],
      "id": "a7a329b4-c5d2-4783-8dcc-6728312c7c2f",
      "name": "Assemble Final Report"
    },
    {
      "parameters": {
        "jsCode": "// è·å–AI Agentçš„è¾“å‡º\nlet aiOutput;\ntry {\n  // é¦–å…ˆæ£€æŸ¥è¾“å…¥æ•°æ®ç»“æ„\n  const inputData = $input.first().json;\n  console.log('Input data structure:', JSON.stringify(inputData, null, 2));\n  \n  // å°è¯•ä¸åŒçš„æ•°æ®ç»“æ„è·¯å¾„\n  if (inputData.choices && inputData.choices[0] && inputData.choices[0].message) {\n    // OpenAI API æ ‡å‡†æ ¼å¼\n    aiOutput = inputData.choices[0].message.content;\n  } else if (inputData.message && inputData.message.content) {\n    // ç®€åŒ–çš„æ¶ˆæ¯æ ¼å¼\n    aiOutput = inputData.message.content;\n  } else if (inputData.content) {\n    // ç›´æ¥å†…å®¹æ ¼å¼\n    aiOutput = inputData.content;\n  } else if (inputData.output) {\n    // è¾“å‡ºå­—æ®µæ ¼å¼\n    aiOutput = inputData.output;\n  } else if (typeof inputData === 'string') {\n    // çº¯å­—ç¬¦ä¸²æ ¼å¼\n    aiOutput = inputData;\n  } else {\n    // å¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œå°è¯•æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å€¼\n    const findStringValue = (obj) => {\n      if (typeof obj === 'string') return obj;\n      if (Array.isArray(obj)) {\n        for (const item of obj) {\n          const result = findStringValue(item);\n          if (result) return result;\n        }\n      } else if (typeof obj === 'object' && obj !== null) {\n        for (const key in obj) {\n          const result = findStringValue(obj[key]);\n          if (result) return result;\n        }\n      }\n      return null;\n    };\n    \n    aiOutput = findStringValue(inputData);\n    \n    if (!aiOutput) {\n      throw new Error('æ— æ³•åœ¨è¾“å…¥æ•°æ®ä¸­æ‰¾åˆ°AIè¾“å‡ºå†…å®¹');\n    }\n  }\n  \n  console.log('Found AI output:', aiOutput.substring(0, 200) + '...');\n  \n} catch (error) {\n  console.error('è·å–AIè¾“å‡ºæ—¶å‡ºé”™:', error);\n  return [{\n    json: {\n      error: 'æ— æ³•è·å–AIè¾“å‡º: ' + error.message,\n      inputData: $input.first().json,\n      status: 'error'\n    }\n  }];\n}\n\n// æ¸…ç†å¯èƒ½çš„markdownæ ‡è®°\nlet htmlContent = aiOutput;\nif (htmlContent.includes('```html')) {\n  htmlContent = htmlContent.replace(/```html\\n?/g, '').replace(/\\n?```/g, '');\n}\nif (htmlContent.includes('```')) {\n  htmlContent = htmlContent.replace(/```\\n?/g, '').replace(/\\n?```/g, '');\n}\n\n// è·å–ç¾¤èŠåç§°å’Œæ—¥æœŸï¼ˆä»å·¥ä½œæµè¾“å…¥æˆ–è®¾ç½®é»˜è®¤å€¼ï¼‰\nconst groupName = $('ConfigureChatParameters').first().json.group_name || 'unknown';\nconst date = $('ConfigureChatParameters').first().json.date || new Date().toISOString().split('T')[0];\n\nconsole.log('ç¾¤èŠä¿¡æ¯:', { groupName, date });\n\n// ğŸ”¥ æ”¹è¿›ï¼šæ™ºèƒ½HTMLå†…å®¹æ¸…ç† - ä¿æŠ¤å›¾è¡¨å’Œè„šæœ¬å†…å®¹\nconsole.log('å¼€å§‹HTMLæ¸…ç†ï¼ŒåŸå§‹é•¿åº¦:', htmlContent.length);\n\n// æ™ºèƒ½æ¸…ç†HTMLå†…å®¹ï¼Œä¿æŠ¤é‡è¦çš„ä»£ç åŒºåŸŸ\nconst smartCleanHtmlForMCP = (html) => {\n  // 1. é¦–å…ˆä¿æŠ¤é‡è¦çš„ä»£ç åŒºåŸŸ\n  const protectedSections = [];\n  let cleanedHtml = html;\n  \n  // ä¿æŠ¤ script æ ‡ç­¾å†…å®¹ï¼ˆåŒ…æ‹¬ mermaid, chart.js ç­‰ï¼‰\n  cleanedHtml = cleanedHtml.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_SCRIPT_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // ä¿æŠ¤ style æ ‡ç­¾å†…å®¹\n  cleanedHtml = cleanedHtml.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_STYLE_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // ä¿æŠ¤ pre æ ‡ç­¾å†…å®¹ï¼ˆå¯èƒ½åŒ…å«å›¾è¡¨å®šä¹‰ï¼‰\n  cleanedHtml = cleanedHtml.replace(/<pre[^>]*>[\\s\\S]*?<\\/pre>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_PRE_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // ä¿æŠ¤å…·æœ‰ç‰¹æ®Šclassçš„divï¼ˆå¦‚mermaidå›¾è¡¨å®¹å™¨ï¼‰\n  cleanedHtml = cleanedHtml.replace(/<div[^>]*class=\"[^\"]*(?:mermaid|chart|graph|diagram)[^\"]*\"[^>]*>[\\s\\S]*?<\\/div>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_CHART_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // 2. å¯¹å…¶ä½™å†…å®¹è¿›è¡Œæ¸…ç†\n  cleanedHtml = cleanedHtml\n    // åªæ¸…ç†æ™®é€šçš„æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ï¼Œä½†ä¿ç•™å¿…è¦çš„æ ¼å¼\n    .replace(/[\\r]/g, '')           // ç§»é™¤å›è½¦ç¬¦\n    .replace(/\\n\\s*\\n/g, '\\n')      // å°†å¤šä¸ªæ¢è¡Œåˆå¹¶ä¸ºä¸€ä¸ª\n    .replace(/\\t/g, '  ')           // å°†åˆ¶è¡¨ç¬¦è½¬æ¢ä¸ºä¸¤ä¸ªç©ºæ ¼\n    // æ¸…ç†HTMLæ ‡ç­¾é—´çš„å¤šä½™ç©ºæ ¼ï¼Œä½†ä¸å½±å“æ–‡æœ¬å†…å®¹\n    .replace(/>\\s+</g, '><')\n    // æ¸…ç†è¡Œé¦–è¡Œå°¾ç©ºæ ¼\n    .replace(/^\\s+|\\s+$/gm, '')\n    // å°†å¤šä¸ªè¿ç»­ç©ºæ ¼åˆå¹¶ï¼Œä½†ä¿ç•™å•ä¸ªæ¢è¡Œ\n    .replace(/ +/g, ' ');\n  \n  // 3. æ¢å¤å—ä¿æŠ¤çš„å†…å®¹\n  protectedSections.forEach((section, index) => {\n    const scriptPlaceholder = `__PROTECTED_SCRIPT_${index}__`;\n    const stylePlaceholder = `__PROTECTED_STYLE_${index}__`;\n    const prePlaceholder = `__PROTECTED_PRE_${index}__`;\n    const chartPlaceholder = `__PROTECTED_CHART_${index}__`;\n    \n    cleanedHtml = cleanedHtml.replace(scriptPlaceholder, section);\n    cleanedHtml = cleanedHtml.replace(stylePlaceholder, section);\n    cleanedHtml = cleanedHtml.replace(prePlaceholder, section);\n    cleanedHtml = cleanedHtml.replace(chartPlaceholder, section);\n  });\n  \n  // 4. æœ€ååªå¯¹JSONä¼ è¾“åšå¿…è¦çš„è½¬ä¹‰\n  return cleanedHtml\n    .replace(/\\\\/g, '\\\\\\\\')    // è½¬ä¹‰åæ–œæ \n    .replace(/\"/g, '\\\\\"');     // è½¬ä¹‰åŒå¼•å·\n};\n\n// åº”ç”¨æ™ºèƒ½æ¸…ç†\nconst originalHtmlContent = htmlContent;\nhtmlContent = smartCleanHtmlForMCP(htmlContent);\n\nconsole.log('æ™ºèƒ½HTMLæ¸…ç†å®Œæˆ');\nconsole.log('- åŸå§‹é•¿åº¦:', originalHtmlContent.length);\nconsole.log('- æ¸…ç†åé•¿åº¦:', htmlContent.length);\nconsole.log('- èŠ‚çœç©ºé—´:', originalHtmlContent.length - htmlContent.length, 'bytes');\n\n// æ£€æŸ¥æ˜¯å¦åŒ…å«å›¾è¡¨ç›¸å…³å†…å®¹\nconst hasCharts = originalHtmlContent.match(/(mermaid|chart\\.js|echarts|d3\\.js|plotly|canvas|svg)/i);\nif (hasCharts) {\n  console.log('âœ… æ£€æµ‹åˆ°å›¾è¡¨å†…å®¹ï¼Œå·²åº”ç”¨ä¿æŠ¤æ€§æ¸…ç†');\n} else {\n  console.log('â„¹ï¸ æœªæ£€æµ‹åˆ°å›¾è¡¨å†…å®¹');\n}\n\n// éªŒè¯HTMLæ–‡æ¡£å®Œæ•´æ€§\nif (!htmlContent.includes('<!DOCTYPE html>')) {\n  console.error('AIè¾“å‡ºä¸æ˜¯å®Œæ•´çš„HTMLæ–‡æ¡£');\n  return [{\n    json: {\n      error: 'AIè¾“å‡ºä¸æ˜¯å®Œæ•´çš„HTMLæ–‡æ¡£',\n      receivedContent: htmlContent.substring(0, 500),\n      status: 'error'\n    }\n  }];\n}\n\n// é¢å¤–çš„HTMLå†…å®¹éªŒè¯\nconst validateHtml = (html) => {\n  const checks = {\n    hasDoctype: html.includes('<!DOCTYPE html>'),\n    hasHtmlTag: html.includes('<html') && html.includes('</html>'),\n    hasHeadTag: html.includes('<head') && html.includes('</head>'),\n    hasBodyTag: html.includes('<body') && html.includes('</body>'),\n    hasTitle: html.includes('<title'),\n    isNotEmpty: html.length > 100,\n    hasChartLibraries: /(?:mermaid|chart\\.js|echarts|d3\\.js|plotly)/i.test(html)\n  };\n  \n  const passed = Object.values(checks).filter(Boolean).length;\n  const total = Object.keys(checks).length;\n  \n  console.log('HTMLéªŒè¯ç»“æœ:', checks);\n  console.log(`HTMLè´¨é‡è¯„åˆ†: ${passed}/${total}`);\n  \n  return { checks, score: passed / total };\n};\n\nconst validation = validateHtml(htmlContent);\n\n// ç”Ÿæˆæ–‡ä»¶å - ä½¿ç”¨ç¾¤èŠåç§°å’Œæ—¥æœŸ\nconst filename = `ç¾¤èŠæ—¥æŠ¥-${groupName}-${date}.html`;\nconst safeFilename = filename.replace(/[^a-z0-9\\u4e00-\\u9fa5_\\-\\.]/gi, '_');\n\nconsole.log('æ–‡ä»¶åç”Ÿæˆ:', { \n  original: filename, \n  safe: safeFilename,\n  groupName: groupName,\n  date: date \n});\n\n// ç”Ÿæˆæ¸…ç†åçš„HTMLç”¨äºMCPå·¥å…·\nconst mcpReadyHtml = htmlContent;\n\n// è®¡ç®—å¤„ç†æ—¶é•¿\nlet processDuration = null;\ntry {\n  const startTime = $('éªŒè¯è¾“å…¥å‚æ•°').item.json.process_start_time;\n  if (startTime) {\n    const startDate = new Date(startTime);\n    const endDate = new Date();\n    // è®¡ç®—ç§’æ•°å·®\n    processDuration = Math.round((endDate - startDate) / 1000);\n  }\n} catch (e) {\n  console.log('è®¡ç®—å¤„ç†æ—¶é•¿å¤±è´¥:', e.message);\n  processDuration = null;\n}\n\n\n// è¿”å›å¤„ç†ç»“æœ - åŒ…å«ä¸¤ä¸ªç‰ˆæœ¬çš„HTML\nreturn [{\n  json: {\n    // åŸå§‹HTMLï¼ˆç”¨äºæ–‡ä»¶ä¿å­˜ï¼‰\n    htmlContent: originalHtmlContent,\n    // æ¸…ç†åçš„HTMLï¼ˆç”¨äºMCPå·¥å…·è°ƒç”¨ï¼‰\n    mcpHtmlContent: mcpReadyHtml,\n    // æ–‡ä»¶ä¿¡æ¯ - ä½¿ç”¨ç¾¤èŠåç§°\n    filename: safeFilename,\n    originalFilename: filename,\n    groupName: groupName,\n    date: date,\n    process_end_time: $now.toISO(),\n    process_duration: processDuration,\n    timestamp: new Date().toISOString(),\n    status: 'success',\n    // ç»Ÿè®¡ä¿¡æ¯\n    originalContentLength: originalHtmlContent.length,\n    cleanedContentLength: mcpReadyHtml.length,\n    compressionRatio: ((originalHtmlContent.length - mcpReadyHtml.length) / originalHtmlContent.length * 100).toFixed(2) + '%',\n    // HTMLè´¨é‡ä¿¡æ¯\n    htmlValidation: validation,\n    hasChartContent: hasCharts !== null,\n    // è°ƒè¯•ä¿¡æ¯\n    processingSteps: [\n      'âœ… AIè¾“å‡ºè§£ææˆåŠŸ',\n      'âœ… Markdownæ¸…ç†å®Œæˆ', \n      'âœ… æ™ºèƒ½HTMLæ¸…ç†å®Œæˆï¼ˆä¿æŠ¤å›¾è¡¨ï¼‰',\n      'âœ… MCPæ ¼å¼ä¼˜åŒ–å®Œæˆ',\n      `âœ… HTMLéªŒè¯å®Œæˆ (${(validation.score * 100).toFixed(1)}%)`,\n      `âœ… æ–‡ä»¶åç”Ÿæˆå®Œæˆ: ${safeFilename}`\n    ]\n  },\n  binary: {\n    data: {\n      data: Buffer.from(originalHtmlContent, 'utf8').toString('base64'),\n      mimeType: 'text/html',\n      fileName: safeFilename,\n      fileExtension: 'html'\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2800,
        480
      ],
      "id": "97e65b03-861e-498b-b87e-7d82fc22aa3f",
      "name": "å¤„ç†AIè¾“å‡º"
    },
    {
      "parameters": {
        "content": "## æœ€ç»ˆHTMLå†…å®¹å¤„ç†\n",
        "height": 740,
        "width": 780,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2416,
        192
      ],
      "id": "dc0f78cd-21c3-482f-ad81-cca1909e8c44",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "jsCode": "// Node: Extract Links & Active Users\n// Input: Output from \"Parse & Structure Data\" node (single JSON object with sources.messages)\n// Output: JSON with all_links array (objects with url, sender, time, context) and active_users array\n\nconst inputData = $input.first().json; // Get the single item from \"Parse & Structure Data\"\n\n\nif (!inputData || !inputData.sources) {\n  console.log(\"Input data is missing structuredData or sources field.\");\n  return { json: { all_links: [], active_users: [] } };\n}\n\n// Assuming only one source, get its messages list\nconst sourceName = Object.keys(inputData.sources)[0];\nconst allMessages = inputData.sources[sourceName].messages;\n\nif (!allMessages || allMessages.length === 0) {\n  console.log(\"No messages found in structured data.\");\n  return { json: { all_links: [], active_users: [] } };\n}\n\nconst allLinks = []; // Now an array of objects\nconst senderMessageCounts = {}; // Store message counts for active users\n\n// Regex for raw URLs (http or https)\nconst rawUrlRegex = /(https?:\\/\\/[^\\s]+)/g;\n// Regex for [é“¾æ¥|URL] format\nconst formattedLinkRegex = /\\[é“¾æ¥\\|(https?:\\/\\/[^\\]]+)\\]/g;\n\nconsole.log(`Processing ${allMessages.length} messages.`);\n\nfor (const message of allMessages) {\n  const senderName = message.sender_name;\n  const messageTime = message.time;\n  const messageContent = message.content;\n\n  //console.log(`--- Processing Message ---`);\n  //console.log(`Raw senderName: '${senderName}'`);\n  //console.log(`Message content: '${messageContent}'`);\n\n  // Check senderName validity for active users\n  const isValidSender = senderName && senderName.trim() !== '' && senderName !== 'ç³»ç»Ÿæ¶ˆæ¯';\n  \n\n  if (messageContent) {\n    const extractedUrls = []; // Temporarily store all URLs found in this message\n    let linkMatch;\n    \n    // Extract raw URLs\n    rawUrlRegex.lastIndex = 0; // Reset regex lastIndex for global regex\n    while ((linkMatch = rawUrlRegex.exec(messageContent)) !== null) {\n      extractedUrls.push(linkMatch[0]);\n    }\n\n    // Extract formatted links [é“¾æ¥|URL]\n    formattedLinkRegex.lastIndex = 0; // Reset regex lastIndex for global regex\n    while ((linkMatch = formattedLinkRegex.exec(messageContent)) !== null) {\n      extractedUrls.push(linkMatch[1]);\n    }\n\n    for (const url of extractedUrls) {\n      // Check if this URL is part of an image or video markdown\n      const isImageOrVideoLink = messageContent.includes(`![å›¾ç‰‡]`) || messageContent.includes(`![è§†é¢‘]`);\n      if (!isImageOrVideoLink) {\n        //console.log(`Found valid link: ${url}`);\n        allLinks.push({\n          url: url,\n          sender: senderName,\n          time: messageTime,\n          context: messageContent\n        });\n      } else {\n        console.log(`Excluded image/video link: ${url}`);\n      }\n    }\n  }\n\n  // Count active users (only for valid senders)\n  if (isValidSender) {\n    //console.log(`Counting message for sender: ${senderName}`);\n    senderMessageCounts[senderName] = (senderMessageCounts[senderName] || 0) + 1;\n  }\n}\n\nconsole.log(`Final allLinks count: ${allLinks.length}`);\nconsole.log(`Final activeUsers count: ${Object.keys(senderMessageCounts).length}`);\n\n// Convert senderMessageCounts to active_users array and sort\nconst activeUsers = Object.entries(senderMessageCounts)\n  .map(([sender_name, message_count]) => ({ sender_name, message_count }))\n  .sort((a, b) => b.message_count - a.message_count); // Sort in descending order by message_count\n\nreturn [{\n  json: {\n    all_links: allLinks,\n    active_users: activeUsers\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1088,
        304
      ],
      "id": "9f7c511b-e85b-4bea-b5a3-6c2301f7a998",
      "name": "Extract Links & Active Users"
    },
    {
      "parameters": {
        "jsCode": "// Node: Prepare Raw Message Sample\n// Input: Output from \"Parse & Structure Data\" node (å•ä¸ª JSON å¯¹è±¡ï¼ŒåŒ…å« sources.messages)\n// Output: JSON with raw_message_sample æ•°ç»„\n\nconst structuredData = $('Parse & Structure Data').first().json; // è·å–ä¸Šæ¸¸èŠ‚ç‚¹çš„å•ä¸ªæ•°æ®é¡¹\n\nif (!structuredData || !structuredData.sources) {\n  console.log(\"è¾“å…¥æ•°æ®ç¼ºå°‘ structuredData æˆ– sources å­—æ®µã€‚\");\n  return { json: { raw_message_sample: [] } };\n}\n\n// å‡è®¾åªæœ‰ä¸€ä¸ª sourceï¼Œè·å–å…¶æ¶ˆæ¯åˆ—è¡¨\nconst sourceName = Object.keys(structuredData.sources)[0];\nconst allMessages = structuredData.sources[sourceName].messages;\n\nif (!allMessages || allMessages.length === 0) {\n  console.log(\"ç»“æ„åŒ–æ•°æ®ä¸­æœªæ‰¾åˆ°æ¶ˆæ¯ã€‚\");\n  return { json: { raw_message_sample: [] } };\n}\n\n// æå–æ¶ˆæ¯æ ·æœ¬ã€‚\n// ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´é‡‡æ ·é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œéšæœºé‡‡æ ·ï¼Œæ›´å¤šæ¶ˆæ¯ï¼‰ã€‚\nconst rawMessageSample = allMessages.map(msg => ({\n  sender_name: msg.sender_name,\n  time: msg.time,\n  content: msg.content\n}));\n\nreturn [{\n  json: {\n    raw_message_sample: rawMessageSample\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        304
      ],
      "id": "68974a8b-054c-4e20-8bbc-59c0d99431d5",
      "name": "Prepare Raw Message Sample"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6dab17d2-2e5e-40e3-b5d9-0abcdac0dde8",
              "name": "date",
              "value": "={{ $now.minus({days: 1}).format('yyyy-MM-dd') }}",
              "type": "string"
            },
            {
              "id": "c2a2eec2-4ead-4544-83db-73aba917f553",
              "name": "group_name",
              "value": "n8nè‡ªåŠ¨åŒ–å®æˆ˜äº¤æµç¾¤",
              "type": "string"
            },
            {
              "id": "0bcb4528-e474-4fe9-ada8-ebc125a809be",
              "name": "group_owner",
              "value": "LQ",
              "type": "string"
            },
            {
              "id": "d98a1539-81e4-45d3-8602-e81815516a7c",
              "name": "web_style_template",
              "value": "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>[åœ¨æ­¤å¤„å¡«å†™æŠ¥å‘Šæ ‡é¢˜] - [æ—¥æœŸ]</title>\n    <link rel=\"stylesheet\" href=\"https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.min.css\">\n    <link rel=\"stylesheet\" href=\"https://lf6-cdn-tos.bytecdntp.com/cdn/expire-100-M/font-awesome/6.0.0/css/all.min.css\">\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\" integrity=\"sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5rLesXWW/sGuLhYFChxgYnz2Q==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" onerror=\"this.onerror=null;this.src='https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js';\"></script>\n    <script type=\"text/javascript\" src=\"https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js\"></script>\n    <script type=\"text/javascript\" src=\"https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js\"></script>\n    <style>\n        /* CSSå˜é‡å®šä¹‰ */\n        :root {\n            /* ä¸»é¢˜é¢œè‰²é…ç½® */\n            --bg-primary: #F5F5EE; /* ä¸»èƒŒæ™¯è‰² - ç±³ç™½è‰² */\n            --bg-secondary: #faf9f6; /* æ¬¡èƒŒæ™¯è‰² - å¡ç‰‡èƒŒæ™¯ */\n            --bg-tertiary: #f1f3f5; /* ç¬¬ä¸‰èƒŒæ™¯è‰² - æ ‡ç­¾ç­‰ */\n            --text-primary: #212529; /* ä¸»è¦æ–‡å­—é¢œè‰² */\n            --text-secondary: #495057; /* æ¬¡è¦æ–‡å­—é¢œè‰² */\n            --accent-primary: #FB651E; /* ä¸»è¦å¼ºè°ƒè‰² - æ©™è‰² */\n            --accent-secondary: #ff8906; /* æ¬¡è¦å¼ºè°ƒè‰² */\n            --accent-tertiary: #e8590c; /* ç¬¬ä¸‰å¼ºè°ƒè‰² */\n            --accent-blue: #007EFF;     /* è“è‰²å¼ºè°ƒ */\n            --accent-purple: #7048e8; /* ç´«è‰²å¼ºè°ƒ */\n            --accent-cyan: #10B981;     /* é’è‰²å¼ºè°ƒ */\n            --highlight-keyword-bg: #ffe8cc; /* å…³é”®è¯é«˜äº®èƒŒæ™¯ */\n            --highlight-name-color: #7048e8; /* äººåé«˜äº®é¢œè‰² */\n            --highlight-group-name-bg: var(--highlight-keyword-bg); /* AIäº§å“è—è™«å›¢é«˜äº®èƒŒæ™¯è‰² - Updated */\n\n\n            /* å¸ƒå±€ä¸æ ·å¼å˜é‡ */\n            --card-padding: 24px; /* å¡ç‰‡å†…è¾¹è· */\n            --grid-gap: 16px; /* ç½‘æ ¼é—´è· */\n            --card-radius: 12px; /* å¡ç‰‡åœ†è§’ */\n            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* å¡ç‰‡é˜´å½± */\n            --font-family: 'Inter', 'SF Pro Display', 'Segoe UI', sans-serif; /* å­—ä½“æ ˆ */\n\n            /* KityMinderè‡ªå®šä¹‰ä¸»é¢˜é¢œè‰² */\n            --km-orange: #FB651E;     /* KityMinderæ©™è‰²ï¼Œç”¨äºä¸€çº§èŠ‚ç‚¹ */\n            --km-blue: #007EFF;       /* KityMinderè“è‰²ï¼Œç”¨äºäºŒçº§èŠ‚ç‚¹ */\n            --km-lightblue: #10B981;  /* KityMinderæµ…è“è‰²ï¼Œç”¨äºä¸‰çº§èŠ‚ç‚¹ */\n            --km-root-bg: #f0f0f0;     /* KityMinderæ ¹èŠ‚ç‚¹èƒŒæ™¯ */\n            --km-root-stroke: var(--km-root-bg); /* KityMinderæ ¹èŠ‚ç‚¹è¾¹æ¡† */\n            --km-root-text: #333333;   /* KityMinderæ ¹èŠ‚ç‚¹æ–‡å­—é¢œè‰² */\n            --km-node-text: #ffffff;   /* KityMinderæ™®é€šèŠ‚ç‚¹æ–‡å­—é¢œè‰² */\n            --km-connect-color: #777777; /* KityMinderè¿æ¥çº¿é¢œè‰² */\n        }\n\n        /* å…¨å±€é‡ç½®å’ŒåŸºç¡€æ ·å¼ */\n        * {\n            margin: 0; /* æ¸…é™¤å¤–è¾¹è· */\n            padding: 0; /* æ¸…é™¤å†…è¾¹è· */\n            box-sizing: border-box; /* ä½¿ç”¨border-boxç›’æ¨¡å‹ */\n        }\n\n        body {\n            font-family: var(--font-family); /* åº”ç”¨å®šä¹‰çš„å­—ä½“æ ˆ */\n            background-color: var(--bg-primary); /* è®¾ç½®é¡µé¢èƒŒæ™¯è‰² */\n            color: var(--text-primary); /* è®¾ç½®ä¸»è¦æ–‡å­—é¢œè‰² */\n            line-height: 1.6; /* è®¾ç½®è¡Œé«˜ */\n            font-size: 16px; /* è®¾ç½®åŸºç¡€å­—å· */\n            width: 100%; /* é¡µé¢å®½åº¦å æ»¡çˆ¶å®¹å™¨ */\n            max-width: 1000px; /* å†…å®¹æœ€å¤§å®½åº¦ */\n            margin: 0 auto; /* å†…å®¹å±…ä¸­æ˜¾ç¤º */\n            padding: 20px; /* é¡µé¢å†…è¾¹è· */\n        }\n        body.modal-active { /* å½“æ¨¡æ€æ¡†æ¿€æ´»æ—¶ï¼Œç¦æ­¢é¡µé¢æ»šåŠ¨ */\n            overflow: hidden;\n        }\n\n        /* æ ‡é¢˜æ ·å¼ */\n        h1, h2, h3, h4 {\n            font-weight: 600; /* æ ‡é¢˜å­—é‡ */\n            letter-spacing: 0.5px; /* å­—ç¬¦é—´è· */\n        }\n\n        h1 { /* ä¸»æ ‡é¢˜æ ·å¼ */\n            font-size: 2.5rem;\n            margin-bottom: 0.5rem;\n            color: var(--accent-primary);\n        }\n\n        h2 { /* äºŒçº§æ ‡é¢˜æ ·å¼ */\n            font-size: 1.75rem;\n            margin-bottom: 1rem;\n            color: var(--accent-primary);\n        }\n\n        h3 { /* ä¸‰çº§æ ‡é¢˜æ ·å¼ */ \n            font-size: 1.25rem;\n            margin-bottom: 0.75rem;\n            color: var(--accent-blue);\n        }\n        \n        /*ç½‘æ ¼å®¹å™¨å¸ƒå±€ */\n        .grid-container {\n            display: grid; /* ä½¿ç”¨CSS Gridå¸ƒå±€ */\n            grid-template-columns: repeat(12, 1fr); /* 12åˆ—ç½‘æ ¼ç³»ç»Ÿ */\n            grid-auto-rows: minmax(150px, auto); /* å¢åŠ è¡Œé«˜æœ€å°å€¼ä»¥é˜²æ­¢å‹ç¼© */\n            gap: var(--grid-gap); /* ç½‘æ ¼é—´è· */\n            margin-top: 20px; /* ä¸ä¸Šæ–¹å…ƒç´ çš„é—´è· */\n            grid-template-areas:\n                \"main      main      main      main      main      main      main      main      main      main      main      main\"\n                \"topics    topics    topics    topics    topics    topics    topics    topics    topics    topics    topics    topics\"\n                \"mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap   mindmap\"\n                \"quote     quote     quote     quote     quote     quote     links     links     links     links     links     links\"\n                \"bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row bottom_row\";\n        }\n\n        /* å¡ç‰‡é€šç”¨æ ·å¼ */\n        .card {\n            background-color: var(--bg-secondary); \n            border-radius: var(--card-radius); \n            padding: var(--card-padding); \n            box-shadow: var(--card-shadow); \n            position: relative; \n            overflow: hidden; \n            transition: transform 0.3s ease, box-shadow 0.3s ease; \n            display: flex; \n            flex-direction: column; \n        }\n\n        .card:hover { \n            transform: translateY(-5px); \n            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1); \n        }\n\n        .card::before { \n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 3px;\n            background: var(--accent-primary);\n        }\n\n        .card-icon { \n            position: absolute;\n            bottom: var(--card-padding);\n            right: var(--card-padding);\n            font-size: 4rem; \n            opacity: 0.07; \n            color: var(--accent-primary); \n            z-index: 0; \n        }\n\n        /* ç½‘æ ¼åŒºåŸŸåˆ†é… */\n        .main-card { grid-area: main; }\n        .topic-cards-wrapper {\n            grid-area: topics;\n            display: grid;\n            grid-template-columns: repeat(12, 1fr);\n            gap: var(--grid-gap);\n            width: 100%; /* ç¡®ä¿å®¹å™¨å æ»¡ç½‘æ ¼åŒºåŸŸ */\n            min-height: 300px; /* è®¾ç½®æœ€å°é«˜åº¦é˜²æ­¢è¿‡åº¦å‹ç¼© */\n            align-items: start; /* é˜²æ­¢å¡ç‰‡è¢«æ‹‰ä¼¸å˜å½¢ */\n        }\n        .mindmap-card-container { grid-area: mindmap; }\n        .quote-card { grid-area: quote; }\n        .links-card { grid-area: links; }\n        .stats-wordcloud-row {\n            grid-area: bottom_row;\n            display: flex;\n            gap: var(--grid-gap);\n            align-items: stretch; /* Ensures cards in the row stretch to the same height */\n        }\n\n\n        .stats-card {\n            flex-grow: 7; /* Takes 7 parts of the available space */\n            flex-shrink: 1; /* Allows shrinking if needed */\n            flex-basis: 0; /* Initial size before distributing space */\n            min-width: 0; /* Allows shrinking below content size if necessary */\n        }\n        .wordcloud-card {\n            flex-grow: 5; /* Takes 5 parts of the available space */\n            flex-shrink: 1;\n            flex-basis: 0;\n            min-width: 0;\n            max-width: 50%; /* Limits wordcloud card width on larger screens */\n        }\n\n        /* ä¸»é¢˜å¡ç‰‡æ ·å¼ */\n        .topic-card {\n            grid-column: span 6; /* Each topic card spans 6 columns on desktop */\n            min-height: 300px; /* å¢åŠ æœ€å°é«˜åº¦ä»¥é˜²æ­¢å‹ç¼© */\n            width: 100%; /* ç¡®ä¿å¡ç‰‡å æ»¡åˆ†é…çš„ç½‘æ ¼ç©ºé—´ */\n            box-sizing: border-box; /* åŒ…å«è¾¹æ¡†å’Œå†…è¾¹è·åœ¨å®½åº¦è®¡ç®—å†… */\n        }\n        .topic-card > .topic-card-content-wrapper {\n            flex-grow: 1; /* Allows content to take available vertical space */\n            padding-bottom: 1rem; /* Space at the bottom of the content */\n        }\n        /* æ™ºèƒ½è¯é¢˜å¡ç‰‡å¸ƒå±€ - å¶æ•°æˆå¯¹ï¼Œå¥‡æ•°æœ€åä¸€ä¸ªç‹¬å æ•´è¡Œ */\n        .topic-cards-wrapper > .topic-card:nth-last-child(1):nth-child(odd) {\n            grid-column: 1 / -1; /* æœ€åä¸€ä¸ªå¥‡æ•°å¡ç‰‡ä»ç¬¬1åˆ—è·¨è¶Šåˆ°æœ€åä¸€åˆ—ï¼ˆ100%å®½åº¦ï¼‰ */\n        }\n\n        /* ä¸»å¡ç‰‡å†…éƒ¨å…ƒç´ æ ·å¼ */\n        .main-card h1 { text-align: center; }\n        .main-card .date { text-align: center; }\n        .date { font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 1rem; }\n        .meta-info { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 1rem; justify-content: center; }\n        .meta-info span { background-color: var(--bg-tertiary); padding: 5px 10px; border-radius: 20px; font-size: 0.9rem; color: var(--accent-blue); }\n        .summary { margin-top: 1rem; line-height: 1.7; text-align: left; }\n\n\n\n\n        .topic-category { display: inline-block; background-color: var(--accent-tertiary); color: var(--bg-primary); padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 0.5rem; }\n                    .topic-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 0.75rem; margin-bottom: 0.75rem; }\n            .tag { background-color: var(--bg-tertiary); color: var(--accent-primary); padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 500; }\n        .highlight-keyword { background-color: var(--highlight-keyword-bg); padding: 1px 2px; border-radius: 2px; font-weight: 500; display: inline; line-height: 1.2; box-decoration-break: clone; -webkit-box-decoration-break: clone; }\n        .highlight-name { color: var(--highlight-name-color); font-weight: 500; }\n        .topic-chat-count { font-size: 0.9rem; color: var(--text-secondary); }\n\n        /* è¯é¢˜è®¨è®ºå®¹å™¨æ ·å¼ */\n        .topic-discussion-container { margin: 0.5rem 0; }\n        .topic-description { margin-bottom: 0.6rem; }\n        .topic-description p { margin: 0; line-height: 1.4; font-size: 0.9rem; color: var(--text-secondary); }\n        \n        .chat-conversation { \n            background-color: rgba(251, 101, 30, 0.02);\n            border: 1px solid rgba(251, 101, 30, 0.08);\n            border-radius: 4px; \n            padding: 0.75rem; \n            margin-top: 0.5rem; \n        }\n        \n        .chat-message { \n            margin-bottom: 0.5rem; \n            padding: 0.3rem 0;\n            border-bottom: 1px solid rgba(251, 101, 30, 0.06);\n            position: relative;\n        }\n        .chat-message:last-child { \n            margin-bottom: 0; \n            border-bottom: none;\n        }\n        \n        .message-header {\n            display: flex;\n            align-items: baseline;\n            gap: 8px;\n            margin-bottom: 0.25rem;\n        }\n        \n        .message-author { \n            color: var(--highlight-name-color); \n            font-weight: 600; \n            font-size: 0.85rem;\n            flex-shrink: 0;\n        }\n        \n        .message-time {\n            color: var(--text-secondary);\n            font-size: 0.7rem;\n            font-weight: 400;\n            opacity: 0.6;\n            transition: opacity 0.2s ease;\n            flex-shrink: 0;\n            position: relative;\n        }\n        \n        .message-time:hover {\n            opacity: 1;\n        }\n        \n        .message-time.relative-time::after {\n            content: attr(data-full-time);\n            position: absolute;\n            bottom: 100%;\n            left: 50%;\n            transform: translateX(-50%);\n            background-color: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 4px 8px;\n            border-radius: 4px;\n            font-size: 0.65rem;\n            white-space: nowrap;\n            opacity: 0;\n            pointer-events: none;\n            transition: opacity 0.2s ease;\n            z-index: 1000;\n            margin-bottom: 4px;\n        }\n        \n        .message-time.relative-time:hover::after {\n            opacity: 1;\n        }\n        \n        .message-content { \n            color: var(--text-primary); \n            line-height: 1.4; \n            font-size: 0.85rem;\n            display: block;\n            border-left: 2px solid var(--accent-primary);\n            background-color: var(--bg-secondary);\n            padding: 0.4rem 0.6rem;\n            border-radius: 2px;\n            margin-left: 0.75rem;\n        }\n        \n        /* æ—¶é—´åˆ†ç»„å’Œè·¨åº¦æç¤ºæ ·å¼ */\n        .time-divider {\n            display: flex;\n            align-items: center;\n            margin: 1rem 0 0.75rem 0;\n            text-align: center;\n        }\n        \n        .time-divider::before,\n        .time-divider::after {\n            content: '';\n            flex: 1;\n            height: 1px;\n            background: linear-gradient(to right, transparent, rgba(251, 101, 30, 0.2), transparent);\n        }\n        \n        .time-divider-text {\n            padding: 0 12px;\n            color: var(--text-secondary);\n            font-size: 0.75rem;\n            font-weight: 500;\n            background-color: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 2px 10px;\n            border: 1px solid rgba(251, 101, 30, 0.1);\n        }\n        \n        /* è¯é¢˜æ—¶é—´è·¨åº¦æç¤º - ä½ä¼˜å…ˆçº§æ‰å¹³è®¾è®¡ */\n        .topic-time-span {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            margin: 0.5rem 0 0.5rem 0;\n            padding: 4px 8px;\n            background-color: rgba(251, 101, 30, 0.08);\n            color: var(--text-secondary);\n            border: 1px solid rgba(251, 101, 30, 0.15);\n            border-radius: 8px;\n            font-size: 0.7rem;\n            font-weight: 400;\n            text-align: center;\n        }\n        \n        .topic-time-span .time-icon {\n            font-size: 0.7rem;\n            opacity: 0.7;\n        }\n        \n        .topic-time-span .time-range {\n            font-weight: 500;\n        }\n        \n        .topic-time-span .aggregated-label {\n            opacity: 0.8;\n            font-size: 0.65rem;\n        }\n        \n        /* æ—¶é—´è·³è·ƒæŒ‡ç¤ºå™¨ */\n        .time-jump-indicator {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            margin: 0.75rem 0;\n            padding: 6px 12px;\n            background-color: rgba(255, 152, 0, 0.1);\n            border: 1px solid rgba(255, 152, 0, 0.2);\n            border-radius: 12px;\n            color: #e65100;\n            font-size: 0.7rem;\n            font-weight: 500;\n            text-align: center;\n        }\n        \n        .time-jump-indicator .jump-icon {\n            font-size: 0.75rem;\n            opacity: 0.8;\n        }\n        \n        .time-jump-indicator .jump-text {\n            font-weight: 600;\n        }\n\n        .quote { position: relative; padding-left: 20px; margin: 10px 0; font-style: italic; color: var(--text-secondary); }\n        .quote::before { content: '\"'; position: absolute; left: 0; top: 0; font-size: 1.5rem; color: var(--accent-tertiary); }\n        .quote-author { text-align: right; font-size: 0.9rem; color: var(--accent-tertiary); margin-top: 5px; }\n\n        .link-item { display: flex; align-items: center; margin-bottom: 10px; padding: 8px; border-radius: 6px; background-color: var(--bg-tertiary); transition: background-color 0.2s ease; text-decoration: none; }\n        .link-item:hover { background-color: rgba(0, 123, 255, 0.1); }\n        .link-item a { text-decoration: none; color: inherit; display: flex; align-items: center; width: 100%; }\n        .link-item a:hover .link-title { text-decoration: underline; color: var(--accent-blue); }\n        .link-icon { margin-right: 10px; color: var(--accent-blue); }\n        .link-title { flex-grow: 1; color: var(--text-primary); }\n        .link-title.is-link { color: var(--accent-blue); }\n        .link-title.is-link:hover { text-decoration: underline; }\n\n        .user-stats-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }\n        .user-stats-table th { text-align: center; padding: 0.75rem 0.5rem; border-bottom: 2px solid var(--accent-primary); color: var(--text-primary); font-weight: 600; font-size: 0.9rem; }\n        .user-stats-table td { padding: 0.75rem 0.5rem; border-bottom: 1px solid var(--bg-tertiary); color: var(--text-secondary); font-size: 0.85rem; vertical-align: top; text-align: left; }\n        .user-stats-table .user-name-col { width: 25%; font-weight: 500; word-break: break-all; }\n        .user-stats-table .message-count-col { text-align: center; width: 15%; white-space: nowrap; }\n        .user-stats-table .contribution-col { width: 60%; word-break: break-all; }\n        .user-stats-table tr:last-child td { border-bottom: none; }\n\n        .wordcloud { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 20px 0; }\n        .wordcloud-item { padding: 5px 10px; border-radius: 4px; font-weight: 500; transition: transform 0.2s ease; }\n        .wordcloud-item:hover { transform: scale(1.1); }\n        .size-1 { font-size: 0.9rem; color: var(--text-secondary); }\n        .size-2 { font-size: 1.1rem; color: var(--accent-cyan); }\n        .size-3 { font-size: 1.3rem; color: var(--accent-blue); }\n        .size-4 { font-size: 1.5rem; color: var(--accent-purple); }\n        .size-5 { font-size: 1.8rem; color: var(--accent-tertiary); }\n\n        /* æŸ¥çœ‹æ›´å¤šèŠå¤©è®°å½•åŠŸèƒ½æ ·å¼ - ç°ä»£åŒ–é‡æ–°è®¾è®¡ */\n        .expandable-messages-container {\n            margin-top: 0.75rem;\n        }\n        \n        /* å±•å¼€åŒºåŸŸå®¹å™¨ - ç°ä»£åŒ–è®¾è®¡ */\n        .expanded-messages-area {\n            background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);\n            border: 1px solid #e2e8f0;\n            border-radius: 12px;\n            margin: 0.75rem 0;\n            padding: 0;\n            position: relative;\n            box-shadow: \n                0 1px 3px rgba(0, 0, 0, 0.05),\n                0 1px 2px rgba(0, 0, 0, 0.1);\n            overflow: hidden;\n            transition: all 0.3s ease;\n        }\n        \n        .expanded-messages-area::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 3px;\n            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);\n            border-radius: 12px 12px 0 0;\n        }\n        \n        /* å±•å¼€åŒºåŸŸæ ‡é¢˜ - ç°ä»£åŒ–è®¾è®¡ */\n        .expanded-area-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            padding: 1rem 1.25rem 0.75rem 1.25rem;\n            margin-bottom: 0;\n            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);\n            border-bottom: 1px solid #e2e8f0;\n        }\n        \n        .expanded-area-title {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            color: #475569;\n            font-size: 0.875rem;\n            font-weight: 600;\n            letter-spacing: -0.025em;\n        }\n        \n        .expanded-area-title .icon {\n            font-size: 1rem;\n            color: #3b82f6;\n        }\n        \n        .expanded-area-progress {\n            color: #64748b;\n            font-size: 0.75rem;\n            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);\n            padding: 4px 10px;\n            border-radius: 6px;\n            border: 1px solid #cbd5e1;\n            font-weight: 500;\n        }\n        \n        /* å±•å¼€æ¶ˆæ¯å†…å®¹åŒºåŸŸ */\n        .expanded-messages-content {\n            padding: 1rem 1.25rem;\n            max-height: 60vh;\n            overflow-y: auto;\n            scrollbar-width: thin;\n            scrollbar-color: #cbd5e1 #f1f5f9;\n        }\n        \n        .expanded-messages-content::-webkit-scrollbar {\n            width: 6px;\n        }\n        \n        .expanded-messages-content::-webkit-scrollbar-track {\n            background: #f1f5f9;\n            border-radius: 3px;\n        }\n        \n        .expanded-messages-content::-webkit-scrollbar-thumb {\n            background: #cbd5e1;\n            border-radius: 3px;\n        }\n        \n        .expanded-messages-content::-webkit-scrollbar-thumb:hover {\n            background: #94a3b8;\n        }\n        \n        /* å±•å¼€æ¶ˆæ¯çš„ç°ä»£åŒ–æ ·å¼ */\n        .expanded-message {\n            background: #ffffff;\n            border: 1px solid #e2e8f0;\n            border-radius: 8px;\n            padding: 0.875rem;\n            margin-bottom: 0.75rem;\n            position: relative;\n            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n        }\n        \n        .expanded-message:hover {\n            background: #fefefe;\n            border-color: #cbd5e1;\n            transform: translateY(-1px);\n            box-shadow: \n                0 4px 6px rgba(0, 0, 0, 0.05),\n                0 1px 3px rgba(0, 0, 0, 0.1);\n        }\n        \n        .expanded-message:last-child {\n            margin-bottom: 0;\n        }\n        \n        /* å±•å¼€æ¶ˆæ¯å¤´éƒ¨ - ç°ä»£åŒ–è®¾è®¡ */\n        .expanded-message-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 0.5rem;\n        }\n        \n        .expanded-message-author {\n            color: #1e293b;\n            font-weight: 600;\n            font-size: 0.8rem;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n        \n        .expanded-message-author::before {\n            content: '';\n            width: 6px;\n            height: 6px;\n            background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n            border-radius: 50%;\n            flex-shrink: 0;\n        }\n        \n        .expanded-message-time {\n            color: #64748b;\n            font-size: 0.75rem;\n            background: #f8fafc;\n            padding: 2px 8px;\n            border-radius: 4px;\n            border: 1px solid #e2e8f0;\n            position: relative;\n            font-weight: 500;\n            transition: all 0.2s ease;\n        }\n        \n        .expanded-message-time:hover {\n            background: #f1f5f9;\n            border-color: #cbd5e1;\n        }\n        \n        .expanded-message-time::after {\n            content: attr(data-full-time);\n            position: absolute;\n            bottom: 100%;\n            right: 0;\n            transform: translateY(-4px);\n            background: #1e293b;\n            color: white;\n            padding: 4px 8px;\n            border-radius: 6px;\n            font-size: 0.7rem;\n            white-space: nowrap;\n            opacity: 0;\n            pointer-events: none;\n            transition: opacity 0.2s ease;\n            z-index: 1000;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n        \n        .expanded-message-time:hover::after {\n            opacity: 1;\n        }\n        \n        /* å±•å¼€æ¶ˆæ¯å†…å®¹ - ç°ä»£åŒ–è®¾è®¡ */\n        .expanded-message-content {\n            color: #334155;\n            line-height: 1.6;\n            font-size: 0.875rem;\n            padding: 0.75rem;\n            background: #f8fafc;\n            border: 1px solid #e2e8f0;\n            border-radius: 6px;\n            margin-top: 0.5rem;\n            position: relative;\n        }\n        \n        .expanded-message-content::before {\n            content: '';\n            position: absolute;\n            left: 0;\n            top: 0;\n            bottom: 0;\n            width: 3px;\n            background: linear-gradient(180deg, #3b82f6, #8b5cf6);\n            border-radius: 0 0 0 6px;\n        }\n        \n        /* å±•å¼€åŒºåŸŸçš„æ—¶é—´åˆ†éš”ç¬¦ */\n        .expanded-time-divider {\n            display: flex;\n            align-items: center;\n            margin: 1rem 0 0.75rem 0;\n            text-align: center;\n        }\n        \n        .expanded-time-divider::before,\n        .expanded-time-divider::after {\n            content: '';\n            flex: 1;\n            height: 1px;\n            background: linear-gradient(to right, transparent, rgba(0, 126, 255, 0.3), transparent);\n        }\n        \n        .expanded-time-divider-text {\n            padding: 0 12px;\n            color: var(--accent-blue);\n            font-size: 0.75rem;\n            font-weight: 600;\n            background-color: rgba(255, 255, 255, 0.8);\n            border-radius: 12px;\n            padding: 4px 12px;\n            border: 1px solid rgba(0, 126, 255, 0.2);\n            box-shadow: 0 1px 3px rgba(0, 126, 255, 0.1);\n        }\n        \n        /* å±•å¼€åŒºåŸŸçš„æ—¶é—´è·³è·ƒæŒ‡ç¤ºå™¨ */\n        .expanded-time-jump {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            margin: 0.75rem 0;\n            padding: 6px 12px;\n            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 193, 7, 0.1));\n            border: 1px solid rgba(255, 152, 0, 0.3);\n            border-radius: 12px;\n            color: #e65100;\n            font-size: 0.7rem;\n            font-weight: 500;\n            text-align: center;\n        }\n        \n        .expanded-time-jump .jump-icon {\n            font-size: 0.75rem;\n        }\n        \n        /* æŒ‰é’®æ ·å¼ */\n        .load-more-section {\n            margin: 0.75rem 0;\n            display: flex;\n            justify-content: center;\n            position: relative;\n        }\n        \n        .load-more-section::before {\n            content: '';\n            position: absolute;\n            top: 50%;\n            left: 0;\n            right: 0;\n            height: 1px;\n            background: linear-gradient(to right, transparent, rgba(251, 101, 30, 0.2), transparent);\n            z-index: 1;\n        }\n        \n        .load-more-button {\n            background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 12px;\n            font-size: 0.875rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n            position: relative;\n            z-index: 2;\n            white-space: nowrap;\n            box-shadow: \n                0 4px 6px rgba(0, 0, 0, 0.05),\n                0 1px 3px rgba(0, 0, 0, 0.1);\n            min-width: 200px;\n            overflow: hidden;\n        }\n        \n        .load-more-button::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);\n            transition: left 0.6s ease;\n        }\n        \n        .load-more-button:hover::before {\n            left: 100%;\n        }\n        \n        .load-more-button:hover {\n            background: linear-gradient(135deg, #2563eb, #7c3aed);\n            transform: translateY(-1px);\n            box-shadow: \n                0 10px 15px rgba(0, 0, 0, 0.1),\n                0 4px 6px rgba(0, 0, 0, 0.05);\n        }\n        \n        .load-more-button .progress-text {\n            font-size: 0.75rem;\n            opacity: 0.9;\n            font-weight: 500;\n        }\n        \n        /* å±•å¼€åŒºåŸŸåº•éƒ¨æ“ä½œåŒº */\n        .expanded-area-footer {\n            padding: 0.75rem 1.25rem;\n            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);\n            border-top: 1px solid #e2e8f0;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        \n        /* æ”¶èµ·æŒ‰é’® - ç°ä»£åŒ–è®¾è®¡ */\n        .collapse-all-button {\n            background: linear-gradient(135deg, #64748b, #475569);\n            color: white;\n            border: none;\n            padding: 8px 16px;\n            border-radius: 8px;\n            font-size: 0.8rem;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n            white-space: nowrap;\n            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n        }\n        \n        .collapse-all-button:hover {\n            background: linear-gradient(135deg, #475569, #334155);\n            transform: translateY(-1px);\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n        \n        /* åŠ¨ç”» */\n        .expanded-message {\n            animation: expandedSlideIn 0.4s ease forwards;\n            opacity: 0;\n            transform: translateX(-10px);\n        }\n        \n        @keyframes expandedSlideIn {\n            from { \n                opacity: 0; \n                transform: translateX(-10px);\n            }\n            to { \n                opacity: 1; \n                transform: translateX(0);\n            }\n        }\n        \n        .expanded-message:nth-child(1) { animation-delay: 0.1s; }\n        .expanded-message:nth-child(2) { animation-delay: 0.15s; }\n        .expanded-message:nth-child(3) { animation-delay: 0.2s; }\n        .expanded-message:nth-child(4) { animation-delay: 0.25s; }\n        .expanded-message:nth-child(5) { animation-delay: 0.3s; }\n        .expanded-message:nth-child(6) { animation-delay: 0.35s; }\n        \n        /* å±•å¼€åŒºåŸŸåŠ¨ç”» */\n        .expanded-messages-area {\n            animation: expandedAreaSlideIn 0.5s ease forwards;\n            opacity: 0;\n            transform: translateY(10px);\n        }\n        \n        @keyframes expandedAreaSlideIn {\n            from { \n                opacity: 0; \n                transform: translateY(10px);\n            }\n            to { \n                opacity: 1; \n                transform: translateY(0);\n            }\n        }\n        \n        @keyframes slideOutToTop {\n            from {\n                opacity: 1;\n                transform: translateY(0);\n                max-height: 1000px;\n            }\n            to {\n                opacity: 0;\n                transform: translateY(-20px);\n                max-height: 0;\n            }\n        }\n        \n        /* æŠ˜å åŠ¨ç”» */\n        .collapsing {\n            overflow: hidden;\n            transition: all 0.5s ease;\n            transform-origin: top;\n        }\n        \n        .collapsing.collapse-out {\n            opacity: 0;\n            transform: scaleY(0);\n            margin-top: 0;\n            margin-bottom: 0;\n            padding-top: 0;\n            padding-bottom: 0;\n        }\n        \n        /* åŠ è½½æŒ‡ç¤ºå™¨ - ç°ä»£åŒ–è®¾è®¡ */\n        .loading-indicator {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: 1.25rem;\n            color: #475569;\n            font-size: 0.875rem;\n            font-weight: 500;\n            background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);\n            border: 1px solid #e2e8f0;\n            border-radius: 12px;\n            margin: 0.75rem 0;\n            box-shadow: \n                0 1px 3px rgba(0, 0, 0, 0.05),\n                0 1px 2px rgba(0, 0, 0, 0.1);\n        }\n        \n        .loading-indicator .spinner {\n            width: 18px;\n            height: 18px;\n            border: 2px solid #e2e8f0;\n            border-top-color: #3b82f6;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin-right: 10px;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n\n\n\n        /* æ“ä½œæŒ‰é’®åŒºåŸŸæ ·å¼ */\n        .action-buttons-container {\n            display: flex; \n            flex-wrap: wrap; \n            justify-content: center; \n            gap: 10px; \n            margin: 20px 0;\n            padding-bottom: 20px; \n        }\n\n        .action-button {\n            background-color: var(--accent-primary);\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: var(--card-radius);\n            font-size: 1rem;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.3s ease, transform 0.2s ease;\n            box-shadow: var(--card-shadow);\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n            flex-shrink: 0; \n        }\n        .action-button:hover { background-color: var(--accent-secondary); transform: translateY(-2px); }\n        .action-button i, .action-button .fas { margin-right: 8px; }\n\n        .footer { margin-top: 30px; text-align: center; color: var(--text-secondary); font-size: 0.9rem; }\n        #report-content-wrapper .footer { margin-top: 30px; padding-bottom: 20px; } \n\n        .mindmap-card {}\n        .mindmap-card h2 i { margin-right: 8px; }\n        .mindmap-controls { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; flex-wrap: wrap; }\n        .mindmap-controls button { background-color: var(--km-blue); color: white; border: none; padding: 8px 12px; border-radius: var(--card-radius); font-size: 0.9rem; cursor: pointer; transition: background-color 0.2s ease; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; }\n        .mindmap-controls button:hover { background-color: #005bb5; }\n        .mindmap-controls button i { margin-right: 5px; }\n        .mindmap-controls .fullscreen-toggle-btn { margin-left: auto; } \n\n        .kityminder-container {\n            flex-grow: 1; \n            overflow: hidden; \n            background-color: #fff; \n            border-radius: 8px;\n            padding: 0; \n            border: 1px solid var(--bg-tertiary);\n            min-height: 400px; \n            position: relative; \n            transition: height 0.3s ease-in-out; \n            display: flex; \n            align-items: center; \n            justify-content: center; \n            touch-action: none;\n            font-family: var(--font-family); /* ç¡®ä¿KityMinderå®¹å™¨ä½¿ç”¨æ­£ç¡®çš„å­—ä½“ */\n        }\n        \n        /* ç¡®ä¿KityMinder SVGæ–‡æœ¬ä½¿ç”¨æ­£ç¡®çš„å­—ä½“ */\n        .kityminder-container svg text {\n            font-family: var(--font-family) !important;\n        }\n        .kityminder-container:empty::before { \n            content: \"æ€ç»´å¯¼å›¾åŠ è½½ä¸­æˆ–å†…å®¹ä¸ºç©º...\";\n            color: var(--text-secondary); font-style: italic; text-align: center;\n            padding: 20px; display: flex; justify-content: center; align-items: center;\n            height: 100%; min-height: 150px;\n        }\n\n        #mermaid-main-feedback-message, #mermaid-modal-feedback-message {\n            text-align: center; margin-top: 15px; padding: 8px; border-radius: 4px;\n            font-weight: 500; font-size: 0.9rem; display: none; \n        }\n        #mermaid-main-feedback-message.success, #mermaid-modal-feedback-message.success {\n            color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; display: block;\n        }\n        #mermaid-main-feedback-message.error, #mermaid-modal-feedback-message.error {\n            color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; display: block;\n        }\n        #mermaid-main-feedback-message.info, #mermaid-modal-feedback-message.info {\n            color: #0c5460; background-color: #d1ecf1; border: 1px solid #bee5eb; display: block;\n        }\n\n        #feedback-message { text-align: center; margin-top: 10px; font-weight: 500; }\n        #feedback-message.success { color: green; }\n        #feedback-message.error { color: red; }\n\n        .modal-overlay {\n            position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background-color: rgba(0, 0, 0, 0.75); \n            display: none; \n            justify-content: center; align-items: center; z-index: 1000; padding: 20px;\n        }\n        .modal-overlay.active { display: flex; } \n        .modal-content { \n            width: 95%; height: 90%; max-width: 1200px;\n        }\n        .modal-close-btn {\n            position: absolute; top: 15px; right: 20px; background: none; border: none;\n            font-size: 2.2rem; color: var(--text-secondary); cursor: pointer;\n            line-height: 1; padding: 5px; z-index: 1010; \n        }\n        .modal-close-btn:hover { color: var(--text-primary); }\n        #modalKityMinderContainer { \n            flex-grow: 1; min-height: 0; \n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        .card { animation: fadeIn 0.5s ease forwards; }\n        .main-card { animation-delay: 0.1s; }\n        /* åŠ¨æ€è¯é¢˜å¡ç‰‡åŠ¨ç”»å»¶è¿Ÿ - æ”¯æŒä»»æ„æ•°é‡çš„è¯é¢˜ */\n        .topic-cards-wrapper .topic-card:nth-child(1) { animation-delay: 0.2s; }\n        .topic-cards-wrapper .topic-card:nth-child(2) { animation-delay: 0.3s; }\n        .topic-cards-wrapper .topic-card:nth-child(3) { animation-delay: 0.4s; }\n        .topic-cards-wrapper .topic-card:nth-child(4) { animation-delay: 0.5s; }\n        .topic-cards-wrapper .topic-card:nth-child(5) { animation-delay: 0.6s; }\n        .topic-cards-wrapper .topic-card:nth-child(6) { animation-delay: 0.7s; }\n        .topic-cards-wrapper .topic-card:nth-child(7) { animation-delay: 0.8s; }\n        .topic-cards-wrapper .topic-card:nth-child(8) { animation-delay: 0.9s; }\n        .topic-cards-wrapper .topic-card:nth-child(9) { animation-delay: 1.0s; }\n        .topic-cards-wrapper .topic-card:nth-child(10) { animation-delay: 1.1s; }\n        .topic-cards-wrapper .topic-card:nth-child(n+11) { animation-delay: 1.2s; }\n        .mindmap-card-container .card { animation-delay: 0.6s; } \n        .quote-card { animation-delay: 0.7s; }\n        .links-card { animation-delay: 0.8s; }\n        .stats-wordcloud-row { animation: fadeIn 0.5s ease forwards; animation-delay: 0.9s; }\n        #report-content-wrapper .footer { animation: fadeIn 0.5s ease forwards; animation-delay: 1.0s; }\n        .action-buttons-container { animation: fadeIn 0.5s ease forwards; animation-delay: 1.1s; }\n\n        @media (max-width: 768px) {\n            body { padding: 10px; font-size: 14px; }\n            h1 { font-size: 1.8rem; }\n            h2 { font-size: 1.4rem; }\n            h3 { font-size: 1.1rem; }\n\n            .grid-container { \n                grid-template-columns: 1fr;\n                grid-template-areas:\n                    \"main\"\n                    \"topics\"\n                    \"mindmap\"\n                    \"quote\"\n                    \"links\"\n                    \"bottom_row\";\n            }\n\n\n\n            .stats-wordcloud-row { flex-direction: column; } \n            .stats-wordcloud-row > .card { width: 100%; flex-basis: auto !important; max-width: none; } \n            \n            .topic-cards-wrapper { \n                display: flex !important; \n                flex-direction: column; \n                gap: var(--grid-gap); \n                grid-template-columns: none !important; /* è¦†ç›–æ¡Œé¢ç«¯çš„ç½‘æ ¼è®¾ç½® */\n            } \n            .topic-card { \n                width: 100%; \n                min-height: auto; \n                grid-column: unset !important; /* ç§»é™¤ç½‘æ ¼åˆ—è®¾ç½® */\n            }\n\n            .topic-card > .topic-card-content-wrapper { padding-bottom: 1rem; }\n            .topic-chat-count { position: static; margin-top: 10px; margin-bottom: 10px; text-align: left; }\n            \n            /* ç§»åŠ¨ç«¯è¯é¢˜è®¨è®ºå®¹å™¨æ ·å¼ */\n            .topic-description p { font-size: 0.85rem; }\n            .chat-conversation { padding: 0.6rem; }\n            .chat-message { margin-bottom: 0.4rem; padding: 0.25rem 0; }\n            .message-header { gap: 6px; }\n            .message-author { font-size: 0.8rem; }\n            .message-time { font-size: 0.65rem; }\n            .message-content { \n                font-size: 0.8rem; \n                line-height: 1.3; \n                padding: 0.3rem 0.5rem; \n                margin-left: 0.5rem;\n            }\n            .time-divider-text { font-size: 0.7rem; padding: 1px 8px; }\n            \n            .topic-time-span { \n                margin: 0.3rem 0 0.4rem 0; \n                padding: 3px 6px; \n                font-size: 0.65rem; \n                gap: 4px;\n            }\n            .topic-time-span .time-icon { font-size: 0.65rem; }\n            .topic-time-span .aggregated-label { font-size: 0.6rem; }\n            \n            .time-jump-indicator { \n                margin: 0.6rem 0; \n                padding: 4px 10px; \n                font-size: 0.65rem; \n                gap: 4px;\n            }\n            .time-jump-indicator .jump-icon { font-size: 0.7rem; }\n            \n            .card-icon { font-size: 2.5rem; opacity:0.05; } \n            .mindmap-card .card-icon { bottom: 15px; right: 15px; }\n            \n            .user-stats-table th, .user-stats-table td { padding: 0.5rem 0.25rem; font-size: 0.8rem; }\n            .user-stats-table td { text-align: left; } \n            .user-stats-table .message-count-col { text-align: center; } \n            \n            .action-button { padding: 8px 15px; font-size: 0.9rem; } \n            .load-more-button { \n                padding: 6px 12px; \n                font-size: 0.75rem; \n                gap: 4px;\n            }\n            .load-more-button .progress-text { \n                font-size: 0.7rem; \n            }\n            .collapse-all-button { \n                padding: 6px 12px; \n                font-size: 0.75rem; \n                gap: 4px;\n            }\n            \n            /* ç§»åŠ¨ç«¯å±•å¼€åŒºåŸŸæ ·å¼ */\n            .expanded-messages-area {\n                margin: 0.75rem 0;\n                padding: 0.75rem;\n            }\n            \n            .expanded-area-header {\n                margin-bottom: 0.5rem;\n                padding-bottom: 0.4rem;\n            }\n            \n            .expanded-area-title {\n                font-size: 0.75rem;\n                gap: 4px;\n            }\n            \n            .expanded-area-progress {\n                font-size: 0.65rem;\n                padding: 1px 6px;\n            }\n            \n            .expanded-message {\n                padding: 0.6rem;\n                margin-bottom: 0.4rem;\n            }\n            \n            .expanded-message-header {\n                margin-bottom: 0.3rem;\n            }\n            \n            .expanded-message-author {\n                font-size: 0.75rem;\n                gap: 3px;\n            }\n            \n            .expanded-message-time {\n                font-size: 0.65rem;\n                padding: 1px 4px;\n            }\n            \n            .expanded-message-content {\n                font-size: 0.8rem;\n                line-height: 1.4;\n                padding: 0.3rem 0.5rem;\n            }\n            \n            .expanded-time-divider {\n                margin: 0.75rem 0 0.5rem 0;\n            }\n            \n            .expanded-time-divider-text {\n                font-size: 0.7rem;\n                padding: 3px 10px;\n            }\n            \n            .expanded-time-jump {\n                margin: 0.6rem 0;\n                padding: 4px 10px;\n                font-size: 0.65rem;\n                gap: 4px;\n            }\n\n            .mindmap-card-container .card { padding: 15px; } \n            .mindmap-controls button { font-size: 0.8rem; padding: 6px 10px; }\n            .modal-content { width: 100%; height: 95%; padding:15px; } \n            .modal-close-btn { font-size: 1.8rem; top:10px; right:10px;}\n\n\n        }\n\n        @media (max-width: 480px) {\n            .user-stats-table { display: block; overflow-x: auto; } \n            .user-stats-table th, .user-stats-table td { white-space: normal; } \n            .user-stats-table thead, .user-stats-table tbody, .user-stats-table tr { display: block; } \n            .user-stats-table tr { border-bottom: 1px solid var(--bg-tertiary); }\n            .user-stats-table th { display: none; } \n            .user-stats-table td { \n                display: block; text-align: left; \n                border-bottom: none; padding-left: 0.5rem; \n                width: 100% !important; \n            }\n            .user-stats-table td.message-count-col { text-align: left; } \n            .user-stats-table td::before { \n                content: attr(data-label); \n                font-weight: bold; \n                display: inline-block; \n                width: 100px; \n                margin-right: 10px; \n                color: var(--text-primary); \n                text-align: left; \n            }\n             .user-stats-table td.contribution-col::before {\n                width: auto; \n                margin-bottom: 5px; \n                display: block; \n            }\n             .user-stats-table td.contribution-col {\n                padding-left: 0.5rem; \n            }\n            .user-stats-table tr:last-child { border-bottom: none; }\n\n\n        }\n    </style>\n</head>\n<body>\n    <div id=\"report-content-wrapper\"> <div class=\"grid-container\">\n            <div class=\"card main-card\">\n                <h1 contenteditable=\"false\">[ä¸»æŠ¥å‘Šæ ‡é¢˜ - ä¾‹å¦‚ï¼šAIäº§å“å›¢æ—¥æŠ¥]</h1>\n                <div class=\"date\">[æ—¥æœŸ - ä¾‹å¦‚ï¼š2025å¹´5æœˆ19æ—¥]</div>\n                <div class=\"meta-info\">\n                    <!-- ç»Ÿè®¡æŒ‡æ ‡æ¨¡æ¿åŒºåŸŸ - AIå°†åœ¨æ­¤å¤„åŠ¨æ€ç”Ÿæˆç»Ÿè®¡æŒ‡æ ‡ -->\n                    <!-- META_INFO_TEMPLATE_START -->\n                    <span><i class=\"fas fa-comment\"></i> æ¶ˆæ¯æ•°: [æ•°å­—]+</span>\n                    <span><i class=\"fas fa-users\"></i> æ´»è·ƒç”¨æˆ·: [æ•°å­—]+</span>\n                    <span><i class=\"fas fa-fire\"></i> çƒ­ç‚¹è¯é¢˜: [æ•°å­—]</span>\n                    <!-- META_INFO_TEMPLATE_END -->\n                    <!-- \n                    è¯´æ˜ï¼šAIåº”è¯¥ï¼š\n                    1. åˆ é™¤ META_INFO_TEMPLATE_START å’Œ META_INFO_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                    2. æ ¹æ®å®é™…ç»Ÿè®¡æŒ‡æ ‡æ•°é‡ï¼Œä¸ºæ¯ä¸ªæŒ‡æ ‡ç”Ÿæˆä¸€ä¸ª <span> å…ƒç´ \n                    3. é€‰æ‹©åˆé€‚çš„å›¾æ ‡ï¼š\n                       - fas fa-comment (æ¶ˆæ¯æ•°)\n                       - fas fa-users (ç”¨æˆ·æ•°)\n                       - fas fa-fire (çƒ­ç‚¹è¯é¢˜)\n                       - fas fa-chart-line (è¶‹åŠ¿æ•°æ®)\n                       - fas fa-clock (æ—¶é—´ç»Ÿè®¡)\n                       - fas fa-thumbs-up (äº’åŠ¨æ•°æ®)\n                    4. ä¿æŒç›¸åŒçš„HTMLç»“æ„å’ŒCSSç±»å\n                    -->\n                </div>\n                <p class=\"summary\">[åœ¨æ­¤å¤„å¡«å†™å½“æ—¥è®¨è®ºçš„æ€»ä½“æ‘˜è¦ã€‚ä¿æŒç®€æ´æ˜äº†ï¼Œçªå‡ºç¾¤ç»„çš„ä¸»è¦ä¸»é¢˜å’Œæ°›å›´ã€‚]</p>\n                <i class=\"fas fa-microchip card-icon\"></i>\n            </div>\n\n\n\n            <div class=\"topic-cards-wrapper\">\n                <!-- è¯é¢˜å¡ç‰‡æ¨¡æ¿åŒºåŸŸ - AIå°†åœ¨æ­¤å¤„åŠ¨æ€ç”Ÿæˆè¯é¢˜å¡ç‰‡ -->\n                <!-- TOPIC_CARDS_TEMPLATE_START -->\n                <div class=\"card topic-card\">\n                    <div class=\"topic-card-content-wrapper\">\n                        <h2 contenteditable=\"false\"><i class=\"fas fa-lightbulb\"></i> [ä¸»é¢˜1æ ‡é¢˜]</h2>\n                        <div class=\"topic-category\">[åˆ†ç±»1 - ä¾‹å¦‚ï¼šå·¥å…·æŠ€å·§]</div>\n                        <div class=\"topic-discussion-container\">\n                            <div class=\"topic-description\">\n                                <p>å…³äº<span class=\"highlight-keyword\">[è¯é¢˜å…³é”®è¯]</span>çš„è®¨è®ºå¼•å‘äº†ç¾¤å†…æˆå‘˜çš„å¹¿æ³›å…³æ³¨ï¼Œå¤§å®¶ä»ä¸åŒè§’åº¦åˆ†äº«äº†å„è‡ªçš„è§‚ç‚¹å’Œç»éªŒã€‚</p>\n                            </div>\n                            <div class=\"chat-conversation\">\n                                <!-- è¯é¢˜æ—¶é—´è·¨åº¦æç¤ºåŒºåŸŸ - AIæ ¹æ®éœ€è¦åŠ¨æ€ç”Ÿæˆ -->\n                                <!-- TOPIC_TIME_SPAN_TEMPLATE_START -->\n                                <div class=\"topic-time-span\">\n                                    <span class=\"time-icon\">â°</span>\n                                    <span class=\"time-range\">[å¼€å§‹æ—¶é—´] - [ç»“æŸæ—¶é—´]</span>\n                                    <span class=\"aggregated-label\">â€¢ è¯¥è¯é¢˜çš„èšåˆå¯¹è¯</span>\n                                </div>\n                                <!-- TOPIC_TIME_SPAN_TEMPLATE_END -->\n                                \n                                <!-- èŠå¤©å¯¹è¯æ¨¡æ¿åŒºåŸŸ - AIå°†æ ¹æ®å®é™…å¯¹è¯å†…å®¹åŠ¨æ€ç”Ÿæˆ -->\n                                <!-- CONVERSATION_TEMPLATE_START -->\n                                <div class=\"chat-message\">\n                                    <div class=\"message-header\">\n                                        <span class=\"message-author\">@[ç”¨æˆ·å]</span>\n                                        <span class=\"message-time relative-time\" data-full-time=\"[å®Œæ•´æ—¶é—´]\" title=\"[å®Œæ•´æ—¶é—´]\">[ç›¸å¯¹æ—¶é—´]</span>\n                                    </div>\n                                    <span class=\"message-content\">[ç”¨æˆ·çš„å…·ä½“èŠå¤©å†…å®¹]</span>\n                                </div>\n                                <!-- CONVERSATION_TEMPLATE_END -->\n                                <!-- \n                                AIä½¿ç”¨è¯´æ˜ï¼š\n                                ã€è¯é¢˜æ—¶é—´è·¨åº¦æç¤ºã€‘\n                                1. åˆ é™¤ TOPIC_TIME_SPAN_TEMPLATE_START å’Œ TOPIC_TIME_SPAN_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                                2. å¦‚æœè¯é¢˜è·¨è¶Šè¶…è¿‡2å°æ—¶ï¼ˆå¦‚ä¸Šåˆã€ä¸‹åˆåˆ†æ•£å¯¹è¯ï¼‰ï¼Œç”Ÿæˆæ—¶é—´è·¨åº¦æç¤º\n                                3. æ—¶é—´æ ¼å¼ï¼šä¸Šåˆ9:30 - ä¸‹åˆ15:45ã€ä»Šå¤©10:00 - 18:30ç­‰\n                                4. å¦‚æœè¯é¢˜é›†ä¸­åœ¨çŸ­æ—¶é—´å†…ï¼ˆå¦‚1å°æ—¶å†…ï¼‰ï¼Œå¯çœç•¥æ­¤æç¤º\n                                \n                                ã€èŠå¤©å¯¹è¯ã€‘\n                                1. åˆ é™¤ CONVERSATION_TEMPLATE_START å’Œ CONVERSATION_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                                2. æ ¹æ®å®é™…èŠå¤©è®°å½•åŠ¨æ€ç”Ÿæˆä»»æ„æ•°é‡çš„ chat-message div\n                                3. æ¯æ¡æ¶ˆæ¯åŒ…å« message-headerï¼ˆç”¨æˆ·å+æ—¶é—´ï¼‰å’Œ message-contentï¼ˆèŠå¤©å†…å®¹ï¼‰\n                                4. ç”¨æˆ·åæ ¼å¼ï¼š@ç”¨æˆ·å\n                                5. æ—¶é—´æ˜¾ç¤ºï¼šç›¸å¯¹æ—¶é—´ï¼ˆå¦‚\"2å°æ—¶å‰\"ï¼‰+ å®Œæ•´æ—¶é—´tooltip\n                                6. èŠå¤©å†…å®¹ä½¿ç”¨åŸå§‹å¯¹è¯ï¼Œä¿æŒçœŸå®æ€§\n                                7. æ•°é‡çµæ´»ï¼šå¯ä»¥æ˜¯2æ¡ã€5æ¡ã€8æ¡ç­‰ä»»æ„æ•°é‡\n                                8. æŒ‰æ—¶é—´é¡ºåºæ’åˆ—ï¼Œä½“ç°å¯¹è¯çš„è¿è´¯æ€§\n                                9. æ—¶é—´æ ¼å¼ï¼šç›¸å¯¹æ—¶é—´ç”¨äºæ˜¾ç¤ºï¼Œå®Œæ•´æ—¶é—´ç”¨äºdata-full-timeå’Œtitleå±æ€§\n                                10. æ—¶é—´è·³è·ƒå¤„ç†ï¼šå½“ç›¸é‚»æ¶ˆæ¯æ—¶é—´å·®è¶…è¿‡30åˆ†é’Ÿæ—¶ï¼Œè‡ªåŠ¨æ’å…¥æ—¶é—´è·³è·ƒæŒ‡ç¤ºå™¨\n                                -->\n                            </div>\n                            <!-- æŸ¥çœ‹æ›´å¤šèŠå¤©è®°å½•åŠŸèƒ½ - åŠ¨æ€æ’å…¥åŒºåŸŸ -->\n                            <div class=\"expandable-messages-container\" data-topic-id=\"[è¯é¢˜ID]\" data-total-messages=\"[æ€»æ•°é‡]\">\n                                <!-- æŸ¥çœ‹æ›´å¤šæŒ‰é’®å’Œæ–°æ¶ˆæ¯å°†åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->\n                            </div>\n                        </div>\n                        <div class=\"topic-tags\">\n                            <span class=\"tag\">[ChatGPT]</span>\n                            <span class=\"tag\">[æŠ€æœ¯é—®é¢˜]</span>\n                            <span class=\"tag\">[æ€§èƒ½ä¼˜åŒ–]</span>\n                        </div>\n                        <div class=\"topic-chat-count\"><i class=\"fas fa-comments\"></i> ç›¸å…³æ¶ˆæ¯: [æ€»æ•°é‡]æ¡</div>\n                    </div>\n                    <i class=\"fas fa-tools card-icon\"></i>\n                </div>\n               \n                <!-- TOPIC_CARDS_TEMPLATE_END -->\n                <!-- \n                è¯´æ˜ï¼šAIåº”è¯¥ï¼š\n                1. åˆ é™¤ TOPIC_CARDS_TEMPLATE_START å’Œ TOPIC_CARDS_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                2. æ ¹æ®å®é™…è¯é¢˜æ•°é‡ï¼Œä¸ºæ¯ä¸ªè¯é¢˜ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ topic-card div\n                3. æ¯ä¸ªè¯é¢˜å¡ç‰‡ä½¿ç”¨åˆé€‚çš„å›¾æ ‡ï¼š\n                   - fas fa-lightbulb (æƒ³æ³•/è®¨è®º)\n                   - fas fa-rocket (æ–°åŠŸèƒ½/äº§å“)  \n                   - fas fa-tools (å·¥å…·/æŠ€æœ¯)\n                   - fas fa-comments-dollar (å•†ä¸š/ç›ˆåˆ©)\n                   - fas fa-star (çƒ­é—¨è¯é¢˜)\n                   - fas fa-fire (çƒ­ç‚¹äº‹ä»¶)\n                   - fas fa-cogs (æŠ€æœ¯æ–¹æ¡ˆ)\n                   - fas fa-users (ç¤¾åŒº/ç”¨æˆ·)\n                4. è¯é¢˜æ ‡ç­¾(topic-tags)åº”è¯¥ä½¿ç”¨ topic_tags å­—æ®µï¼Œæ˜¾ç¤º2-4ä¸ªç²¾å‡†çš„ä¸šå†…çƒ­è¯\n                5. æ ‡ç­¾ç¤ºä¾‹ï¼šChatGPTã€Claudeã€Cursorã€æŠ€æœ¯é—®é¢˜ã€æ€§èƒ½ä¼˜åŒ–ã€ç”¨æˆ·ä½“éªŒç­‰\n                6. ç›¸å…³æ¶ˆæ¯æ•°é‡ï¼šæ˜¾ç¤ºè¯¥è¯é¢˜ç›¸å…³çš„æ€»èŠå¤©æ¶ˆæ¯æ•°ï¼ˆå¦‚ï¼š52æ¡ã€128æ¡ç­‰ï¼‰\n                7. è®¨è®ºå®¹å™¨ä¸­çš„èŠå¤©å¼•ç”¨ï¼šé€‰æ‹©3-6æ¡æœ€å…·ä»£è¡¨æ€§çš„æ¶ˆæ¯è¿›è¡Œå±•ç¤º\n                8. æ³¨æ„åŒºåˆ†ï¼šæ€»æ¶ˆæ¯æ•° â‰  å¼•ç”¨å±•ç¤ºæ•°ï¼Œå‰è€…é€šå¸¸è¿œå¤§äºåè€…\n                9. ä¿æŒç›¸åŒçš„HTMLç»“æ„å’ŒCSSç±»å\n                10. æ”¯æŒä»»æ„æ•°é‡çš„è¯é¢˜å¡ç‰‡ï¼ˆåŠ¨ç”»å»¶è¿Ÿå·²ä¼˜åŒ–æ”¯æŒ1-10+ä¸ªè¯é¢˜ï¼‰\n                11. \"æŸ¥çœ‹æ›´å¤š\"åŠŸèƒ½é…ç½®ï¼š\n                    - å°†expandable-messages-containerçš„data-topic-idè®¾ç½®ä¸ºè¯é¢˜çš„topic_id\n                    - å°†expandable-messages-containerçš„data-total-messagesè®¾ç½®ä¸ºè¯¥è¯é¢˜çš„æ€»æ¶ˆæ¯æ•°é‡\n                    - åœ¨JavaScriptçš„TOPIC_MESSAGES_DATA_PLACEHOLDERåŒºåŸŸå¡«å……å®Œæ•´çš„æ¶ˆæ¯æ•°æ®\n                    - æŒ‰é’®å’Œæ¶ˆæ¯å°†ç”±JavaScriptè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ HTML\n                -->\n            </div>\n\n            <div class=\"mindmap-card-container card\">\n                <div class=\"mindmap-card\">\n                    <h2><i class=\"fas fa-sitemap\"></i> æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾</h2>\n                    <div class=\"mindmap-controls\">\n                        <button id=\"zoomInBtn\"><i class=\"fas fa-search-plus\"></i> æ”¾å¤§</button>\n                        <button id=\"zoomOutBtn\"><i class=\"fas fa-search-minus\"></i> ç¼©å°</button>\n                        <button id=\"downloadDiagramBtn\"><i class=\"fas fa-download\"></i> ä¸‹è½½ SVG</button>\n                        <button id=\"fullscreenOpenBtn\" class=\"fullscreen-toggle-btn\"><i class=\"fas fa-expand\"></i> å…¨å±</button>\n                    </div>\n                    <div class=\"kityminder-container\" id=\"mainKityMinderContainer\">\n                        </div>\n                    <div id=\"mermaid-main-feedback-message\"></div> <i class=\"fas fa-project-diagram card-icon\"></i>\n                </div>\n            </div>\n\n            <div class=\"card quote-card\">\n                <h2 contenteditable=\"false\"><i class=\"fas fa-quote-left\"></i> ç²¾å½©å¼•ç”¨</h2>\n                <!-- ç²¾å½©å¼•ç”¨æ¨¡æ¿åŒºåŸŸ - AIå°†åœ¨æ­¤å¤„åŠ¨æ€ç”Ÿæˆå¼•ç”¨ -->\n                <!-- QUOTES_TEMPLATE_START -->\n                <div class=\"quote\">\n                    \"[å¼•è¨€å†…å®¹]\"\n                    <div class=\"quote-author\">- @[å‘è¨€äºº]</div>\n                </div>\n                <!-- QUOTES_TEMPLATE_END -->\n                <!-- \n                è¯´æ˜ï¼šAIåº”è¯¥ï¼š\n                1. åˆ é™¤ QUOTES_TEMPLATE_START å’Œ QUOTES_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                2. æ ¹æ®å®é™…ç²¾å½©å¼•ç”¨æ•°é‡ï¼Œä¸ºæ¯æ¡å¼•ç”¨ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ quote div\n                3. ä¿æŒç›¸åŒçš„HTMLç»“æ„å’ŒCSSç±»å\n                -->\n                <i class=\"fas fa-comment-dots card-icon\"></i>\n            </div>\n\n            <div class=\"card links-card\">\n                <h2 contenteditable=\"false\"><i class=\"fas fa-link\"></i> é‡è¦é“¾æ¥ä¸èµ„æº</h2>\n                <!-- é“¾æ¥èµ„æºæ¨¡æ¿åŒºåŸŸ - AIå°†åœ¨æ­¤å¤„åŠ¨æ€ç”Ÿæˆé“¾æ¥ -->\n                <!-- LINKS_TEMPLATE_START -->\n                <div class=\"link-item\">\n                    <a href=\"[URLé“¾æ¥]\" target=\"_blank\">\n                        <i class=\"fas fa-external-link-alt link-icon\"></i>\n                        <span class=\"link-title\">[é“¾æ¥æ ‡é¢˜]</span>\n                    </a>\n                </div>\n                <div class=\"link-item\">\n                     <i class=\"fas fa-file link-icon\"></i> <span class=\"link-title\">[æ–‡æ¡£æ ‡é¢˜]</span>\n                </div>\n                <!-- LINKS_TEMPLATE_END -->\n                <!-- \n                è¯´æ˜ï¼šAIåº”è¯¥ï¼š\n                1. åˆ é™¤ LINKS_TEMPLATE_START å’Œ LINKS_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                2. æ ¹æ®å®é™…é“¾æ¥æ•°é‡ï¼Œä¸ºæ¯ä¸ªé“¾æ¥ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ link-item div\n                3. å¯¹äºå¤–éƒ¨é“¾æ¥ï¼Œä½¿ç”¨å¸¦ <a href> çš„æ ¼å¼\n                4. å¯¹äºæ–‡æ¡£/å†…éƒ¨èµ„æºï¼Œä½¿ç”¨ä¸å¸¦é“¾æ¥çš„æ ¼å¼\n                5. é€‰æ‹©åˆé€‚çš„å›¾æ ‡ï¼šfas fa-external-link-alt (å¤–éƒ¨é“¾æ¥) æˆ– fas fa-file (æ–‡æ¡£)\n                6. ä¿æŒç›¸åŒçš„HTMLç»“æ„å’ŒCSSç±»å\n                7. é‡è¦ï¼Œå…¨æ•°ç”Ÿæˆï¼Œä¸è¦é—æ¼\n                -->\n                <i class=\"fas fa-share-alt card-icon\"></i>\n            </div>\n\n            <div class=\"stats-wordcloud-row\">\n                <div class=\"card stats-card\">\n                    <h2 contenteditable=\"false\"><i class=\"fas fa-chart-line\"></i> æ´»è·ƒä¹‹æ˜Ÿ</h2>\n                    <table class=\"user-stats-table\">\n                        <thead>\n                            <tr>\n                                <th class=\"user-name-col\">ç”¨æˆ·</th>\n                                <th class=\"message-count-col\">å‘è¨€æ•°</th>\n                                <th class=\"contribution-col\">ä¸»è¦è´¡çŒ®</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <!-- æ´»è·ƒç”¨æˆ·æ¨¡æ¿åŒºåŸŸ - AIå°†åœ¨æ­¤å¤„åŠ¨æ€ç”Ÿæˆç”¨æˆ·è¡Œ -->\n                            <!-- USERS_TEMPLATE_START -->\n                            <tr>\n                                <td data-label=\"ç”¨æˆ·\" class=\"user-name-col\">@[ç”¨æˆ·å]</td>\n                                <td data-label=\"å‘è¨€æ•°\" class=\"message-count-col\">[å‘è¨€æ•°]+</td>\n                                <td data-label=\"ä¸»è¦è´¡çŒ®\" class=\"contribution-col\">[ç”¨æˆ·ä¸»è¦è´¡çŒ®å†…å®¹]</td>\n                            </tr>\n                            <!-- USERS_TEMPLATE_END -->\n                            <!-- \n                            è¯´æ˜ï¼šAIåº”è¯¥ï¼š\n                            1. åˆ é™¤ USERS_TEMPLATE_START å’Œ USERS_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                            2. æ ¹æ®å®é™…æ´»è·ƒç”¨æˆ·æ•°é‡ï¼Œä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ <tr> è¡Œ\n                            3. ä¿æŒç›¸åŒçš„HTMLç»“æ„å’ŒCSSç±»å\n                            4. ä¿æŒ data-label å±æ€§ç”¨äºç§»åŠ¨ç«¯æ˜¾ç¤º\n                            -->\n                        </tbody>\n                    </table>\n                    <i class=\"fas fa-user-friends card-icon\"></i>\n                </div>\n\n                <div class=\"card wordcloud-card\">\n                    <h2 contenteditable=\"false\"><i class=\"fas fa-tags\"></i> è¯é¢˜æ ‡ç­¾äº‘</h2>\n                    <div class=\"wordcloud\">\n                        <!-- è¯é¢˜æ ‡ç­¾äº‘æ¨¡æ¿åŒºåŸŸ - AIå°†åœ¨æ­¤å¤„åŠ¨æ€ç”Ÿæˆæ ‡ç­¾é¡¹ -->\n                        <!-- WORDCLOUD_TEMPLATE_START -->\n                        <span class=\"wordcloud-item size-5\">[ChatGPT]</span>\n                        <span class=\"wordcloud-item size-4\">[æŠ€æœ¯é—®é¢˜]</span>\n                        <span class=\"wordcloud-item size-3\">[æ€§èƒ½ä¼˜åŒ–]</span>\n                        <span class=\"wordcloud-item size-2\">[ç”¨æˆ·ä½“éªŒ]</span>\n                        <!-- WORDCLOUD_TEMPLATE_END -->\n                        <!-- \n                        è¯´æ˜ï¼šAIåº”è¯¥ï¼š\n                        1. åˆ é™¤ WORDCLOUD_TEMPLATE_START å’Œ WORDCLOUD_TEMPLATE_END ä¹‹é—´çš„æ¨¡æ¿å†…å®¹\n                        2. æ ¹æ®è¯é¢˜æ ‡ç­¾å‡ºç°é¢‘æ¬¡ï¼Œä¸ºæ¯ä¸ªæ ‡ç­¾ç”Ÿæˆä¸€ä¸ª wordcloud-item span\n                        3. ä½¿ç”¨åˆé€‚çš„å°ºå¯¸ç±»ï¼šsize-1 (æœ€å°) åˆ° size-5 (æœ€å¤§)\n                        4. æŒ‰å‡ºç°é¢‘æ¬¡æ’åºï¼Œçƒ­é—¨æ ‡ç­¾ä½¿ç”¨æ›´å¤§çš„å°ºå¯¸\n                        5. ä¼˜å…ˆæ˜¾ç¤ºä¸šå†…çƒ­è¯ï¼šChatGPTã€Claudeã€Cursorã€Agentç­‰\n                        6. ä¿æŒç›¸åŒçš„HTMLç»“æ„å’ŒCSSç±»å\n                        -->\n                    </div>\n                    <i class=\"fas fa-tags card-icon\"></i>\n                </div>\n            </div>\n\n\n            \n\n\n        </div> <div class=\"footer\">\n            <p>æ•°æ®æ¥æºï¼š[æ‚¨çš„æ•°æ®æ¥æº - ä¾‹å¦‚ï¼šAIäº§å“å›¢èŠå¤©è®°å½•] | ç”Ÿæˆæ—¥æœŸï¼š[ç”Ÿæˆæ—¥æœŸ] | ç»Ÿè®¡å‘¨æœŸï¼š[ç»Ÿè®¡å‘¨æœŸ - ä¾‹å¦‚ï¼š[æ—¥æœŸ]å…¨å¤©]</p>\n            <p>[å…è´£å£°æ˜ - ä¾‹å¦‚ï¼šæœ¬æŠ¥å‘Šç”±AIè‡ªåŠ¨ç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒï¼Œä¸ä»£è¡¨æ‰€æœ‰ç¾¤æˆå‘˜è§‚ç‚¹ã€‚]</p>\n        </div>\n    </div> <div class=\"action-buttons-container\">\n        <button id=\"screenshotToClipboardBtn\" class=\"action-button\"><i class=\"fas fa-clipboard\"></i> æ‹·è´æˆªå›¾</button>\n        <button id=\"screenshotDownloadBtn\" class=\"action-button\"><i class=\"fas fa-camera\"></i> ä¸‹è½½æˆªå›¾</button>\n        <button id=\"copyHtmlBtn\" class=\"action-button\"><i class=\"fas fa-copy\"></i> æ‹·è´æºç </button>\n        <button id=\"downloadHtmlBtn\" class=\"action-button\"><i class=\"fas fa-download\"></i> ä¸‹è½½æŠ¥å‘Š</button>\n        <button id=\"viewHistoricalReportBtn\" class=\"action-button\"><i class=\"fas fa-history\"></i> æŸ¥çœ‹å†å²æ—¥æŠ¥</button>\n        <button id=\"viewPreviousReportBtn\" class=\"action-button\"><i class=\"fas fa-calendar-alt\"></i> æŸ¥çœ‹æ˜¨æ—¥æ—¥æŠ¥</button>\n    </div>\n    <div id=\"feedback-message\"></div> <div id=\"fullscreenModal\" class=\"modal-overlay\">\n        <div class=\"modal-content card\"> <button id=\"fullscreenCloseBtn\" class=\"modal-close-btn\" aria-label=\"å…³é—­å…¨å±\">&times;</button>\n            <h2 style=\"padding-top: 15px;\"><i class=\"fas fa-sitemap\"></i> æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾ (å…¨å±)</h2>\n            <div class=\"mindmap-controls\">\n                <button id=\"modalZoomInBtn\"><i class=\"fas fa-search-plus\"></i> æ”¾å¤§</button>\n                <button id=\"modalZoomOutBtn\"><i class=\"fas fa-search-minus\"></i> ç¼©å°</button>\n                <button id=\"modalDownloadDiagramBtn\"><i class=\"fas fa-download\"></i> ä¸‹è½½ SVG</button>\n            </div>\n            <div class=\"kityminder-container\" id=\"modalKityMinderContainer\">\n                </div>\n            <div id=\"mermaid-modal-feedback-message\"></div> </div>\n    </div>\n\n    <script>\n    // --- KityMinder (æ€ç»´å¯¼å›¾) JavaScript å¼€å§‹ ---\n\n    // --- å…¨å±€å˜é‡ ---\n    let mainKM, modalKM; // åˆ†åˆ«å­˜å‚¨ä¸»è§†å›¾å’Œæ¨¡æ€æ¡†è§†å›¾çš„KityMinderå®ä¾‹\n    const kityminderData = { // æ€ç»´å¯¼å›¾æ•°æ®ç»“æ„\n        root: { // æ ¹èŠ‚ç‚¹å®šä¹‰\n            data: { text: \"æ ¸å¿ƒæ¦‚å¿µ\", expandState: \"expand\" }, // æ ¹èŠ‚ç‚¹æ˜¾ç¤ºæ–‡æœ¬å’Œé»˜è®¤å±•å¼€çŠ¶æ€\n            children: [ // å­èŠ‚ç‚¹æ•°ç»„ï¼Œæ·»åŠ ç¤ºä¾‹æ•°æ®\n                { data: { text: \"ä¸»è¦è®®é¢˜A\", expandState: \"expand\" }, children: [\n                    { data: { text: \"è®®é¢˜A-1\" } },\n                    { data: { text: \"è®®é¢˜A-2\", expandState: \"collapse\" }, children: [ // é»˜è®¤æŠ˜å çš„å­èŠ‚ç‚¹\n                        { data: { text: \"A-2-è¯¦æƒ…1\" } },\n                        { data: { text: \"A-2-è¯¦æƒ…2\" } }\n                    ]},\n                    { data: { text: \"è®®é¢˜A-3\" } }\n                ]},\n                { data: { text: \"ä¸»è¦è®®é¢˜B\" } },\n                { data: { text: \"ä¸»è¦è®®é¢˜C\", expandState: \"expand\" }, children: [\n                    { data: { text: \"è®®é¢˜C-1\" } },\n                    { data: { text: \"è®®é¢˜C-2\" } }\n                ]}\n            ]\n        },\n        template: 'default', // ä½¿ç”¨KityMinderçš„é»˜è®¤æ¨¡æ¿\n        theme: 'customPictureTheme', // åº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜\n        version: \"1.4.50\" // KityMinderç‰ˆæœ¬å·\n    };\n\n    // --- DOMå…ƒç´ è·å– ---\n    const mainZoomInBtn = document.getElementById('zoomInBtn');\n    const mainZoomOutBtn = document.getElementById('zoomOutBtn');\n    const mainDownloadDiagramBtn = document.getElementById('downloadDiagramBtn');\n    const mainKityMinderContainer = document.getElementById('mainKityMinderContainer');\n    const mermaidMainFeedbackMessage = document.getElementById('mermaid-main-feedback-message');\n    const fullscreenOpenBtn = document.getElementById('fullscreenOpenBtn');\n    const fullscreenModal = document.getElementById('fullscreenModal');\n    const fullscreenCloseBtn = document.getElementById('fullscreenCloseBtn');\n    const modalKityMinderContainer = document.getElementById('modalKityMinderContainer');\n    const modalZoomInBtn = document.getElementById('modalZoomInBtn');\n    const modalZoomOutBtn = document.getElementById('modalZoomOutBtn');\n    const modalDownloadDiagramBtn = document.getElementById('modalDownloadDiagramBtn');\n    const mermaidModalFeedbackMessage = document.getElementById('mermaid-modal-feedback-message');\n\n    // --- KityMinder è‡ªå®šä¹‰ä¸»é¢˜å®šä¹‰ ---\n    if (typeof kityminder !== 'undefined' && kityminder.Theme) {\n        kityminder.Theme.register('customPictureTheme', {\n            'root-color': 'var(--km-root-text, #333333)', 'root-background': 'var(--km-root-bg, #f0f0f0)',\n            'root-stroke': 'var(--km-root-bg)', 'root-font-size': 19, 'root-font-weight': 'bold', 'root-font-family': 'Inter, \"SF Pro Display\", \"Segoe UI\", \"Microsoft YaHei\", \"PingFang SC\", \"Hiragino Sans GB\", \"Noto Sans CJK SC\", sans-serif',\n            'root-padding': [14, 24], 'root-margin': [10, 2], 'root-radius': 5, 'root-space': 8, 'root-stroke-width': 1,\n            'main-color': 'var(--km-node-text, #ffffff)', 'main-background': 'var(--km-orange)',\n            'main-stroke': 'var(--km-orange)', 'main-font-size': 19, 'main-font-weight': 'bold', 'main-font-family': 'Inter, \"SF Pro Display\", \"Segoe UI\", \"Microsoft YaHei\", \"PingFang SC\", \"Hiragino Sans GB\", \"Noto Sans CJK SC\", sans-serif',\n            'main-padding': [10, 20], 'main-margin': [10, 2], 'main-radius': 5, 'main-space': 4, 'main-stroke-width': 1,\n            'sub-color': 'var(--km-node-text, #ffffff)', 'sub-background': 'var(--km-blue)',\n            'sub-stroke': 'var(--km-blue)', 'sub-font-size': 19, 'sub-font-weight': 'bold', 'sub-font-family': 'Inter, \"SF Pro Display\", \"Segoe UI\", \"Microsoft YaHei\", \"PingFang SC\", \"Hiragino Sans GB\", \"Noto Sans CJK SC\", sans-serif',\n            'sub-padding': [8, 16], 'sub-margin': [8, 15], 'sub-radius': 5, 'sub-space': 4, 'sub-stroke-width': 1,\n            'connect-color': 'var(--km-connect-color, #777777)', 'connect-width': 1.5, 'main-connect-width': 1.5,\n            'selected-connect-color': 'var(--km-orange)', 'selected-connect-width': 2.5,\n            'background': \"#ffffff\", 'text-selection-color': 'var(--km-blue)',\n            'node-padding': [6, 12], 'node-margin': [8, 15], 'node-radius': 5, 'font-size': 19, 'font-weight': 'bold', 'font-family': 'Inter, \"SF Pro Display\", \"Segoe UI\", \"Microsoft YaHei\", \"PingFang SC\", \"Hiragino Sans GB\", \"Noto Sans CJK SC\", sans-serif',\n        });\n        console.log(\"KityMinder Debug: è‡ªå®šä¹‰ä¸»é¢˜ 'customPictureTheme' å·²æ³¨å†Œã€‚\");\n    } else {\n        console.error(\"KityMinder Debug: kityminder æˆ– kityminder.Theme æœªå®šä¹‰ã€‚æ— æ³•æ³¨å†Œè‡ªå®šä¹‰ä¸»é¢˜ã€‚\");\n    }\n\n    // --- KityMinder è¾…åŠ©å‡½æ•° ---\n    function showKityMinderFeedback(element, message, type = 'info', duration = 3000) {\n        if (element) {\n            element.textContent = message; element.className = type; element.style.display = 'block';\n            setTimeout(() => { element.textContent = ''; element.className = ''; element.style.display = 'none'; }, duration);\n        }\n    }\n\n    async function downloadKityMinderAsSVG(kmInstance, baseFilename, feedbackElem) {\n        if (!kmInstance || typeof kmInstance.exportData !== 'function' || !kmInstance.getRoot || !kmInstance.getRoot()) {\n            showKityMinderFeedback(feedbackElem, 'æ— æ³•ä¸‹è½½ï¼šæ€ç»´å¯¼å›¾å®ä¾‹æ— æ•ˆæˆ–å†…å®¹ä¸ºç©ºã€‚', 'error'); return;\n        }\n        try {\n            if (typeof kmInstance.refresh === 'function') {\n                kmInstance.refresh(); await new Promise(resolve => setTimeout(resolve, 100));\n            }\n            const svgExportPromise = kmInstance.exportData('svg');\n            if (!svgExportPromise || typeof svgExportPromise.then !== 'function') {\n                showKityMinderFeedback(feedbackElem, 'ä¸‹è½½å¤±è´¥ï¼šå¯¼å‡ºå‡½æ•°è¡Œä¸ºå¼‚å¸¸ã€‚', 'error'); return;\n            }\n            const exportedObject = await svgExportPromise;\n            let svgString = \"\";\n            if (typeof exportedObject === 'string') { svgString = exportedObject; }\n            else if (exportedObject && typeof exportedObject.data === 'string') { svgString = exportedObject.data; }\n            else {\n                const paper = kmInstance.getPaper && kmInstance.getPaper();\n                const svgNode = paper && paper.container && paper.container.firstChild;\n                if (svgNode && typeof XMLSerializer !== 'undefined') { svgString = new XMLSerializer().serializeToString(svgNode); }\n            }\n            if (svgString && svgString.length > 100) { // Basic check for non-empty SVG\n                const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\n                const url = URL.createObjectURL(blob); const link = document.createElement('a');\n                link.href = url; link.download = `${baseFilename}.svg`; document.body.appendChild(link);\n                link.click(); document.body.removeChild(link); URL.revokeObjectURL(url);\n                showKityMinderFeedback(feedbackElem, `${baseFilename}.svg å·²ä¸‹è½½!`, 'success');\n            } else {\n                showKityMinderFeedback(feedbackElem, `ä¸‹è½½å¤±è´¥ï¼šç”Ÿæˆçš„SVGå†…å®¹ä¸ºç©ºæˆ–æ— æ•ˆã€‚è¯·ç¡®ä¿å¯¼å›¾å·²æ­£ç¡®æ¸²æŸ“ã€‚`, 'error');\n            }\n        } catch (error) {\n            console.error(`ä¸‹è½½ ${baseFilename}.svg å¤±è´¥:`, error);\n            showKityMinderFeedback(feedbackElem, `ä¸‹è½½ ${baseFilename}.svg å¤±è´¥: ${error.message || error}`, 'error');\n        }\n    }\n    \n    function setupKityMinderTouchEvents(km, container) {\n        let isPanning = false;\n        let lastPanX, lastPanY;\n\n        let isPinching = false;\n        let initialPinchDistance = 0;\n        let lastPinchZoomValue = km.getZoomValue(); \n\n        container.addEventListener('touchstart', (e) => {\n            if (e.touches.length === 1) {\n                isPanning = true;\n                isPinching = false; \n                const touch = e.touches[0];\n                lastPanX = touch.clientX;\n                lastPanY = touch.clientY;\n                e.preventDefault(); \n            } else if (e.touches.length === 2) {\n                isPinching = true;\n                isPanning = false; \n                const touch1 = e.touches[0];\n                const touch2 = e.touches[1];\n                initialPinchDistance = Math.hypot(touch1.clientX - touch2.clientX, touch1.clientY - touch2.clientY);\n                lastPinchZoomValue = km.getZoomValue(); \n                e.preventDefault(); \n            }\n        }, { passive: false });\n\n        container.addEventListener('touchmove', (e) => {\n            if (isPanning && e.touches.length === 1) {\n                const touch = e.touches[0];\n                const dx = touch.clientX - lastPanX;\n                const dy = touch.clientY - lastPanY;\n\n                const paper = km.getPaper();\n                if (paper) {\n                    const viewbox = paper.getViewBox();\n                    paper.setViewBox(viewbox.x - dx, viewbox.y - dy, viewbox.width, viewbox.height);\n                }\n                lastPanX = touch.clientX;\n                lastPanY = touch.clientY;\n                e.preventDefault();\n\n            } else if (isPinching && e.touches.length === 2) {\n                const touch1 = e.touches[0];\n                const touch2 = e.touches[1];\n                const currentPinchDistance = Math.hypot(touch1.clientX - touch2.clientX, touch1.clientY - touch2.clientY);\n\n                if (initialPinchDistance > 0) { \n                    const scaleFactor = currentPinchDistance / initialPinchDistance;\n                    let newZoomLevelPercentage = lastPinchZoomValue * scaleFactor;\n                    \n                    newZoomLevelPercentage = Math.max(20, Math.min(newZoomLevelPercentage, 300)); \n\n                    const rect = container.getBoundingClientRect();\n                    const screenPinchCenterX = (touch1.clientX + touch2.clientX) / 2 - rect.left;\n                    const screenPinchCenterY = (touch1.clientY + touch2.clientY) / 2 - rect.top;\n                    \n                    const paper = km.getPaper();\n                    let paperPinchCenter = null;\n\n                    if (paper && typeof paper.screenToPaperPoint === 'function' && typeof kity !== 'undefined' && kity.Point) {\n                        const screenPoint = new kity.Point(screenPinchCenterX, screenPinchCenterY);\n                        paperPinchCenter = paper.screenToPaperPoint(screenPoint);\n                    }\n                    \n                    km.execCommand('zoom', newZoomLevelPercentage, paperPinchCenter);\n                }\n                e.preventDefault();\n            }\n        }, { passive: false });\n\n        container.addEventListener('touchend', (e) => {\n            if (e.touches.length === 0) { \n                isPanning = false;\n                isPinching = false;\n                initialPinchDistance = 0;\n            } else if (e.touches.length === 1) { \n                if (isPinching) { \n                    isPinching = false;\n                    initialPinchDistance = 0;\n                    \n                    isPanning = true; \n                    const touch = e.touches[0];\n                    lastPanX = touch.clientX;\n                    lastPanY = touch.clientY;\n                }\n            }\n        });\n    }\n\n\n    async function initializeKityMinder(containerElement, data, feedbackElem, isModal = false) {\n        console.log(\"æ­£åœ¨åˆå§‹åŒ–KityMinderäºå®¹å™¨:\", containerElement.id);\n        containerElement.innerHTML = ''; \n        if (typeof kityminder === 'undefined' || typeof kityminder.Minder === 'undefined') {\n            showKityMinderFeedback(feedbackElem, \"KityMinderåº“æœªåŠ è½½!\", 'error'); return null;\n        }\n        try {\n            const km = new kityminder.Minder({ renderTo: containerElement });\n            km.importJson(data); km.enable(); \n            await new Promise(resolve => setTimeout(resolve, 500)); \n\n            if (km.getRoot && km.getRoot()) { \n                km.getRoot().traverse(function(node) {\n                    node.setData('font-weight', 'bold'); node.setData('font-size', 19); node.setData('stroke-width', 1);\n                    node.setData('font-family', 'Inter, \"SF Pro Display\", \"Segoe UI\", \"Microsoft YaHei\", \"PingFang SC\", \"Hiragino Sans GB\", \"Noto Sans CJK SC\", sans-serif');\n                    if (node.getLevel() === 0) { node.setData('stroke', 'var(--km-root-bg)'); node.setData('padding', [14, 24]); }\n                    else if (node.getLevel() === 1) { node.setData('stroke', 'var(--km-orange)'); node.setData('padding', [10, 20]); }\n                    else if (node.getLevel() === 2) { node.setData('stroke', 'var(--km-blue)'); node.setData('padding', [8, 16]); }\n                    else if (node.getLevel() >= 3) { \n                        node.setData('background', 'var(--km-lightblue)'); node.setData('color', 'var(--km-node-text, #ffffff)');\n                        node.setData('padding', [8, 16]); node.setData('stroke', 'var(--km-lightblue)');\n                    }\n                    node.render();\n                });\n                km.refresh(); await new Promise(resolve => setTimeout(resolve, 100));\n\n                try {\n                    const paper = km.getPaper(); const renderContainer = km.getRenderContainer();\n                    if (!paper || !renderContainer) {\n                        console.error(\"KityMinder paper æˆ– render container ä¸å¯ç”¨ï¼Œæ— æ³•è¿›è¡Œè‡ªé€‚åº”æ˜¾ç¤ºã€‚\");\n                        km.execCommand('camera', km.getRoot(), 100); km.execCommand('zoom', isModal ? 85 : 75); \n                        if (km) { setupKityMinderTouchEvents(km, containerElement); } \n                        return km;\n                    }\n                    const diagramBox = renderContainer.getBoundaryBox();\n                    if (diagramBox && diagramBox.width > 0 && diagramBox.height > 0 && isFinite(diagramBox.x) && isFinite(diagramBox.y) && isFinite(diagramBox.width) && isFinite(diagramBox.height)) {\n                        const viewPadding = 2; const containerWidth = containerElement.clientWidth; const containerHeight = containerElement.clientHeight;\n                        if (containerWidth <= 0 || containerHeight <= 0) {\n                            console.warn(\"KityMinder Debug: å®¹å™¨å°šæ— å°ºå¯¸ï¼Œæ— æ³•è¿›è¡Œè‡ªé€‚åº”ç¼©æ”¾ã€‚å›é€€åˆ°é»˜è®¤è§†å›¾ã€‚\");\n                            km.execCommand('camera', km.getRoot(), 100); km.execCommand('zoom', isModal ? 85 : 75); \n                            if (km) { setupKityMinderTouchEvents(km, containerElement); }\n                            return km;\n                        }\n                        const usableWidth = containerWidth - 2 * viewPadding; const usableHeight = containerHeight - 2 * viewPadding;\n                        const scaleX = usableWidth / diagramBox.width; const scaleY = usableHeight / diagramBox.height;\n                        let targetScale = Math.min(scaleX, scaleY);\n                        targetScale *= 0.995; \n                        let finalZoomPercent = Math.min(Math.max(targetScale * 100, 20), 100); \n                        const diagramCenterPoint = (typeof kity !== 'undefined' && kity.Point) ? new kity.Point(diagramBox.x + diagramBox.width / 2, diagramBox.y + diagramBox.height / 2) : null;\n                        km.execCommand('zoom', finalZoomPercent, diagramCenterPoint);\n\n                        if (!isModal) { \n                            const actualDiagramHeightAfterZoom = diagramBox.height * (finalZoomPercent / 100);\n                            containerElement.style.height = Math.max(parseInt(getComputedStyle(containerElement).minHeight) || 350, actualDiagramHeightAfterZoom + 30) + 'px'; \n                            containerElement.style.minHeight = '0px'; \n                        }\n                    } else {\n                        console.warn(\"KityMinder Debug: æ— æ•ˆçš„ diagramBox å°ºå¯¸ã€‚å›é€€åˆ°é»˜è®¤è§†å›¾ã€‚\");\n                        km.execCommand('camera', km.getRoot(), 100); km.execCommand('zoom', isModal ? 80 : 70);\n                    }\n                } catch (e_view) {\n                    console.error(`KityMinder Debug: è‡ªé€‚åº”è§†å›¾è°ƒæ•´å‡ºé”™ (${containerElement.id}):`, e_view);\n                    km.execCommand('camera', km.getRoot(), 100); km.execCommand('zoom', isModal ? 80 : 70);\n                }\n                km.refresh(); \n            }\n            console.log(\"KityMinder åˆå§‹åŒ–å¹¶å¯¼å…¥æ•°æ®å®Œæˆ:\", containerElement.id); \n            if (km) { \n                setupKityMinderTouchEvents(km, containerElement);\n            }\n            return km;\n        } catch (error) {\n            console.error(\"åˆå§‹åŒ– KityMinder å‡ºé”™ (\" + containerElement.id + \"):\", error);\n            showKityMinderFeedback(feedbackElem, `åˆå§‹åŒ–KityMinderå¤±è´¥: ${error.message}`, 'error');\n            containerElement.innerHTML = `<p style=\"color:red; text-align:center; padding:20px;\">åˆå§‹åŒ–KityMinderå¤±è´¥: ${error.message}</p>`;\n            return null;\n        }\n    }\n\n    // --- KityMinder äº‹ä»¶ç›‘å¬ ---\n    if(mainZoomInBtn) mainZoomInBtn.addEventListener('click', () => { if (mainKM) mainKM.execCommand('zoomIn'); });\n    if(mainZoomOutBtn) mainZoomOutBtn.addEventListener('click', () => { if (mainKM) mainKM.execCommand('zoomOut'); });\n    if(mainDownloadDiagramBtn) mainDownloadDiagramBtn.addEventListener('click', () => { downloadKityMinderAsSVG(mainKM, 'æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾-ä¸»è§†å›¾', mermaidMainFeedbackMessage); });\n\n    if(fullscreenOpenBtn) fullscreenOpenBtn.addEventListener('click', () => {\n        if(fullscreenModal) fullscreenModal.classList.add('active'); document.body.classList.add('modal-active');\n        if(modalKityMinderContainer) modalKityMinderContainer.innerHTML = ''; \n        initializeKityMinder(modalKityMinderContainer, kityminderData, mermaidModalFeedbackMessage, true).then(kmInstance => modalKM = kmInstance);\n    });\n    if(fullscreenCloseBtn) fullscreenCloseBtn.addEventListener('click', () => {\n        if(fullscreenModal) fullscreenModal.classList.remove('active'); document.body.classList.remove('modal-active');\n        if(modalKityMinderContainer) modalKityMinderContainer.innerHTML = ''; modalKM = null; \n    });\n    if(modalZoomInBtn) modalZoomInBtn.addEventListener('click', () => { if (modalKM) modalKM.execCommand('zoomIn'); });\n    if(modalZoomOutBtn) modalZoomOutBtn.addEventListener('click', () => { if (modalKM) modalKM.execCommand('zoomOut'); });\n    if(modalDownloadDiagramBtn) modalDownloadDiagramBtn.addEventListener('click', () => { downloadKityMinderAsSVG(modalKM, 'æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾-å…¨å±', mermaidModalFeedbackMessage); });\n\n    function initializeMainKityMinderDiagram() {\n        console.log(\"DOMå®Œå…¨åŠ è½½æˆ–å‡½æ•°è¢«è°ƒç”¨ã€‚æ­£åœ¨åˆå§‹åŒ–ä¸»KityMinderã€‚\");\n        if (typeof kityminder !== 'undefined' && mainKityMinderContainer) {\n            initializeKityMinder(mainKityMinderContainer, kityminderData, mermaidMainFeedbackMessage, false).then(kmInstance => mainKM = kmInstance);\n        } else {\n            if (mermaidMainFeedbackMessage) { showKityMinderFeedback(mermaidMainFeedbackMessage, \"KityMinderåº“åŠ è½½å¤±è´¥æˆ–å®¹å™¨æœªæ‰¾åˆ°ï¼Œæ— æ³•åˆå§‹åŒ–æ€ç»´å¯¼å›¾ã€‚\", \"error\"); }\n            console.error(\"KityMinderåº“æˆ–ä¸»å®¹å™¨ä¸å¯ç”¨ï¼Œæ— æ³•åˆå§‹åŒ–ã€‚\");\n        }\n    }\n    // --- KityMinder (æ€ç»´å¯¼å›¾) JavaScript ç»“æŸ ---\n\n    // --- æŠ¥å‘Šé¡µé¢é€šç”¨ JavaScript å¼€å§‹ ---\n    function getCssVariable(variableName, defaultValue = null) {\n        const value = getComputedStyle(document.documentElement).getPropertyValue(variableName).trim();\n        return value || defaultValue;\n    }\n\n    function getReportBaseName() {\n        const mainTitleElement = document.querySelector('.main-card h1'); let reportTitle = \"æŠ¥å‘Š\";\n        const placeholderTitle = \"[ä¸»æŠ¥å‘Šæ ‡é¢˜ - ä¾‹å¦‚ï¼šAIäº§å“å›¢æ—¥æŠ¥]\";\n        if (mainTitleElement && mainTitleElement.textContent) {\n            const currentTitle = mainTitleElement.textContent.trim();\n            if (currentTitle && currentTitle !== placeholderTitle) { reportTitle = currentTitle; }\n        }\n        if (reportTitle.endsWith(\"æ—¥æŠ¥\")) { reportTitle = reportTitle.substring(0, reportTitle.length - 2); }\n        return reportTitle + \"æ—¥æŠ¥\"; \n    }\n\n    function getFormattedDateString() {\n        const reportDateElement = document.querySelector('.main-card .date'); let dateStr = \"nodate\";\n        const placeholderDate = \"[æ—¥æœŸ - ä¾‹å¦‚ï¼š2025å¹´5æœˆ19æ—¥]\";\n        if (reportDateElement && reportDateElement.textContent) {\n            const dateContent = reportDateElement.textContent.trim();\n            if (dateContent && dateContent !== placeholderDate) {\n                const match = dateContent.match(/(\\d{4})å¹´\\s*(\\d{1,2})æœˆ\\s*(\\d{1,2})æ—¥/);\n                if (match) { dateStr = `${match[1]}-${match[2].padStart(2, '0')}-${match[3].padStart(2, '0')}`; }\n                else { console.warn(\"æ—¥æœŸå†…å®¹ '\" + dateContent + \"' ä¸ 'YYYYå¹´MæœˆDæ—¥' æ ¼å¼ä¸åŒ¹é…ã€‚æ–‡ä»¶åå°†ä½¿ç”¨ 'nodate'ã€‚\");}\n            } else { console.warn(\"æ—¥æœŸå†…å®¹ä¸ºå ä½ç¬¦æˆ–ç©ºã€‚æ–‡ä»¶åå°†ä½¿ç”¨ 'nodate'ã€‚\"); }\n        } else { console.warn(\"æœªæ‰¾åˆ°æ—¥æœŸå…ƒç´ æˆ–æ— å†…å®¹ã€‚æ–‡ä»¶åå°†ä½¿ç”¨ 'nodate'ã€‚\"); }\n        return dateStr;\n    }\n\n    function sanitizeFilename(filename) { return filename.replace(/[^\\w\\u4e00-\\u9fa5\\-\\.]/g, '_').replace(/_+/g, '_'); }\n\n    const previousReportUrl = \"åœ¨æ­¤å¤„å¡«å†™æ˜¨æ—¥æ—¥æŠ¥çš„URL\"; \n    const historicalReportUrl = \"https://czkzyp3cp1.feishu.cn/share/base/view/shrcnoweVpP2vDaWtAEFspjqRNf\"; \n\n    function showReportFeedbackMessage(message, type = 'info', duration = 3000) {\n        const feedbackElement = document.getElementById('feedback-message');\n        if (feedbackElement) {\n            feedbackElement.textContent = message; feedbackElement.className = type;\n            setTimeout(() => { element.textContent = ''; element.className = ''; }, duration);\n        }\n    }\n\n    async function captureScreenshot(elementToCapture) {\n        await document.fonts.ready; \n\n        const bodyBgColor = getCssVariable('--bg-primary', '#F5F5EE');\n        const cardBgColor = getCssVariable('--bg-secondary', '#faf9f6');\n        const tertiaryBgColor = getCssVariable('--bg-tertiary', '#f1f3f5');\n        const highlightKeywordBgColor = getCssVariable('--highlight-keyword-bg', '#ffe8cc');\n        const kityMinderContainerBgColor = '#ffffff'; \n\n        if (typeof mainKM !== 'undefined' && mainKM && typeof mainKM.refresh === 'function') {\n            try { mainKM.refresh(); await new Promise(resolve => setTimeout(resolve, 150)); } \n            catch (e) { console.warn(\"åˆ·æ–°KityMinderæ—¶å‡ºé”™:\", e); }\n        }\n\n        return html2canvas(elementToCapture, {\n            useCORS: true, scale: window.devicePixelRatio || 1.5, logging: false, backgroundColor: bodyBgColor,\n            width: elementToCapture.scrollWidth, height: elementToCapture.scrollHeight,\n            windowWidth: elementToCapture.scrollWidth, windowHeight: elementToCapture.scrollHeight,\n            x: 0, y: 0, scrollX: 0, scrollY: 0,\n            onclone: function(clonedDoc) {\n                clonedDoc.body.style.backgroundColor = bodyBgColor;\n                clonedDoc.documentElement.style.backgroundColor = bodyBgColor;\n                const reportWrapper = clonedDoc.getElementById('report-content-wrapper');\n                if (reportWrapper) {\n                    reportWrapper.style.backgroundColor = bodyBgColor;\n                    reportWrapper.style.height = elementToCapture.scrollHeight + 'px'; \n                    reportWrapper.style.overflow = 'visible'; \n                }\n                clonedDoc.querySelectorAll('.card').forEach(card => { card.style.backgroundColor = cardBgColor; card.style.overflow = 'visible'; });\n                const mindmapCardContainer = clonedDoc.querySelector('.mindmap-card-container.card');\n                if (mindmapCardContainer) { mindmapCardContainer.style.backgroundColor = cardBgColor; }\n\n                clonedDoc.querySelectorAll('.kityminder-container').forEach(kmContainer => {\n                    kmContainer.style.backgroundColor = kityMinderContainerBgColor; kmContainer.style.overflow = 'visible';\n                    const svgElements = kmContainer.querySelectorAll('svg');\n                    svgElements.forEach(svg => {\n                        svg.style.overflow = 'visible !important'; \n                        const originalKmContainer = document.getElementById(kmContainer.id);\n                        if (originalKmContainer) {\n                            const originalSvg = originalKmContainer.querySelector('svg');\n                            if (originalSvg) {\n                                svg.setAttribute('width', originalSvg.getAttribute('width'));\n                                svg.setAttribute('height', originalSvg.getAttribute('height'));\n                                svg.setAttribute('viewBox', originalSvg.getAttribute('viewBox'));\n                            }\n                        }\n                    });\n                });\n                clonedDoc.querySelectorAll('.link-item, .qr-code-item, .meta-info span, .tag').forEach(el => { el.style.backgroundColor = tertiaryBgColor; });\n                clonedDoc.querySelectorAll('.highlight-keyword').forEach(el => { \n                    el.style.display = 'inline'; el.style.padding = '1px 2px'; el.style.lineHeight = '1.2';\n                    el.style.boxDecorationBreak = 'clone'; el.style.webkitBoxDecorationBreak = 'clone';\n                    el.style.backgroundColor = highlightKeywordBgColor;\n                });\n                const allElements = clonedDoc.getElementsByTagName(\"*\");\n                for (let i = 0; i < allElements.length; i++) {\n                    allElements[i].style.transition = 'none !important'; allElements[i].style.animation = 'none !important';\n                }\n            }\n        });\n    }\n\n    const screenshotToClipboardBtn = document.getElementById('screenshotToClipboardBtn');\n    if(screenshotToClipboardBtn) screenshotToClipboardBtn.addEventListener('click', async function() {\n        const reportContent = document.getElementById('report-content-wrapper');\n        if (!reportContent) { showReportFeedbackMessage('æˆªå›¾é”™è¯¯: æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚', 'error'); return; }\n        const actionButtons = document.querySelector('.action-buttons-container');\n        const feedbackMsgElement = document.getElementById('feedback-message');\n        const originalButtonText = this.innerHTML; this.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> å¤„ç†ä¸­...'; this.disabled = true;\n        if(actionButtons) actionButtons.style.visibility = 'hidden'; if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';\n        try {\n            await new Promise(resolve => setTimeout(resolve, 500)); \n            const canvas = await captureScreenshot(reportContent);\n            canvas.toBlob(async function(blob) {\n                if (blob) {\n                    try {\n                        if (navigator.clipboard && navigator.clipboard.write) { \n                            await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);\n                            showReportFeedbackMessage('æˆªå›¾å·²æ‹·è´åˆ°å‰ªè´´æ¿!', 'success');\n                        } else { \n                            const dataUrl = canvas.toDataURL('image/png'); const img = document.createElement('img');\n                            img.src = dataUrl; img.style.maxWidth = '100%'; img.style.border = '1px solid #ccc';\n                            const tempContainer = document.createElement('div');\n                            tempContainer.style.cssText = 'position:fixed;top:10px;left:10px;z-index:9999;background-color:white;padding:10px;border:1px solid black;';\n                            tempContainer.innerHTML = '<strong>è¯·æ‰‹åŠ¨å³é”®å¤åˆ¶å›¾ç‰‡:</strong><br>'; tempContainer.appendChild(img);\n                            document.body.appendChild(tempContainer);\n                            showReportFeedbackMessage('æˆªå›¾å·²ç”Ÿæˆã€‚è¯·æ‰‹åŠ¨å³é”®å¤åˆ¶å›¾ç‰‡ã€‚æ­¤æç¤ºå°†åœ¨10ç§’åæ¶ˆå¤±ã€‚', 'info', 10000);\n                            setTimeout(() => { if(document.body.contains(tempContainer)) document.body.removeChild(tempContainer); }, 10000);\n                        }\n                    } catch (copyError) {\n                        console.error('æ‹·è´åˆ°å‰ªè´´æ¿å¤±è´¥:', copyError);\n                        showReportFeedbackMessage('æ‹·è´æˆªå›¾åˆ°å‰ªè´´æ¿å¤±è´¥: ' + copyError.message, 'error', 5000);\n                    }\n                } else { throw new Error('æ— æ³•å°†Canvasè½¬æ¢ä¸ºBlobã€‚'); }\n            }, 'image/png');\n        } catch (error) {\n            console.error('æˆªå›¾æ•è·å¤±è´¥:', error); showReportFeedbackMessage('æˆªå›¾æ•è·å¤±è´¥: ' + error.message, 'error');\n        } finally {\n            if(actionButtons) actionButtons.style.visibility = 'visible'; if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible';\n            this.innerHTML = originalButtonText; this.disabled = false;\n        }\n    });\n\n    const screenshotDownloadBtn = document.getElementById('screenshotDownloadBtn');\n    if(screenshotDownloadBtn) screenshotDownloadBtn.addEventListener('click', async function() {\n        const reportContent = document.getElementById('report-content-wrapper');\n        if (!reportContent) { showReportFeedbackMessage('æˆªå›¾é”™è¯¯: æœªæ‰¾åˆ°æŠ¥å‘Šå†…å®¹ã€‚', 'error'); return; }\n        const actionButtons = document.querySelector('.action-buttons-container');\n        const feedbackMsgElement = document.getElementById('feedback-message');\n        const originalButtonText = this.innerHTML; this.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> ç”Ÿæˆä¸­...'; this.disabled = true;\n        if(actionButtons) actionButtons.style.visibility = 'hidden'; if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'hidden';\n        try {\n            await new Promise(resolve => setTimeout(resolve, 500)); \n            const canvas = await captureScreenshot(reportContent);\n            const image = canvas.toDataURL('image/png'); const link = document.createElement('a');\n            const reportBaseName = getReportBaseName(); const dateSuffix = getFormattedDateString();\n            let filename = sanitizeFilename(reportBaseName + '-' + dateSuffix) + '.png';\n            link.href = image; link.download = filename; document.body.appendChild(link); link.click(); document.body.removeChild(link);\n            showReportFeedbackMessage('æˆªå›¾å·²ä¸‹è½½ä¸º ' + filename + '!', 'success');\n        } catch (error) {\n            console.error('ä¸‹è½½æˆªå›¾å¤±è´¥:', error); showReportFeedbackMessage('ä¸‹è½½æˆªå›¾å¤±è´¥: ' + error.message, 'error');\n        } finally {\n            if(actionButtons) actionButtons.style.visibility = 'visible'; if(feedbackMsgElement) feedbackMsgElement.style.visibility = 'visible';\n            this.innerHTML = originalButtonText; this.disabled = false;\n        }\n    });\n\n    const downloadHtmlBtn = document.getElementById('downloadHtmlBtn');\n    if(downloadHtmlBtn) downloadHtmlBtn.addEventListener('click', function() {\n        try {\n            const htmlContent = document.documentElement.outerHTML;\n            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });\n            const link = document.createElement('a');\n            const reportBaseName = getReportBaseName(); const dateSuffix = getFormattedDateString();\n            let filename = sanitizeFilename(reportBaseName + '-' + dateSuffix) + '.html';\n            link.href = URL.createObjectURL(blob); link.download = filename; document.body.appendChild(link);\n            link.click(); document.body.removeChild(link); URL.revokeObjectURL(link.href);\n            showReportFeedbackMessage('HTMLæŠ¥å‘Šå·²ä¸‹è½½ä¸º ' + filename + '!', 'success');\n        } catch (error) {\n            console.error('ä¸‹è½½HTMLå¤±è´¥:', error); showReportFeedbackMessage('ä¸‹è½½HTMLå¤±è´¥: ' + error.message, 'error');\n        }\n    });\n\n    const copyHtmlBtn = document.getElementById('copyHtmlBtn');\n    if(copyHtmlBtn) copyHtmlBtn.addEventListener('click', function() {\n        const htmlContent = document.documentElement.outerHTML; const Gthis = this; \n        const originalButtonHTML = Gthis.innerHTML; const textarea = document.createElement('textarea');\n        textarea.value = htmlContent; textarea.style.position = 'fixed'; textarea.style.top = '-9999px'; textarea.style.left = '-9999px'; \n        document.body.appendChild(textarea);\n        try {\n            textarea.select(); textarea.setSelectionRange(0, textarea.value.length); \n            if (document.execCommand('copy')) { \n                Gthis.innerHTML = '<i class=\"fas fa-check\"></i> å·²æ‹·è´!';\n                showReportFeedbackMessage('HTMLå·²æ‹·è´åˆ°å‰ªè´´æ¿!', 'success', 2000);\n            } else {\n                Gthis.innerHTML = '<i class=\"fas fa-times\"></i> æ‹·è´å¤±è´¥';\n                showReportFeedbackMessage('æ‹·è´å¤±è´¥ã€‚æ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒæ­¤æ“ä½œã€‚', 'error', 2000);\n            }\n        } catch (err) {\n            Gthis.innerHTML = '<i class=\"fas fa-times\"></i> æ‹·è´å‡ºé”™';\n            showReportFeedbackMessage('æ‹·è´å‡ºé”™: ' + err.message, 'error', 2000); console.error('æ‹·è´HTMLæºç å‡ºé”™:', err);\n        } finally {\n            setTimeout(function() { Gthis.innerHTML = originalButtonHTML; }, 2000); \n            document.body.removeChild(textarea); \n        }\n    });\n\n    const viewHistoricalReportBtn = document.getElementById('viewHistoricalReportBtn');\n    if(viewHistoricalReportBtn) viewHistoricalReportBtn.addEventListener('click', function() {\n        const urlToOpen = historicalReportUrl.trim();\n        if (urlToOpen && (urlToOpen.startsWith('http://') || urlToOpen.startsWith('https://'))) {\n            const newWindow = window.open(urlToOpen, '_blank');\n            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') { \n                showReportFeedbackMessage('æ— æ³•æ‰“å¼€æ–°çª—å£ã€‚è¯·æ£€æŸ¥æ‚¨çš„å¼¹å‡ºçª—å£æ‹¦æˆªè®¾ç½®ã€‚', 'error', 5000);\n            }\n        } else { showReportFeedbackMessage('å†å²æ—¥æŠ¥çš„URLæ— æ•ˆã€‚', 'error', 5000); }\n    });\n\n    const viewPreviousReportBtn = document.getElementById('viewPreviousReportBtn');\n    if(viewPreviousReportBtn) viewPreviousReportBtn.addEventListener('click', function() {\n        const urlToOpen = previousReportUrl.trim();\n        const placeholderUrlText = \"åœ¨æ­¤å¤„å¡«å†™æ˜¨æ—¥æ—¥æŠ¥çš„URL\";\n        if (urlToOpen && urlToOpen !== placeholderUrlText && (urlToOpen.startsWith('http://') || urlToOpen.startsWith('https://') || !urlToOpen.includes('://'))) { \n            const newWindow = window.open(urlToOpen, '_blank');\n            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {\n                showReportFeedbackMessage('æ— æ³•æ‰“å¼€æ–°çª—å£ã€‚è¯·æ£€æŸ¥æ‚¨çš„å¼¹å‡ºçª—å£æ‹¦æˆªè®¾ç½®ã€‚', 'error', 5000);\n            }\n        } else { showReportFeedbackMessage('æ˜¨æ—¥æ—¥æŠ¥çš„URLæœªé…ç½®æˆ–æ— æ•ˆã€‚è¯·æ£€æŸ¥è„šæœ¬ä¸­çš„ previousReportUrl å˜é‡ã€‚', 'error', 5000); }\n    });\n\n    // --- æŸ¥çœ‹æ›´å¤šèŠå¤©è®°å½•åŠŸèƒ½ JavaScript å¼€å§‹ - é‡æ–°è®¾è®¡ ---\n    \n    // è°ƒè¯•å¼€å…³\n    const DEBUG_EXPAND_MESSAGES = true; // è®¾ç½®ä¸º true å¯ç”¨è°ƒè¯•ä¿¡æ¯\n    \n    // å­˜å‚¨æ¯ä¸ªè¯é¢˜çš„å®Œæ•´èŠå¤©è®°å½•æ•°æ®å’ŒçŠ¶æ€\n    let topicMessagesData = {};\n    let expandStates = new Map(); // å­˜å‚¨æ¯ä¸ªè¯é¢˜çš„å±•å¼€çŠ¶æ€\n    \n    // æ¯æ¬¡åŠ è½½çš„æ¶ˆæ¯æ•°é‡\n    const MESSAGES_PER_LOAD = 5;\n    \n    /**\n     * åˆå§‹åŒ–è¯é¢˜èŠå¤©è®°å½•æ•°æ®\n     * AIä½¿ç”¨è¯´æ˜ï¼šåœ¨ç”ŸæˆHTMLæ—¶ï¼Œéœ€è¦å°†æ¯ä¸ªè¯é¢˜çš„å®Œæ•´messagesæ•°ç»„åµŒå…¥åˆ°è¿™ä¸ªå‡½æ•°ä¸­\n     */\n    function initializeTopicMessagesData() {\n        /* TOPIC_MESSAGES_DATA_PLACEHOLDER_START */\n        // AIå°†åœ¨æ­¤å¤„æ›¿æ¢ä¸ºå®é™…çš„è¯é¢˜æ¶ˆæ¯æ•°æ®ï¼Œæ ¼å¼ç¤ºä¾‹ï¼š\n        // topicMessagesData = {\n        //     \"merged_004\": [\n        //         { sender_name: \"æ¨é£\", content: \"æœ‰æ—¶å€™agentä¹‹é—´çš„æ²Ÿé€šå°±æ˜¯è¿™ä¹ˆç®€å•ç²—æš´[æ—ºæŸ´] è¿™éƒ½å¾—ç›Šäºä¸€ä¸ªå«åš -p çš„å‚æ•°\", time: \"2025-06-29T11:41:27+08:00\" },\n        //         { sender_name: \"Î›-xzy\", content: \"Monica é«˜çº§ç‰ˆæœ‰éœ€è¦çš„å—ï¼Œè¿˜æœ‰åŠå¹´ï¼Œé—²ç½®äº†ã€‚å¹³æ—¶ä¸»åŠ›è¯¥ç”¨ gpt plus å’Œ gemini pro äº†\", time: \"2025-06-29T11:51:28+08:00\" },\n        //         // ... è¯¥è¯é¢˜çš„æ‰€æœ‰å…¶ä»–æ¶ˆæ¯\n        //     ],\n        //     \"å¦ä¸€ä¸ªè¯é¢˜ID\": [\n        //         // ... è¯¥è¯é¢˜çš„æ‰€æœ‰æ¶ˆæ¯\n        //     ]\n        // };\n        topicMessagesData = {};\n        /* TOPIC_MESSAGES_DATA_PLACEHOLDER_END */\n    }\n    \n    /**\n     * æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º\n     */\n    function formatMessageTime(timeString) {\n        if (!timeString) return { relative: '', full: '' };\n        \n        const messageTime = new Date(timeString);\n        \n        // å§‹ç»ˆæ˜¾ç¤ºå…·ä½“æ—¥æœŸæ—¶é—´\n        const relativeTime = messageTime.toLocaleString('zh-CN', {\n            month: 'numeric',\n            day: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n        }).replace(/\\//g, '-');\n        \n        const fullTime = messageTime.toLocaleString('zh-CN', {\n            year: 'numeric',\n            month: '2-digit',\n            day: '2-digit',\n            hour: '2-digit',\n            minute: '2-digit',\n            second: '2-digit'\n        });\n        \n        return { relative: relativeTime, full: fullTime };\n    }\n    \n    /**\n     * åˆ›å»ºæ—¶é—´åˆ†éš”ç¬¦\n     */\n    function createTimeDivider(timeString) {\n        const divider = document.createElement('div');\n        divider.className = 'time-divider';\n        \n        const messageTime = new Date(timeString);\n        const today = new Date();\n        const yesterday = new Date(today);\n        yesterday.setDate(today.getDate() - 1);\n        \n        let dividerText = '';\n        \n        if (messageTime.toDateString() === today.toDateString()) {\n            dividerText = 'ä»Šå¤©';\n        } else if (messageTime.toDateString() === yesterday.toDateString()) {\n            dividerText = 'æ˜¨å¤©';\n        } else {\n            dividerText = messageTime.toLocaleDateString('zh-CN', {\n                month: 'long',\n                day: 'numeric',\n                weekday: 'short'\n            });\n        }\n        \n        const textSpan = document.createElement('span');\n        textSpan.className = 'time-divider-text';\n        textSpan.textContent = dividerText;\n        \n        divider.appendChild(textSpan);\n        return divider;\n    }\n    \n    /**\n     * åˆ›å»ºæ—¶é—´è·³è·ƒæŒ‡ç¤ºå™¨\n     */\n    function createTimeJumpIndicator(hoursDiff) {\n        const indicator = document.createElement('div');\n        indicator.className = 'time-jump-indicator';\n        \n        let jumpText = '';\n        if (hoursDiff < 1) {\n            const minutes = Math.round(hoursDiff * 60);\n            jumpText = `æ—¶é—´è·³è·ƒ ${minutes}åˆ†é’Ÿ`;\n        } else if (hoursDiff < 24) {\n            jumpText = `æ—¶é—´è·³è·ƒ ${Math.round(hoursDiff)}å°æ—¶`;\n        } else {\n            const days = Math.round(hoursDiff / 24);\n            jumpText = `æ—¶é—´è·³è·ƒ ${days}å¤©`;\n        }\n        \n        indicator.innerHTML = `\n            <span class=\"jump-icon\">â°</span>\n            <span class=\"jump-text\">${jumpText}</span>\n        `;\n        \n        return indicator;\n    }\n    \n    /**\n     * åˆ›å»ºå±•å¼€åŒºåŸŸçš„æ—¶é—´åˆ†éš”ç¬¦\n     */\n    function createExpandedTimeDivider(timeString) {\n        const divider = document.createElement('div');\n        divider.className = 'expanded-time-divider';\n        \n        const messageTime = new Date(timeString);\n        const today = new Date();\n        const yesterday = new Date(today);\n        yesterday.setDate(today.getDate() - 1);\n        \n        let dividerText = '';\n        \n        if (messageTime.toDateString() === today.toDateString()) {\n            dividerText = 'ä»Šå¤©';\n        } else if (messageTime.toDateString() === yesterday.toDateString()) {\n            dividerText = 'æ˜¨å¤©';\n        } else {\n            dividerText = messageTime.toLocaleDateString('zh-CN', {\n                month: 'long',\n                day: 'numeric',\n                weekday: 'short'\n            });\n        }\n        \n        const textSpan = document.createElement('span');\n        textSpan.className = 'expanded-time-divider-text';\n        textSpan.textContent = dividerText;\n        \n        divider.appendChild(textSpan);\n        return divider;\n    }\n    \n    /**\n     * åˆ›å»ºå±•å¼€åŒºåŸŸçš„æ—¶é—´è·³è·ƒæŒ‡ç¤ºå™¨\n     */\n    function createExpandedTimeJump(hoursDiff) {\n        const indicator = document.createElement('div');\n        indicator.className = 'expanded-time-jump';\n        \n        let jumpText = '';\n        if (hoursDiff < 1) {\n            const minutes = Math.round(hoursDiff * 60);\n            jumpText = `æ—¶é—´è·³è·ƒ ${minutes}åˆ†é’Ÿ`;\n        } else if (hoursDiff < 24) {\n            jumpText = `æ—¶é—´è·³è·ƒ ${Math.round(hoursDiff)}å°æ—¶`;\n        } else {\n            const days = Math.round(hoursDiff / 24);\n            jumpText = `æ—¶é—´è·³è·ƒ ${days}å¤©`;\n        }\n        \n        indicator.innerHTML = `\n            <span class=\"jump-icon\">â°</span>\n            <span>${jumpText}</span>\n        `;\n        \n        return indicator;\n    }\n    \n    /**\n     * åˆ›å»ºå±•å¼€æ¶ˆæ¯HTMLå…ƒç´  - å…¨æ–°æ ·å¼\n     */\n    function createExpandedMessageElement(message, showTimeDivider = false, timeJumpHours = null) {\n        const fragment = document.createDocumentFragment();\n        \n        // å¦‚æœéœ€è¦æ˜¾ç¤ºæ—¶é—´è·³è·ƒæŒ‡ç¤ºå™¨\n        if (timeJumpHours !== null && timeJumpHours >= 0.5) {\n            const jumpIndicator = createExpandedTimeJump(timeJumpHours);\n            fragment.appendChild(jumpIndicator);\n        }\n        \n        // å¦‚æœéœ€è¦æ˜¾ç¤ºæ—¶é—´åˆ†éš”ç¬¦ï¼ˆæ—¥æœŸå˜åŒ–ï¼‰\n        if (showTimeDivider && message.time) {\n            const timeDivider = createExpandedTimeDivider(message.time);\n            fragment.appendChild(timeDivider);\n        }\n        \n        const messageDiv = document.createElement('div');\n        messageDiv.className = 'expanded-message';\n        \n        // åˆ›å»ºæ¶ˆæ¯å¤´éƒ¨\n        const headerDiv = document.createElement('div');\n        headerDiv.className = 'expanded-message-header';\n        \n        const authorSpan = document.createElement('span');\n        authorSpan.className = 'expanded-message-author';\n        authorSpan.textContent = message.sender_name;\n        \n        // æ·»åŠ æ—¶é—´æ˜¾ç¤º\n        if (message.time) {\n            const timeInfo = formatMessageTime(message.time);\n            const timeSpan = document.createElement('span');\n            timeSpan.className = 'expanded-message-time';\n            timeSpan.textContent = timeInfo.relative;\n            timeSpan.setAttribute('data-full-time', timeInfo.full);\n            \n            headerDiv.appendChild(authorSpan);\n            headerDiv.appendChild(timeSpan);\n        } else {\n            headerDiv.appendChild(authorSpan);\n        }\n        \n        const contentDiv = document.createElement('div');\n        contentDiv.className = 'expanded-message-content';\n        contentDiv.textContent = message.content;\n        \n        messageDiv.appendChild(headerDiv);\n        messageDiv.appendChild(contentDiv);\n        fragment.appendChild(messageDiv);\n        \n        return fragment;\n    }\n    \n    /**\n     * åˆ›å»º\"å±•å¼€å®Œæ•´å¯¹è¯\"æŒ‰é’®\n     */\n    function createExpandButton(topicId, remainingCount) {\n        const section = document.createElement('div');\n        section.className = 'load-more-section';\n        \n        const expandButton = document.createElement('button');\n        expandButton.className = 'load-more-button';\n        expandButton.setAttribute('data-topic-id', topicId);\n        \n        expandButton.innerHTML = `\n            <i class=\"fas fa-chevron-down\"></i>\n            <span>å±•å¼€å®Œæ•´å¯¹è¯</span>\n            <span class=\"progress-text\">(è¿˜æœ‰${remainingCount}æ¡æ¶ˆæ¯)</span>\n        `;\n        \n        expandButton.addEventListener('click', function() {\n            loadMoreMessages(this);\n        });\n        \n        section.appendChild(expandButton);\n        return section;\n    }\n    \n    /**\n     * åˆ›å»º\"æŸ¥çœ‹æ›´å¤š\"æŒ‰é’®ï¼ˆå‘åå…¼å®¹ï¼‰\n     */\n    function createLoadMoreButton(topicId, shownCount, totalCount) {\n        return createExpandButton(topicId, totalCount - shownCount);\n    }\n    \n    /**\n     * åˆ›å»ºå±•å¼€åŒºåŸŸå®¹å™¨\n     */\n    function createExpandedArea(topicId, shownCount, totalCount) {\n        const area = document.createElement('div');\n        area.className = 'expanded-messages-area';\n        area.setAttribute('data-topic-id', topicId);\n        \n        // åˆ›å»ºå¤´éƒ¨\n        const header = document.createElement('div');\n        header.className = 'expanded-area-header';\n        \n        const title = document.createElement('div');\n        title.className = 'expanded-area-title';\n        title.innerHTML = `\n            <i class=\"fas fa-comments icon\"></i>\n            <span>å®Œæ•´å¯¹è¯è®°å½•</span>\n        `;\n        \n        const progress = document.createElement('div');\n        progress.className = 'expanded-area-progress';\n        progress.textContent = `å…± ${totalCount} æ¡æ¶ˆæ¯`;\n        \n        header.appendChild(title);\n        header.appendChild(progress);\n        area.appendChild(header);\n        \n        // åˆ›å»ºå†…å®¹åŒºåŸŸ\n        const content = document.createElement('div');\n        content.className = 'expanded-messages-content';\n        area.appendChild(content);\n        \n        // æ·»åŠ è¯´æ˜æ–‡æœ¬\n        const note = document.createElement('div');\n        note.style.cssText = 'padding: 0.75rem; margin-bottom: 0.5rem; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.8rem; color: #64748b; text-align: center;';\n        note.textContent = 'ä»¥ä¸‹æ˜¯è¯¥è¯é¢˜çš„å®Œæ•´å¯¹è¯è®°å½•ï¼ŒæŒ‰æ—¶é—´é¡ºåºæ’åˆ—';\n        content.appendChild(note);\n        \n        // åˆ›å»ºåº•éƒ¨æ“ä½œåŒº\n        const footer = document.createElement('div');\n        footer.className = 'expanded-area-footer';\n        area.appendChild(footer);\n        \n        return area;\n    }\n    \n    /**\n     * åˆ›å»ºä¸€é”®æ”¶èµ·æŒ‰é’®\n     */\n    function createCollapseAllButton(topicId) {\n        const button = document.createElement('button');\n        button.className = 'collapse-all-button';\n        button.setAttribute('data-topic-id', topicId);\n        \n        button.innerHTML = `\n            <i class=\"fas fa-chevron-up\"></i>\n            <span>æ”¶èµ·å¯¹è¯</span>\n        `;\n        \n        button.addEventListener('click', function() {\n            collapseAllMessages(this);\n        });\n        \n        return button;\n    }\n    \n    /**\n     * åˆ›å»ºåŠ è½½æŒ‡ç¤ºå™¨\n     */\n    function createLoadingIndicator() {\n        const indicator = document.createElement('div');\n        indicator.className = 'loading-indicator';\n        indicator.innerHTML = `\n            <div class=\"spinner\"></div>\n            <span>æ­£åœ¨åŠ è½½å®Œæ•´å¯¹è¯è®°å½•...</span>\n        `;\n        return indicator;\n    }\n    \n    /**\n     * åŠ è½½å®Œæ•´å¯¹è¯ - å…¨æ–°è®¾è®¡çš„æ ¸å¿ƒå‡½æ•°\n     */\n    function loadMoreMessages(button) {\n        const topicId = button.getAttribute('data-topic-id');\n        const container = document.querySelector(`[data-topic-id=\"${topicId}\"]`);\n        \n        if (!topicMessagesData[topicId] || !container) {\n            console.warn(`æœªæ‰¾åˆ°è¯é¢˜ ${topicId} çš„æ¶ˆæ¯æ•°æ®æˆ–å®¹å™¨`);\n            return;\n        }\n        \n        const state = expandStates.get(topicId);\n        \n        // æŒ‰æ—¶é—´é¡ºåºè·å–æ‰€æœ‰æ¶ˆæ¯\n        const allMessages = [...topicMessagesData[topicId]];\n        allMessages.sort((a, b) => new Date(a.time) - new Date(b.time));\n        \n        // è·å–å·²æ˜¾ç¤ºçš„æ¶ˆæ¯å†…å®¹ï¼Œç”¨äºå»é‡\n        const topicCard = container.closest('.topic-card');\n        const chatConversation = topicCard.querySelector('.chat-conversation');\n        const initialMessageContents = new Set();\n        \n        if (chatConversation) {\n            const initialMessageElements = chatConversation.querySelectorAll('.chat-message .message-content');\n            initialMessageElements.forEach(element => {\n                initialMessageContents.add(element.textContent.trim());\n            });\n        }\n        \n        // è·å–æ‰€æœ‰æ¶ˆæ¯ç”¨äºå±•å¼€ï¼ˆå®Œæ•´å¯¹è¯è®°å½•åº”è¯¥åŒ…å«æ‰€æœ‰æ¶ˆæ¯ï¼‰\n        const messagesToExpand = allMessages.filter((message) => {\n            // ä¸è¿‡æ»¤ä»»ä½•æ¶ˆæ¯ï¼Œå±•å¼€åŒºåŸŸæ˜¾ç¤ºå®Œæ•´çš„æ—¶é—´é¡ºåºå¯¹è¯\n            return true;\n        });\n        \n        if (messagesToExpand.length === 0) {\n            console.warn('æ²¡æœ‰æ›´å¤šæ¶ˆæ¯å¯ä»¥å±•å¼€');\n            return;\n        }\n        \n        // è°ƒè¯•ä¿¡æ¯\n        if (DEBUG_EXPAND_MESSAGES) {\n            console.log(`è¯é¢˜ ${topicId}: æ€»æ¶ˆæ¯æ•°=${allMessages.length}, åˆå§‹æ˜¾ç¤º=${state.initialCount}, å®Œæ•´å±•å¼€=${messagesToExpand.length}`);\n            console.log('å·²æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹:', Array.from(initialMessageContents));\n            console.log('å®Œæ•´å¯¹è¯æ¶ˆæ¯:', messagesToExpand.map(m => m.content.substring(0, 50) + '...'));\n        }\n        \n        // ç§»é™¤å½“å‰æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨\n        const currentSection = button.closest('.load-more-section');\n        if (!currentSection) {\n            console.warn('æœªæ‰¾åˆ°æŒ‰é’®çš„çˆ¶èŠ‚ç‚¹');\n            return;\n        }\n        const loadingIndicator = createLoadingIndicator();\n        container.replaceChild(loadingIndicator, currentSection);\n        \n        // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ\n        setTimeout(() => {\n            // åˆ›å»ºå±•å¼€åŒºåŸŸ\n            const expandedArea = createExpandedArea(topicId, state.initialCount, allMessages.length);\n            const contentArea = expandedArea.querySelector('.expanded-messages-content');\n            const footerArea = expandedArea.querySelector('.expanded-area-footer');\n            \n            // æ·»åŠ æ‰€æœ‰å±•å¼€çš„æ¶ˆæ¯\n            messagesToExpand.forEach((message, index) => {\n                let showTimeDivider = false;\n                let timeJumpHours = null;\n                \n                // æ£€æŸ¥æ—¶é—´è·³è·ƒå’Œæ—¥æœŸåˆ†éš”ç¬¦\n                if (index === 0) {\n                    // ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼šæ£€æŸ¥ä¸åˆå§‹æ¶ˆæ¯çš„æ—¶é—´å·®\n                    const topicCard = container.closest('.topic-card');\n                    const chatConversation = topicCard.querySelector('.chat-conversation');\n                    const lastInitialMessage = chatConversation ? chatConversation.querySelector('.chat-message:last-child') : null;\n                    \n                    if (lastInitialMessage && message.time) {\n                        const lastTimeSpan = lastInitialMessage.querySelector('.message-time');\n                        if (lastTimeSpan) {\n                            const lastTime = new Date(lastTimeSpan.getAttribute('data-full-time'));\n                            const currentTime = new Date(message.time);\n                            const timeDiffHours = Math.abs(currentTime - lastTime) / (1000 * 60 * 60);\n                            \n                            if (timeDiffHours >= 0.5) {\n                                timeJumpHours = timeDiffHours;\n                            }\n                            \n                            showTimeDivider = lastTime.toDateString() !== currentTime.toDateString();\n                        }\n                    }\n                } else {\n                    // æ£€æŸ¥ä¸å‰ä¸€æ¡å±•å¼€æ¶ˆæ¯çš„æ—¶é—´å·®\n                    const prevMessage = messagesToExpand[index - 1];\n                    if (prevMessage.time && message.time) {\n                        const prevTime = new Date(prevMessage.time);\n                        const currentTime = new Date(message.time);\n                        const timeDiffHours = Math.abs(currentTime - prevTime) / (1000 * 60 * 60);\n                        \n                        if (timeDiffHours >= 0.5) {\n                            timeJumpHours = timeDiffHours;\n                        }\n                        \n                        showTimeDivider = prevTime.toDateString() !== currentTime.toDateString();\n                    }\n                }\n                \n                const messageElement = createExpandedMessageElement(message, showTimeDivider, timeJumpHours);\n                \n                // è®¾ç½®åŠ¨ç”»å»¶è¿Ÿ\n                const expandedMessage = messageElement.querySelector('.expanded-message');\n                if (expandedMessage) {\n                    expandedMessage.style.animationDelay = `${(index % 6) * 0.05}s`;\n                }\n                \n                contentArea.appendChild(messageElement);\n            });\n            \n            // æ·»åŠ æ”¶èµ·æŒ‰é’®åˆ°åº•éƒ¨æ“ä½œåŒº\n            const collapseButton = createCollapseAllButton(topicId);\n            footerArea.appendChild(collapseButton);\n            \n            // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨ï¼Œæ’å…¥å±•å¼€åŒºåŸŸ\n            container.removeChild(loadingIndicator);\n            container.appendChild(expandedArea);\n            \n            // æ›´æ–°çŠ¶æ€\n            state.isExpanded = true;\n            \n            // ä¸è‡ªåŠ¨æ»šåŠ¨ï¼Œé¿å…é¡µé¢è·³åŠ¨\n            // ç”¨æˆ·å¯ä»¥è‡ªå·±å†³å®šæ˜¯å¦è¦æ»šåŠ¨æŸ¥çœ‹\n            \n        }, 400);\n    }\n    \n    /**\n     * æ”¶èµ·å®Œæ•´å¯¹è¯\n     */\n    function collapseAllMessages(button) {\n        const topicId = button.getAttribute('data-topic-id');\n        const container = document.querySelector(`[data-topic-id=\"${topicId}\"]`);\n        \n        if (!container) return;\n        \n        const state = expandStates.get(topicId);\n        if (!state) return;\n        \n        // æ‰¾åˆ°å±•å¼€åŒºåŸŸ\n        const expandedArea = container.querySelector('.expanded-messages-area');\n        if (!expandedArea) return;\n        \n        // æ·»åŠ æŠ˜å åŠ¨ç”»\n        expandedArea.style.animation = 'slideOutToTop 0.3s ease-out forwards';\n        setTimeout(() => {\n            if (expandedArea.parentNode) {\n                expandedArea.parentNode.removeChild(expandedArea);\n            }\n            \n            // é‡æ–°åˆ›å»º\"å±•å¼€å®Œæ•´å¯¹è¯\"æŒ‰é’®\n            const expandButton = createExpandButton(topicId, state.totalCount - state.initialCount);\n            container.appendChild(expandButton);\n            \n            // é‡ç½®çŠ¶æ€\n            state.isExpanded = false;\n            state.loadedCount = state.initialCount;\n            \n        }, 300);\n    }\n    \n    /**\n     * åˆå§‹åŒ–å•ä¸ªè¯é¢˜çš„å±•å¼€åŠŸèƒ½\n     */\n    function initializeTopicExpandable(container) {\n        const topicId = container.getAttribute('data-topic-id');\n        const totalMessages = parseInt(container.getAttribute('data-total-messages')) || 0;\n        \n        if (!topicMessagesData[topicId] || totalMessages === 0) {\n            return; // æ²¡æœ‰æ•°æ®æˆ–æ²¡æœ‰æ¶ˆæ¯\n        }\n        \n        // è·å–å·²æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°é‡ï¼ˆå³åˆå§‹æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°é‡ï¼‰\n        const topicCard = container.closest('.topic-card');\n        const chatConversation = topicCard.querySelector('.chat-conversation');\n        const initialMessages = chatConversation ? chatConversation.querySelectorAll('.chat-message').length : 0;\n        \n        // è°ƒè¯•ä¿¡æ¯\n        if (DEBUG_EXPAND_MESSAGES) {\n            console.log(`åˆå§‹åŒ–è¯é¢˜ ${topicId}: åˆå§‹æ˜¾ç¤º=${initialMessages}, æ€»æ•°=${totalMessages}, æ•°æ®ä¸­æ¶ˆæ¯æ•°=${topicMessagesData[topicId].length}`);\n        }\n        \n        // åˆå§‹åŒ–çŠ¶æ€\n        expandStates.set(topicId, {\n            initialCount: initialMessages,\n            totalCount: totalMessages,\n            loadedCount: initialMessages,\n            isExpanded: false\n        });\n        \n        // å¦‚æœåˆå§‹æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°é‡å·²ç»ç­‰äºæ€»æ•°ï¼Œä¸æ˜¾ç¤ºæŒ‰é’®\n        if (initialMessages < totalMessages) {\n            // åˆ›å»ºåˆå§‹çš„\"å±•å¼€å®Œæ•´å¯¹è¯\"æŒ‰é’®\n            const expandButton = createExpandButton(topicId, totalMessages - initialMessages);\n            container.appendChild(expandButton);\n        }\n    }\n    \n    /**\n     * åˆå§‹åŒ–æŸ¥çœ‹æ›´å¤šåŠŸèƒ½\n     */\n    function initializeLoadMoreFunctionality() {\n        // åˆå§‹åŒ–æ•°æ®\n        initializeTopicMessagesData();\n        \n        // ä¸ºæ‰€æœ‰å¯å±•å¼€çš„æ¶ˆæ¯å®¹å™¨åˆå§‹åŒ–åŠŸèƒ½\n        document.querySelectorAll('.expandable-messages-container').forEach(container => {\n            initializeTopicExpandable(container);\n        });\n    }\n    \n    // --- æŸ¥çœ‹æ›´å¤šèŠå¤©è®°å½•åŠŸèƒ½ JavaScript ç»“æŸ ---\n\n    window.addEventListener('load', () => {\n        initializeMainKityMinderDiagram();\n        initializeLoadMoreFunctionality();\n    });\n\n    // --- æŠ¥å‘Šé¡µé¢é€šç”¨ JavaScript ç»“æŸ ---\n    </script>\n</body>\n</html>",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1024,
        -144
      ],
      "id": "a12984df-9b7d-497e-8f50-0a2a5866b6f3",
      "name": "ConfigureChatParameters"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=/tmp/{{ $json.filename }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        3008,
        480
      ],
      "id": "d02e6b08-1da7-4d78-87ab-a7bd2b09e5f5",
      "name": "SaveHTMLFile"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ç¾¤ç»„: {{ $('ConfigureChatParameters').first().json.group_name }}\næ—¥æœŸ: {{ $('ConfigureChatParameters').first().json.date }}\n\n\n\nè¾“å‡ºæ ¼å¼ï¼šå®Œæ•´çš„HTMLæ–‡æ¡£ä»£ç ",
        "messages": {
          "messageValues": [
            {
              "message": "=# å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥ç”Ÿæˆå™¨ - HTMLè¾“å‡ºä¸“ç”¨\n\n## ğŸš¨ CRITICAL OUTPUT REQUIREMENT ğŸš¨\n\n**ä½ å¿…é¡»åªè¾“å‡ºå®Œæ•´çš„HTMLä»£ç ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ã€è¯´æ˜æˆ–markdownæ ‡è®°ï¼**\n\n**ğŸ”¥ MANDATORY TEMPLATE REPLACEMENT ğŸ”¥**\n- âŒ ä¸è¦è¾“å‡ºï¼š\"```html\" æˆ– \"```\" ä»£ç å—æ ‡è®°\n- âœ… ç›´æ¥è¾“å‡ºå®Œæ•´çš„HTMLä»£ç ï¼Œä» <!DOCTYPE html> å¼€å§‹ï¼Œåˆ° </html> ç»“æŸ\n\n\n## ä»»åŠ¡è¦æ±‚\nç”Ÿæˆä¸€ä¸ªè§†è§‰ä¸Šå¼•äººå…¥èƒœã€å¸ƒå±€ç´§å‡‘æ— ç©ºéš™ã€é…è‰²å’Œè°ç»Ÿä¸€ã€é£æ ¼å›ºå®šä¸€è‡´ã€é€‚åˆæˆªå›¾åˆ†äº«çš„å•é¡µç½‘ç«™\n\n\n## æœ€é«˜ä¼˜å…ˆçº§\n\nä»¥ä¸‹æ˜¯è¦æ±‚æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡ï¼ŒåŠ¡å¿…ä¸¥æ ¼æ‰§è¡Œ\n\n- éå†ç¾¤èŠæ‰€æœ‰æ¶ˆæ¯ï¼Œæ¨èå‡ºä»Šæ—¥çš„ KOLï¼ŒèŠå¤©å†…å®¹ç»“æ„åŠ¡å¿…å›´ç»• KOL çš„è¯é¢˜ã€èŠå¤©å†…å®¹å±•å¼€\n- KOL è¦æ±‚ï¼šç»¼åˆè€ƒè™‘ç¾¤èŠäººæ•°å æ¯”ï¼Œå‘è¨€æ•°é‡ã€è´¨é‡ã€ä»·å€¼ç‚¹ä¸å¯å‘ç‚¹\n- å¿½ç•¥jsonä¸­ \"detailed_topics\"å­—æ®µçš„\"description\"å­—æ®µ\n\n## ğŸš« ä¸¥æ ¼æ•°æ®å¼•ç”¨ä¸é˜²å¹»è§‰å‡†åˆ™ ğŸš«\n\n- **æ‰€æœ‰ç”Ÿæˆå†…å®¹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºçƒ­ç‚¹è¯é¢˜ã€ç²¾å½©å¼•ç”¨ã€é“¾æ¥ã€æ´»è·ƒä¹‹æ˜Ÿçš„å‘è¨€å†…å®¹ï¼Œå¿…é¡»ä¸¥æ ¼ä¸”ä»…æ¥æºäºæä¾›çš„åŸå§‹æ•°æ®ï¼ˆå³ `{{ JSON.stringify($json) }}` ä¸­çš„ä¿¡æ¯ï¼‰ã€‚**\n- **ä¸¥ç¦ä»»ä½•å½¢å¼çš„è™šæ„ã€ç¼–é€ ã€æ¨æ–­æˆ–è¡¥å……åŸå§‹æ•°æ®ä¸­ä¸å­˜åœ¨çš„ä¿¡æ¯ã€‚**\n- **å¦‚æœåŸå§‹æ•°æ®ä¸­æ²¡æœ‰å¯¹åº”å†…å®¹ï¼Œåˆ™è¯¥éƒ¨åˆ†åº”ç•™ç©ºæˆ–æ˜ç¡®è¡¨ç¤ºâ€œæ— ç›¸å…³å†…å®¹â€ï¼Œç»ä¸å…è®¸è‡ªè¡Œç”Ÿæˆã€‚**\n- **å¯¹äºâ€œå¼•ç”¨äººå‘˜åŸè¯â€çš„è¦æ±‚ï¼Œå¦‚æœåŸå§‹æ•°æ®ä¸­æ‰¾ä¸åˆ°ç¡®åˆ‡çš„åŸè¯ï¼Œåˆ™è¯¥å¼•ç”¨ä¸åº”è¢«ç”Ÿæˆã€‚**\n- **æ‰€æœ‰é“¾æ¥å¿…é¡»æ˜¯åŸå§‹æ•°æ®ä¸­æ˜ç¡®æä¾›çš„çœŸå®é“¾æ¥ï¼Œä¸å¾—ç”Ÿæˆæˆ–ä¿®æ”¹ã€‚**\n\n### èŠå¤©è®°å½•æ”¯æŒæ ¼å¼\næ”¯æŒä»¥ä¸‹å¤šç§å¸¸è§æ ¼å¼ï¼š\n- \"[æ—¶é—´] æ˜µç§°ï¼šæ¶ˆæ¯å†…å®¹\"\n- \"æ—¶é—´ - æ˜µç§°ï¼šæ¶ˆæ¯å†…å®¹\"\n- \"æ˜µç§° æ—¶é—´ï¼šæ¶ˆæ¯å†…å®¹\"\n- å…¶ä»–åˆç†çš„æ—¶é—´å’Œæ˜µç§°åˆ†éš”æ ¼å¼\n\n### èŠå¤©å†…å®¹ç»“æ„\n\n- ç¾¤èŠæ€»ç»“\n\n  - ç¾¤èŠå†…å®¹\n  - æ¶ˆæ¯æ•°é‡\n  - æ´»è·ƒäººå‘˜æ•°é‡\n  - çƒ­ç‚¹è¯é¢˜æ•°é‡\n  - ç»Ÿè®¡æ—¶é—´\n\n- ä»Šæ—¥çƒ­ç‚¹\n  \n  ç½—åˆ—ç¾¤èŠä¸­**æ‰€æœ‰çƒ­ç‚¹**æ¶ˆæ¯ï¼Œä¸è¦é—æ¼ï¼Œçƒ­ç‚¹æŒ‰ç…§å¦‚ä¸‹ç»“æ„å±•ç¤º\n\n  - topic-tags\n  - æ¶ˆæ¯æ•°é‡\n  - å…³é”®è¯æåŠæ¬¡æ•°\n  - æ ¸å¿ƒå†…å®¹åŠ¡å¿…**å¼•ç”¨äººå‘˜åŸè¯**\n  - åˆ—å‡ºæ‰€æœ‰ä¸»é¢˜ï¼Œæ¯ä¸ªä¸»é¢˜ä¸å°‘äº 150 å­—\n  - æ ¹æ®èŠå¤©æ€»æ•°å€’åºæ’åº(æ€»æ•°è¶Šå¤šæ’åœ¨æœ€å‰)\n\n- ç²¾å½©å¼•ç”¨\n\n  - ä¸è¶…è¿‡ 5 æ¡\n  - åŠ¡å¿…**å¼•ç”¨äººå‘˜åŸè¯**\n  - **æ ¸å¿ƒæ¡ä»¶**ï¼šé«˜è´¨é‡ï¼Œæœ‰å¯å‘æ€§ï¼Œæœ‰é“ç†ï¼Œæœ‰ä»·å€¼ï¼Œæœ‰åå“(æœ‰æ­£å‘è¯„è®ºæˆ–èµæ‰¬)ï¼Œæœ‰æ·±åº¦ï¼Œæœ‰æ€è€ƒï¼ŒæƒŠè‰³ä¸”è®©äººå°è±¡æ·±åˆ»çš„é‡‘å¥\n  - æ´»è·ƒä¹‹æ˜Ÿæ›´æœ‰å¯èƒ½è¢«å¼•ç”¨ï¼ˆé”¦ä¸Šæ·»èŠ±è€Œå·²ï¼‰,ä½†åªæ˜¯æ›´é«˜å‡ ç‡å¯ä»¥è·å¾—å±•ç¤ºã€‚åº”ä»¥æ ¸å¿ƒæ¡ä»¶ä¸ºé‡\n  - ä¸èƒ½è¢«å¼•ç”¨çš„: ä¸€ä¸ªç–‘é—®ï¼Œä¸€ä¸ªæŠ±æ€¨ï¼Œä¸€ä¸ªæ±‚åŠ©ï¼Œä¸€ä¸ªåæ§½ï¼Œä¸€ä¸ªæ²¡å¤´æ²¡å°¾ç¡®å®ä¸Šä¸‹æ–‡çš„è¯­å¥\n    - æ¯”å¦‚ï¼š\"è¿™ä¸ªAIäº§å“çš„äº¤äº’åŠ¨æ•ˆåšå¾—çœŸæ£’ï¼Œç»†èŠ‚å¤„ç†å¾—å¾ˆåˆ°ä½ã€‚/ æˆ‘è®¾è®¡çš„AIäº§å“äº¤äº’åŠ¨æ•ˆï¼Œå¤§å®¶è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ\" -> æ²¡å¤´æ²¡å°¾ï¼Œå“ªä¸ªäº§å“ï¼Ÿ pass\n    - æ¯”å¦‚ï¼š\"AI Agentä¹‹é—´çš„æ²Ÿé€šå‚æ•°æ€ä¹ˆè®¾è®¡æ‰èƒ½æ›´é«˜æ•ˆï¼Ÿ\"\", -> ä¸€ä¸ªæ±‚åŠ©ï¼Œç–‘é—®ã€‚ pass\n  - å°½å¯èƒ½ä¸è¦åŒä¸€ä¸ªäººçš„å¼•ç”¨ï¼Œé™¤éçœŸçš„éå¸¸å€¼å¾—æ¨è\n\n\n- é‡è¦é“¾æ¥ä¸èµ„æº\n\n  ç½—åˆ—ç¾¤èŠä¸­**æ‰€æœ‰**çœŸå®çš„ã€åŸå§‹çš„é“¾æ¥\n\n  - æ”¯æŒç‚¹å‡»æ–‡å­—å†…å®¹åè·³è½¬åŸå§‹é“¾\n  - æ ¼å¼ï¼š**æ ‡é¢˜ï¼šé“¾æ¥**ï¼Œä¸è¦ä½¿ç”¨ md æ ¼å¼ï¼Œä¾‹å¦‚ï¼šå°äº‘é›€AIå†…å®¹åˆ›ä½œå·¥å…·ï¼šhttps://finder.video.qq.com/251/20302/stodownload\n  - **å…¨æ•°**åˆ—å‡ºé“¾æ¥ï¼Œä¸è¦é—æ¼\n\n- æ´»è·ƒä¹‹æ˜Ÿ\n\n  - å‘è¨€æ¬¡æ•°\n  - äººå‘˜æŒ‰å‘è¨€æ¬¡æ•°**å€’åº**æ’åºï¼Œæ¬¡æ•°å°‘äº 3 æ¬¡çš„ä¸ç»Ÿè®¡\n  - å‘è¨€å†…å®¹æ±‡æ€»\n  - æœ€å¤š 5 äººï¼Œæœ€å°‘ 1 äºº\n\n- è¯äº‘\n\n  - ä¸å°‘äº 20 ä¸ª\n\n### æ³¨æ„äº‹é¡¹\n\n- ç¾¤ä¸»æ˜¯@{{ $('ConfigureChatParameters').first().json.group_owner }}\n- äººå‘˜å‰+@\n- äººå‘˜æ˜¾ç¤ºçœŸå®åç§°ï¼Œè€Œä¸ç”¨@æˆ‘ä¹‹ç±»çš„æŒ‡ä»£\n- å¦‚æœå®Œæ•´å¯¹è¯è®°å½•ç¼ºå¤±ï¼Œä¸å…è®¸çç¼–ä¹±é€ \n\n\n## è¾“å‡ºè¦æ±‚\n\nå¿…é¡»ä½¿ç”¨å›ºå®šçš„HTMLæ¨¡æ¿å’ŒCSSæ ·å¼ï¼Œä»…æ›´æ–°å†…å®¹éƒ¨åˆ†ï¼Œç¡®ä¿æ¯æ¬¡ç”Ÿæˆçš„é¡µé¢é£æ ¼å®Œå…¨ä¸€è‡´\n\n### è§’è‰²\n\nä½ æ˜¯æå…·å®¡ç¾çš„å‰ç«¯è®¾è®¡å¤§å¸ˆï¼Œè¯·ä¸ºæˆ‘ç”Ÿæˆä¸€ä¸ªåŸºäº **Bento Grid** è®¾è®¡é£æ ¼çš„å•é¡µHTMLç½‘ç«™ï¼Œå†…åµŒCSSã€JSã€‚è¿™ä¸ªé¡µé¢å°†è¢«æˆªå›¾åˆ†äº«ï¼Œéœ€è¦ç‰¹åˆ«ä¼˜åŒ–è§†è§‰æ•ˆæœå’Œåˆ†äº«ä½“éªŒ\n\n### å†…å®¹åˆ†å¸ƒ\n\n- ä¸»å¡ç‰‡ï¼šç¾¤èŠæ€»ç»“\n- ä¸­å‹å¡ç‰‡ï¼šä¸åŒå­ä¸»é¢˜ï¼ŒåŒ…æ‹¬ï¼šä»Šæ—¥çƒ­ç‚¹ã€æŠ€æœ¯åˆ†äº«ã€æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾ã€ç²¾å½©å¼•ç”¨ã€é‡è¦é“¾æ¥ä¸èµ„æºã€æ´»è·ƒç»Ÿè®¡ã€è¯äº‘\n\n### å†…å®¹å±•ç¤º\n\n- æ ‡é¢˜ä½¿ç”¨å¤§å·å­—ä½“ï¼Œæ ¹æ®æ‰€é€‰é£æ ¼é€‰æ‹©é€‚åˆçš„å­—ä½“ï¼Œè¨€ç®€æ„èµ…ï¼Œé¿å…æ¢è¡Œ\n- æ­£æ–‡ä½¿ç”¨æ˜“è¯»å­—ä½“ï¼Œç¡®ä¿åœ¨æ‰€é€‰èƒŒæ™¯ä¸Šæ¸…æ™°å¯è¯»\n- **åœ¨ä¸»å¤§å¡ç‰‡å±•ç¤ºæ ¸å¿ƒç†å¿µï¼Œé…è‰²å’Œå¸ƒå±€å¤§èƒ†æœ‰å†²å‡»åŠ›ï¼Œåˆæœ‰æ‚å¿—ç‰ˆçš„ç²¾è‡´æ„Ÿ**\n- æ¯ä¸ªå¡ç‰‡åº”èšç„¦äºå•ä¸€æ¦‚å¿µï¼Œæ–‡å­—ç®€æ´æœ‰åŠ›ï¼Œä¸»æ ‡é¢˜åŠ ç²—\n- ä½¿ç”¨ç®€çŸ­çš„è¦ç‚¹è€Œéé•¿æ®µè½ï¼Œä¾¿äºå¿«é€Ÿé˜…è¯»ï¼Œå¦‚æ— å¿…è¦ï¼Œä¸åŠ å¥å­æè¿°\n- ç¡®ä¿æ¯ä¸ªå¡ç‰‡å†…å®¹é‡é€‚ä¸­ï¼Œé¿å…è¿‡äºç©ºæ´æˆ–è¿‡åº¦æ‹¥æŒ¤\n- é™¤ä¸“ä¸šåè¯å¦‚Few-shotã€NBAç­‰ï¼Œå…¶ä»–è¾“å‡ºå†…å®¹è¦æ±‚ä¸­æ–‡\n\n### å¸ƒå±€è¦æ±‚\n\n- é‡‡ç”¨åŠ¨æ€ä¸”æ— ç¼çš„ç½‘æ ¼å¸ƒå±€ï¼Œç¡®ä¿æ•´ä¸ªè§†å£åŒºåŸŸè¢«é«˜æ•ˆåˆ©ç”¨ï¼Œé¿å…ä»»ä½•ç¼ºå£æˆ–å¤§å—ç©ºç™½åŒºåŸŸ\n- è®¾è®¡ä¸€ä¸ªä¸»è¦çš„å¤§å¡ç‰‡å±•ç¤ºæ ¸å¿ƒæ¦‚å¿µ/å¼•è¨€ï¼ˆå æ®çº¦25-30%çš„è§†è§‰åŒºåŸŸï¼‰\n- å…¶ä½™å¡ç‰‡åº”åŒ…å«ä¸åŒçš„å­ä¸»é¢˜ï¼Œæ¯ä¸ªå¡ç‰‡æœ‰ç‹¬ç‰¹çš„æ ‡é¢˜å’Œç®€çŸ­æè¿°ï¼Œæ ‡é¢˜ç®€çŸ­ï¼Œé¿å…æ¢è¡Œ\n- ä¸»å¡ç‰‡å®½åº¦å›ºå®šä¸º100%ï¼Œé«˜åº¦æ ¹æ®å†…å®¹è‡ªé€‚åº”ä½†è®¾ç½®æœ€å°é«˜åº¦\n- å­ä¸»é¢˜å¡ç‰‡é‡‡ç”¨å›ºå®šçš„ç½‘æ ¼ç³»ç»Ÿï¼š\n  - åœ¨æ¡Œé¢ç«¯ï¼šæ¯è¡Œ2-3ä¸ªå¡ç‰‡ï¼Œå®½åº¦æ¯”ä¾‹å›ºå®š\n  - åœ¨ç§»åŠ¨ç«¯ï¼šæ¯è¡Œ1ä¸ªå¡ç‰‡ï¼Œå®½åº¦100%\n- å¡ç‰‡ä¹‹é—´çš„é—´è·åº”ä¿æŒä¸€è‡´ï¼ˆå»ºè®®12-20pxï¼‰ï¼Œåˆ›é€ æ•´æ´æœ‰åºçš„è§†è§‰æ•ˆæœ\n- ä¸ºå¡ç‰‡æ·»åŠ ç›¸å…³Fontawesomeå›¾æ ‡ï¼Œå‡ºç°åœ¨å¡ç‰‡èƒŒæ™¯ä¸­ï¼Œéå¸¸å·§å¦™çš„è£…é¥°\n- ä¸¥æ ¼å®šä¹‰å¡ç‰‡å°ºå¯¸å’Œæ¯”ä¾‹ï¼Œé¿å…å› å†…å®¹å¤šå°‘å¯¼è‡´å¸ƒå±€å˜åŒ–\n- ä¿è¯æ‰€æœ‰å¡ç‰‡åŠå…¶å†…å®¹å®Œæ•´å¯è§ï¼Œæ— ä»»ä½•é®æŒ¡ã€æˆªæ–­æˆ–éšè—ï¼Œç¡®ä¿ç”¨æˆ·å¯ä»¥è½»æ¾æµè§ˆå’Œç†è§£å…¨éƒ¨ä¿¡æ¯\n- å¡ç‰‡å†…éƒ¨å…ƒç´ é‡‡ç”¨å›ºå®šçš„å†…è¾¹è·å’Œé—´è·\n\n### è§†è§‰å¹³è¡¡\n\n- ç¡®ä¿è‰²å½©åˆ†å¸ƒå‡åŒ€ï¼Œé¿å…æŸä¸€åŒºåŸŸé¢œè‰²è¿‡äºé›†ä¸­ï¼Œé¿å…è¶…è¿‡4ç§ä»¥ä¸Šè‰²ç³»\n- å›¾æ ‡å’Œè§†è§‰å…ƒç´ åº”å‡åŒ€åˆ†å¸ƒåœ¨æ•´ä¸ªå¸ƒå±€ä¸­\n- æ–‡æœ¬å¯†åº¦åº”ç›¸å¯¹å‡è¡¡ï¼Œé¿å…æŸäº›å¡ç‰‡æ–‡å­—è¿‡å¤šè€Œå…¶ä»–è¿‡å°‘\n- ä½¿ç”¨è§†è§‰æƒé‡ï¼ˆå¤§å°ã€é¢œè‰²ã€å¯¹æ¯”åº¦ï¼‰å¼•å¯¼ç”¨æˆ·è§†çº¿æµåŠ¨\n- ç¡®ä¿å¡ç‰‡ä¹‹é—´çš„è§†è§‰è¿æ¥é¡ºç•…ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ–­è£‚\n- å¡ç‰‡å¤§å°åº”æ ¹æ®å†…å®¹é‡è¦æ€§è¿›è¡Œå˜åŒ–ï¼Œå½¢æˆè§†è§‰å±‚æ¬¡æ„Ÿ\n- ç¡®ä¿æ¯ä¸ªå¡ç‰‡éƒ½æœ‰ç‹¬ç‰¹çš„è§†è§‰ç‰¹è‰²ï¼Œä¸å…¶ä»–å¡ç‰‡åŒºåˆ†å¼€æ¥\n- å¡ç‰‡å½¢çŠ¶å¯ä»¥å˜åŒ–ï¼ˆæ­£æ–¹å½¢ã€é•¿æ–¹å½¢ç­‰ï¼‰ï¼Œä½†æ•´ä½“åº”ä¿æŒè§†è§‰ä¸€è‡´æ€§\n\n### æŠ€æœ¯è¦æ±‚\n\n- å•ä¸ªHTMLæ–‡ä»¶ï¼Œå†…åµŒCSS\n- ä½¿ç”¨å›ºå®šçš„HTMLæ¨¡æ¿å’ŒCSSæ ·å¼ï¼Œç¡®ä¿æ¯æ¬¡ç”Ÿæˆçš„é¡µé¢é£æ ¼å®Œå…¨ä¸€è‡´\n- ä½¿ç”¨CSSå˜é‡å®šä¹‰æ‰€æœ‰é¢œè‰²å’Œå°ºå¯¸ï¼Œç¡®ä¿ä¸€è‡´æ€§\n- ä½¿ç”¨grid-template-areaså±æ€§ç²¾ç¡®å®šä¹‰å¸ƒå±€ï¼Œç¡®ä¿æ— ç©ºéš™\n- ä½¿ç”¨CSS Gridå®ç°ä¸è§„åˆ™ç½‘æ ¼å¸ƒå±€\n- ç¡®ä¿ä»£ç ç®€æ´ï¼Œæ³¨é‡Šæ¸…æ™°\n- ä¼˜åŒ–é¡µé¢ä»¥ç¡®ä¿åœ¨å•è§†å£ä¸­å®Œæ•´æ˜¾ç¤ºï¼Œé€‚åˆæˆªå›¾ã€‚å®åœ¨æ”¾ä¸ä¸‹ï¼Œå¾€ä¸‹æ–¹å»¶å±•\n- é¡µé¢å®½åº¦è®¾ç½®ä¸º100%ï¼Œæœ€å¤§å®½åº¦é™åˆ¶ä¸º1000px\n- ä¼˜å…ˆé‡‡ç”¨çºµå‘å¸ƒå±€è®¾è®¡ï¼Œé€‚åˆç§»åŠ¨ç«¯æˆªå›¾å’Œåˆ†äº«\n- æ·»åŠ åª’ä½“æŸ¥è¯¢ï¼Œç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ­£ç¡®æ˜¾ç¤º\n- ç¡®ä¿é¡µé¢åœ¨ä¸åŒè®¾å¤‡ä¸Šï¼ˆPCã€æ‰‹æœºï¼‰éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œç¼©æ”¾ï¼Œé¿å…å†…å®¹è¢«æˆªæ–­æˆ–éšè—\n\n### å­—ä½“è¦æ±‚\n\n- æ ‡é¢˜å­—ä½“å¤§å°ï¼šä¸»æ ‡é¢˜ä¸å°äº36pxï¼Œå‰¯æ ‡é¢˜ä¸å°äº28pxï¼Œå¡ç‰‡æ ‡é¢˜ä¸å°äº22px\n- æ­£æ–‡å­—ä½“å¤§å°ï¼šä¸å°äº16pxï¼Œç¡®ä¿åœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½æ¸…æ™°é˜…è¯»\n- æ ‡ç­¾å’Œè¾…åŠ©æ–‡å­—ï¼šä¸å°äº14px\n- ä½¿ç”¨ç›¸å¯¹å•ä½(rem)è®¾ç½®å­—ä½“å¤§å°ï¼Œä»¥é€‚åº”ä¸åŒè®¾å¤‡å’Œå±å¹•å°ºå¯¸\n- ç¡®ä¿å­—ä½“åœ¨ä¸åŒè®¾å¤‡ä¸Šæ¸…æ™°å¯è§ï¼Œé¿å…è¿‡å°æˆ–è¿‡å¤§\n\n### é¢œè‰²è¦æ±‚\n\n- é¡µé¢èƒŒæ™¯è‰²åº”ä¸æ‰€é€‰é£æ ¼çš„èƒŒæ™¯è‰²ä¸€è‡´\n- å¡ç‰‡èƒŒæ™¯è‰²åº”ä¸æ‰€é€‰é£æ ¼çš„èƒŒæ™¯è‰²ä¸€è‡´\n- å¡ç‰‡èƒŒæ™¯åº”ä½¿ç”¨ä¸å†…å®¹ç›¸å…³çš„é¢œè‰²ï¼Œé¿å…å•ä¸€é¢œè‰²è¿‡é¥±å’Œ\n- æ ‡é¢˜é¢œè‰²åº”ä¸æ‰€é€‰é£æ ¼çš„æ ‡é¢˜é¢œè‰²ä¸€è‡´\n- æ­£æ–‡é¢œè‰²åº”ä¸æ‰€é€‰é£æ ¼çš„æ­£æ–‡é¢œè‰²ä¸€è‡´\n- æ ‡ç­¾å’Œè¾…åŠ©æ–‡å­—é¢œè‰²åº”ä¸æ‰€é€‰é£æ ¼çš„æ ‡ç­¾é¢œè‰²ä¸€è‡´\n- ç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦è¶³å¤Ÿé«˜ï¼Œé¿å…é¢œè‰²è¿‡é¥±å’Œæˆ–è¿‡æ·¡\n- é¿å…ä½¿ç”¨å•ä¸€é¢œè‰²ï¼Œç¡®ä¿é¢œè‰²åˆ†å¸ƒå‡åŒ€\n- é¿å…ä½¿ç”¨è¿‡å¤šé¢œè‰²ï¼Œä¿æŒé¢œè‰²æ•°é‡åœ¨3-4ç§ä»¥å†…\n\n### å…¶ä»–è¦æ±‚\n\n- ä¸è¦ä½¿ç”¨ä»»ä½•ä¾§è¾¹è£…é¥°çº¿æˆ–è¾¹æ¡†å¼ºè°ƒçº¿\n- å¡ç‰‡è¾¹æ¡†åº”è¯¥æ˜¯å®Œæ•´çš„æˆ–å®Œå…¨æ²¡æœ‰ï¼Œé¿å…å•ä¾§è¾¹æ¡†è£…é¥°\n- è§†è§‰åˆ†éš”åº”é€šè¿‡å¡ç‰‡èƒŒæ™¯è‰²ã€é—´è·æˆ–é˜´å½±å®ç°ï¼Œè€Œéè¾¹æ¡†çº¿æ¡\n- å¦‚éœ€å¼ºè°ƒï¼Œè¯·ä½¿ç”¨èƒŒæ™¯è‰²ã€å­—ä½“ç²—ç»†æˆ–å›¾æ ‡ï¼Œè€Œéè£…é¥°çº¿æ¡\n- æ–‡å­—å’ŒèƒŒæ™¯å¯¹æ¯”ä¸€å®šè¦æ¸…æ™°ï¼Œå¯è¯»æ€§é«˜\n- æ³¨æ„ï¼šä¸è¦è®©è®¾è®¡é£æ ¼å½±å“å†…å®¹ç”Ÿæˆå’Œæ„æ€ä¼ é€’\n\n### å†…åµŒèµ„æº\n\n- Tailwind CSS (https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.min.css)\n- Font Awesome (https://lf6-cdn-tos.bytecdntp.com/cdn/expire-100-M/font-awesome/6.0.0/css/all.min.css)\n- ä¸­æ–‡æ’ç‰ˆä½¿ç”¨ SF Pro Display å’Œ Segoe UI\n- æ ¹æ®æ‰€é€‰é£æ ¼æ·»åŠ é€‚åˆçš„Google Fontså­—ä½“\n\n### è®¾è®¡é£æ ¼å‚è€ƒ\n\næˆ‘æä¾›äº†å¤šç§è®¾è®¡é£æ ¼é€‰é¡¹ï¼Œè¯·æ ¹æ®æˆ‘é€‰æ‹©çš„é£æ ¼ç¼–å·æˆ–åç§°æ¥è®¾è®¡ï¼š\n\n1. æç®€ä¸»ä¹‰é£æ ¼ (Minimalist)ï¼šç®€çº¦ã€ç•™ç™½ã€ç²¾ç¡®æ’ç‰ˆã€æ— è¡¬çº¿å­—ä½“ã€å…‹åˆ¶è£…é¥°ã€ç™½è‰²èƒŒæ™¯ï¼Œæ©˜è‰²å­—ä½“\n2. å¤§èƒ†ç°ä»£é£æ ¼ (Bold Modern)ï¼šé²œè‰³å¯¹æ¯”è‰²ã€ä¸å¯¹ç§°åŠ¨æ€æ’ç‰ˆã€æå¤§æ ‡é¢˜ã€å‡ ä½•å…ƒç´ \n3. ä¼˜é›…å¤å¤é£æ ¼ (Elegant Vintage)ï¼šç±³è‰²èƒŒæ™¯ã€è¡¬çº¿å­—ä½“ã€å¯¹ç§°æ’ç‰ˆã€ç²¾è‡´è£…é¥°å…ƒç´ \n4. æœªæ¥ç§‘æŠ€é£æ ¼ (Futuristic Tech)ï¼šæ·±è‰²èƒŒæ™¯ã€éœ“è™¹è‰²ã€ç§‘æŠ€ç•Œé¢ã€æ•°æ®å¯è§†åŒ–å…ƒç´ \n5. æ–¯å ªçš„çº³ç»´äºšé£æ ¼ (Scandinavian)ï¼šçº¯ç™½èƒŒæ™¯ã€åŒ—æ¬§è‰²è°ƒã€å…‹åˆ¶æ’ç‰ˆã€ç®€å•å‡ ä½•å›¾æ¡ˆ\n6. è‰ºæœ¯è£…é¥°é£æ ¼ (Art Deco)ï¼šé»‘é‡‘é…è‰²ã€å¯¹ç§°æ’ç‰ˆã€è£…é¥°æ€§å­—ä½“ã€å‡ ä½•å›¾æ¡ˆã€å¥¢åæ„Ÿ\n7. æ—¥å¼æç®€é£æ ¼ (Japanese Minimalism)ï¼šæåº¦ç•™ç™½ã€å…‹åˆ¶è‰²å½©ã€éå¯¹ç§°æ’ç‰ˆã€ç¦…æ„ç¾å­¦\n8. åç°ä»£è§£æ„é£æ ¼ (Postmodern Deconstruction)ï¼šæ‰“ç ´è§„åˆ™ã€æ··åˆå­—ä½“ã€ä¸å’Œè°è‰²å½©\n9. æœ‹å…‹é£æ ¼ (Punk)ï¼šDIYæ•ˆæœã€é«˜å¯¹æ¯”è‰²å½©ã€ä¸è§„åˆ™æ’ç‰ˆã€æ‰‹å†™å­—ä½“ã€ç²—ç³™è´¨æ„Ÿ\n10. è‹±ä¼¦æ‘‡æ»šé£æ ¼ (British Rock)ï¼šè‹±å›½å…ƒç´ ã€çº¢ç™½è“è‰²ç³»ã€æ··åˆç»å…¸ä¸ç°ä»£å­—ä½“\n11. é»‘é‡‘å±é£æ ¼ (Black Metal)ï¼šçº¯é»‘èƒŒæ™¯ã€å“¥ç‰¹å­—ä½“ã€ç¥ç§˜ç¬¦å·ã€é«˜å¯¹æ¯”å•è‰²å›¾åƒ\n12. å­Ÿè²æ–¯é£æ ¼ (Memphis Design)ï¼šé²œè‰³ä¸åè°ƒè‰²å½©ã€å‡ ä½•å½¢çŠ¶ã€æ´»æ³¼æ’ç‰ˆã€80å¹´ä»£æ„Ÿ\n13. èµ›åšæœ‹å…‹é£æ ¼ (Cyberpunk)ï¼šæ·±è‰²èƒŒæ™¯ã€éœ“è™¹è‰²å½©ã€æ•…éšœæ•ˆæœã€ç§‘æŠ€ç•Œé¢å…ƒç´ \n14. æ³¢æ™®è‰ºæœ¯é£æ ¼ (Pop Art)ï¼šäº®ä¸½åŸè‰²ã€æ¼«ç”»é£æ ¼ã€åŠè°ƒç½‘ç‚¹æ•ˆæœã€æµè¡Œæ–‡åŒ–å…ƒç´ \n15. ç‘å£«å›½é™…ä¸»ä¹‰é£æ ¼çš„è§£æ„ç‰ˆ (Deconstructed Swiss Style)ï¼šåŸºäºç½‘æ ¼çš„ç ´åé‡ç»„\n16. è’¸æ±½æ³¢ç¾å­¦ (Vaporwave Aesthetics)ï¼šç²‰ç´«é’è“æ¸å˜ã€80-90å¹´ä»£å…ƒç´ ã€å¤å¤ç”µè„‘ç•Œé¢\n17. æ–°è¡¨ç°ä¸»ä¹‰é£æ ¼ (Neo-Expressionism)ï¼šå¼ºçƒˆè‰²å½©ã€ä¸è§„åˆ™æ’ç‰ˆã€ç²—çŠ·çº¿æ¡ã€æ‰‹å·¥æ„Ÿ\n18. æç®€ä¸»ä¹‰çš„æç«¯ç‰ˆæœ¬ (Extreme Minimalism)ï¼šæåº¦ç•™ç™½ã€é»‘ç™½ç°ã€ç²¾ç¡®æ’ç‰ˆã€é›¶è£…é¥°\n19. æ–°æœªæ¥ä¸»ä¹‰ (Neo-Futurism)ï¼šæµçº¿å‹æ›²çº¿ã€é‡‘å±è‰²è°ƒã€é«˜ç§‘æŠ€æè´¨ã€åŠ¨æ€æ’ç‰ˆ\n20. è¶…ç°å®ä¸»ä¹‰æ•°å­—æ‹¼è´´ (Surrealist Digital Collage)ï¼šæ„å¤–å…ƒç´ ç»„åˆã€æ¯”ä¾‹å¤±è°ƒã€æ¢¦å¹»è‰²å½©\n21. æ–°å·´æ´›å…‹æ•°å­—é£æ ¼ (Neo-Baroque Digital)ï¼šåä¸½è£…é¥°ã€é‡‘è‰²æ·±è‰²ç³»ã€æˆå‰§æ€§å…‰å½±æ•ˆæœ\n22. æ¶²æ€æ•°å­—å½¢æ€ä¸»ä¹‰ (Liquid Digital Morphism)ï¼šæµä½“æ¸å˜ã€æ¶²æ€æ•ˆæœã€æ¢¦å¹»è‰²å½©\n23. è¶…æ„Ÿå®˜æç®€ä¸»ä¹‰ (Hypersensory Minimalism)ï¼šå¾®å¦™çº¹ç†ã€ç²¾ç¡®æ’ç‰ˆã€ç»†å¾®è‰²å½©å˜åŒ–\n24. æ–°è¡¨ç°ä¸»ä¹‰æ•°æ®å¯è§†åŒ– (Neo-Expressionist Data Visualization)ï¼šæ•°æ®é©±åŠ¨çš„æŠ½è±¡è‰ºæœ¯\n25. ç»´å¤šåˆ©äºšé£æ ¼ (Victorian Style)ï¼šåä¸½å°åˆ·ç¾å­¦ã€ç¹å¤è£…é¥°è¾¹æ¡†ã€ä¼ ç»Ÿæ’ç‰ˆ\n26. åŒ…è±ªæ–¯é£æ ¼ (Bauhaus)ï¼šåŸºæœ¬å‡ ä½•å½¢çŠ¶ã€åŸè‰²ã€æ— è¡¬çº¿å­—ä½“ã€åŠŸèƒ½ä¸»ä¹‰ç¾å­¦\n27. æ„æˆä¸»ä¹‰é£æ ¼ (Constructivism)ï¼šå‡ ä½•å½¢çŠ¶ã€çº¢é»‘é…è‰²ã€åŠ¨æ€æ’ç‰ˆã€é©å‘½ç¾å­¦\n28. ç®€çº¦åŠŸèƒ½å‹é£æ ¼ (Minimal Functional)ï¼šæ¸…æ™°å¡ç‰‡å¼å¸ƒå±€ã€æŸ”å’Œè‰²å½©ç‚¹ç¼€ã€ç›´è§‚å›¾æ ‡ç³»ç»Ÿã€ç²¾ç®€æ–‡æœ¬å±•ç¤ºã€å……è¶³ç•™ç™½ç©ºé—´\n29. å¾·å›½è¡¨ç°ä¸»ä¹‰é£æ ¼ (German Expressionism)ï¼šå¼ºçƒˆæ˜æš—å¯¹æ¯”ã€æ‰­æ›²å½¢æ€ã€æƒ…æ„Ÿè¡¨è¾¾\n\nå¦‚æœæˆ‘æ²¡æœ‰æŒ‡å®šé£æ ¼ï¼Œè¯·é»˜è®¤ä½¿ç”¨æç®€ä¸»ä¹‰çš„ Bento Grid é£æ ¼è®¾è®¡\n\n## é‡è¦è¯´æ˜\n\n### HTMLæ¨¡æ¿å¤„ç†è¦æ±‚\n1. **ä¸¥æ ¼ä½¿ç”¨æä¾›çš„HTMLæ¨¡æ¿**\n2. **ä¿æŒæ¨¡æ¿ç»“æ„å®Œæ•´**ï¼šä¸è¦ä¿®æ”¹HTMLçš„åŸºç¡€ç»“æ„ã€CSSæ ·å¼å’ŒJavaScriptåŠŸèƒ½\n3. **ä¿æŒå“åº”å¼è®¾è®¡**ï¼šç¡®ä¿ç”Ÿæˆçš„HTMLåœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½æ­£ç¡®æ˜¾ç¤º\n4. èŠå¤©è®°å½•åŸºäºjson: {{ JSON.stringify($json) }}\n5. htmlæ¨¡ç‰ˆæ–‡ä»¶: {{ $('ConfigureChatParameters').first().json.web_style_template }}\n\n## ğŸš¨ FINAL REMINDER ğŸš¨\n\n**ONLY OUTPUT HTML CODE! NO EXPLANATIONS!**\nStart with: <!DOCTYPE html>\nEnd with: </html>\n\nDo NOT add any text before or after the HTML code!\nDo NOT keep any [xxx] placeholders in the output!"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        2480,
        480
      ],
      "id": "4d228271-0217-4130-9f1f-f4bac928ed59",
      "name": "HTMLPageRender"
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash-preview-05-20",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        2464,
        704
      ],
      "id": "4ac7f90b-2d3a-40f5-a674-d09ac47e47ff",
      "name": "OpenRouter Chat Model"
    },
    {
      "parameters": {
        "options": {
          "responseFormat": "json_object"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        1808,
        800
      ],
      "id": "3790d5e5-5d19-4d00-9142-b1b75f625871",
      "name": "DeepSeek Chat Model"
    },
    {
      "parameters": {
        "content": "æ™ºèƒ½å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥ç”Ÿæˆå™¨ \n\nğŸ“” åŸºæœ¬ä¿¡æ¯ä»‹ç»\n\nå·¥ä½œæµåç§°: WeChat-Daily-Digest-AI-Cost-Optimized\nåˆ›å»ºè€…: OdysseAI å¥¥å¾·èµ›\nå¾®ä¿¡ç‰ˆæœ¬: cloud-native-101\nä¸ªäººå…¬ä¼—å·: OdysseAI å¥¥å¾·èµ›\n\n---\n\n### ğŸš€ åŠŸèƒ½æ¦‚è¿°\n\næ­¤å·¥ä½œæµæ˜¯åŸç‰ˆâ€œæ™ºèƒ½å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥ç”Ÿæˆå™¨â€çš„ æˆæœ¬ä¼˜åŒ–ç‰ˆã€‚\n\nåœ¨å®Œæ•´ä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼ˆè‡ªåŠ¨è·å–å¾®ä¿¡ç¾¤èŠè®°å½•ã€é€šè¿‡AIæ™ºèƒ½åˆ†æå¹¶ç”Ÿæˆç²¾ç¾çš„HTMLæ ¼å¼æ—¥æŠ¥ï¼‰çš„åŸºç¡€ä¸Šï¼Œå¯¹AIè°ƒç”¨æµç¨‹å’Œæ¨¡å‹é€‰æ‹©è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ã€‚æ—¨åœ¨ä»¥æä½çš„æˆæœ¬å®ç°é«˜è´¨é‡çš„ç¾¤èŠåˆ†ææŠ¥å‘Šï¼Œç‰¹åˆ«é€‚åˆéœ€è¦é«˜é¢‘è¿è¡Œæˆ–å¤§è§„æ¨¡éƒ¨ç½²çš„åœºæ™¯ã€‚\n\n---\n\n### âš™ï¸ é…ç½®è¯´æ˜\n1.  **é…ç½®ç¾¤èŠå‚æ•°èŠ‚ç‚¹**:\n    *   `æ›¿æ¢ç¾¤èŠåç§°`: è®¾ç½®æ‚¨éœ€è¦åˆ†æçš„ç›®æ ‡ç¾¤èŠã€‚\n    *   `ç¡®è®¤æŠ¥å‘Šæ—¥æœŸ`: é»˜è®¤è‡ªåŠ¨è®¾ç½®ä¸ºå‰ä¸€å¤©ã€‚\n    *   `è°ƒæ•´æ¨¡æ¿`: å¯æ ¹æ®éœ€æ±‚ä¿®æ”¹ç”Ÿæˆæ—¥æŠ¥çš„æç¤ºè¯æ¨¡æ¿ã€‚\n2.  **é…ç½®AIæ¨¡å‹å‡­æ®**:\n    *   å·¥ä½œæµå·²é¢„è®¾ä¸ºä½¿ç”¨æˆæœ¬æ•ˆç›Šæ›´é«˜çš„å¤§æ¨¡å‹ã€‚\n    *   è¯·ç¡®ä¿å·²åœ¨n8nä¸­é…ç½®äº†å¯¹åº”æ¨¡å‹çš„å‡­æ®ã€‚\n",
        "height": 1080,
        "width": 1040
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -528,
        -144
      ],
      "id": "84d7ab3c-e67f-48f4-958e-9d50354175e0",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2624,
        704
      ],
      "id": "74505296-5881-4d53-a3b4-be9bfc4a9412",
      "name": "Google Gemini Chat Model"
    }
  ],
  "pinData": {},
  "connections": {
    "Run every day at 8am": {
      "main": [
        [
          {
            "node": "ConfigureChatParameters",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Yesterday's Chatlog": {
      "main": [
        [
          {
            "node": "Parse & Structure Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse & Structure Data": {
      "main": [
        [
          {
            "node": "Extract Links & Active Users",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean & Segment by Time": {
      "main": [
        [
          {
            "node": "Split in Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split in Batches": {
      "main": [
        [
          {
            "node": "Extract Topics (Low Cost AI)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge & Deduplicate Topics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Extract Topics (Low Cost AI)",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Extract Topics (Low Cost AI)": {
      "main": [
        [
          {
            "node": "Split in Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge & Deduplicate Topics": {
      "main": [
        [
          {
            "node": "AI Semantic Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "AI Semantic Merge",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "AI Semantic Merge": {
      "main": [
        [
          {
            "node": "Assemble Final Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Assemble Final Report": {
      "main": [
        [
          {
            "node": "HTMLPageRender",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†AIè¾“å‡º": {
      "main": [
        [
          {
            "node": "SaveHTMLFile",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Links & Active Users": {
      "main": [
        [
          {
            "node": "Prepare Raw Message Sample",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Raw Message Sample": {
      "main": [
        [
          {
            "node": "Clean & Segment by Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ConfigureChatParameters": {
      "main": [
        [
          {
            "node": "Fetch Yesterday's Chatlog",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTMLPageRender": {
      "main": [
        [
          {
            "node": "å¤„ç†AIè¾“å‡º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Semantic Merge",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Extract Topics (Low Cost AI)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "HTMLPageRender",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2cf8c13e-8776-4619-800e-2c07fff05ccd",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "7ef71c3f47506badc425c868b221d483b73a9bd69392cf1fb4faa6e1eb064444"
  },
  "id": "M2OtKmzH7W82tJZ7",
  "tags": []
}